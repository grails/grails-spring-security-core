<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>14 Switch User 2.0-RC3</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction to the Spring Security Plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/newInV2.html"><strong>2</strong><span>What's New in Version 2.0</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/domainClasses.html"><strong>3</strong><span>Required and Optional Domain Classes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/requestMappings.html"><strong>4</strong><span>Configuring Request Mappings to Secure URLs</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/helperClasses.html"><strong>5</strong><span>Helper Classes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/events.html"><strong>6</strong><span>Events</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/domainClassProperties.html"><strong>7</strong><span>User, Authority (Role), and Requestmap Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/authentication.html"><strong>8</strong><span>Authentication</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/authenticationProviders.html"><strong>9</strong><span>Authentication Providers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/userDetailsService.html"><strong>10</strong><span>Custom UserDetailsService</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/passwords.html"><strong>11</strong><span>Password and Account Protection</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/urlProperties.html"><strong>12</strong><span>URL Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/hierarchicalRoles.html"><strong>13</strong><span>Hierarchical Roles</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/switchUser.html"><strong>14</strong><span>Switch User</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/filters.html"><strong>15</strong><span>Filters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/channelSecurity.html"><strong>16</strong><span>Channel Security</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/ip.html"><strong>17</strong><span>IP Address Restrictions</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/sessionFixation.html"><strong>18</strong><span>Session Fixation Prevention</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/logoutHandlers.html"><strong>19</strong><span>Logout Handlers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/voters.html"><strong>20</strong><span>Voters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/miscProperties.html"><strong>21</strong><span>Miscellaneous Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/tutorials.html"><strong>22</strong><span>Tutorials</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/controllerMetaClassMethods.html"><strong>23</strong><span>Controller MetaClass Methods</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/i18n.html"><strong>24</strong><span>Internationalization</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/acegi.html"><strong>25</strong><span>Migrating from the Acegi plugin</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>Spring Security Core plugin</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/hierarchicalRoles.html">&lt;&lt; <strong>13</strong><span>Hierarchical Roles</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/filters.html"><strong>15</strong><span>Filters</span> >></a></div>
                


                <div class="project">
                    <h1>14 Switch User - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Burt Beckwith, Beverley Talbott</p>

                    <p><strong>Version:</strong> 2.0-RC3</p>

                    
                </div>

                

                

<h1 id="switchUser">14 Switch User</h1>
To enable a user to switch from the current <code>Authentication</code> to another user's, set the <code>useSwitchUserFilter</code> attribute to <code>true</code>. This feature is similar to the 'su' command in Unix. It enables, for example, an admin to act as a regular user to perform some actions, and then switch back.<p class="paragraph"/><blockquote class="warning">
This feature is very powerful; it allows full access to everything the switched-to user can access without requiring the user's password. Limit who can use this feature by guarding the user switch URL with a role, for example, <code>ROLE_SWITCH_USER</code>, <code>ROLE_ADMIN</code>, and so on.
</blockquote><p class="paragraph"/><h4>Switching to Another User</h4><p class="paragraph"/>To switch to another user, typically you create a form that submits to <code>/j_spring_security_switch_user</code>:<p class="paragraph"/><div class="code"><pre>&#60;sec:ifAllGranted roles='ROLE_SWITCH_USER'&#62;<p class="paragraph"/>   &#60;form action='/j_spring_security_switch_user' method='POST'&#62;
      Switch to user: &#60;input type='text' name='j_username'/&#62; &#60;br/&#62;
      &#60;input type='submit' value='Switch'/&#62;
   &#60;/form&#62;<p class="paragraph"/>&#60;/sec:ifAllGranted&#62;</pre></div><p class="paragraph"/>Here the form is guarded by a check that the logged-in user has <code>ROLE_SWITCH_USER</code> and is not shown otherwise. You also need to guard the user switch URL, and the approach depends on your mapping scheme. If you use annotations, add a rule to the <code>controllerAnnotations.staticRules</code> attribute:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.controllerAnnotations.staticRules = &#91;
   &#8230;
   '/j_spring_security_switch_user': &#91;'ROLE_SWITCH_USER', 'isFullyAuthenticated()'&#93;
&#93;</pre></div><p class="paragraph"/>If you use <code>Requestmap</code>s, create a rule like this (for example, in <code>BootStrap</code>):<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> Requestmap(url: '/j_spring_security_switch_user',
               configAttribute: 'ROLE_SWITCH_USER,isFullyAuthenticated()').save(flush: <span class="java&#45;keyword">true</span>)</pre></div><p class="paragraph"/>If you use the <code>Config.groovy</code> map, add the rule there:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.interceptUrlMap = &#91;
   &#8230;
   '/j_spring_security_switch_user': &#91;'ROLE_SWITCH_USER', 'isFullyAuthenticated()'&#93;
&#93;</pre></div><p class="paragraph"/><h4>Switching Back to Original User</h4>
To resume as the original user, navigate to <code>/j_spring_security_exit_user</code>.<p class="paragraph"/><div class="code"><pre>&#60;sec:ifSwitched&#62;
&#60;a href='$&#123;request.contextPath&#125;/j_spring_security_exit_user'&#62;
   Resume as &#60;sec:switchedUserOriginalUsername/&#62;
&#60;/a&#62;
&#60;/sec:ifSwitched&#62;</pre></div><p class="paragraph"/><h4>Customizing URLs</h4>
You can customize the URLs that are used for this feature, although it is rarely necessary:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.switchUser.switchUserUrl = &#8230;
grails.plugin.springsecurity.switchUser.exitUserUrl = &#8230;
grails.plugin.springsecurity.switchUser.targetUrl = &#8230;
grails.plugin.springsecurity.switchUser.switchFailureUrl = ...</pre></div><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>useSwitchUserFilter</td><td><code>false</code></td><td>Whether to use the switch user filter.</td></tr><tr class="table-even"><td>switchUser. switchUserUrl</td><td>'/j_spring_security_switch_user'</td><td>URL to access (via GET or POST) to switch to another user.</td></tr><tr class="table-odd"><td>switchUser. exitUserUrl</td><td>'/j_spring_security_exit_user'</td><td>URL to access to switch to another user.</td></tr><tr class="table-even"><td>switchUser. targetUrl</td><td>Same as <code>successHandler.defaultTargetUrl</code></td><td>URL for redirect after switching.</td></tr><tr class="table-odd"><td>switchUser. switchFailureUrl</td><td>Same as <code>failureHandler.defaultFailureUrl</code></td><td>URL for redirect after an error during an attempt to switch.</td></tr><tr class="table-even"><td>switchUser. usernameParameter</td><td><code>SwitchUserFilter. SPRING_SECURITY_SWITCH_USERNAME_KEY</code></td><td>The username request parameter name</td></tr></table><p class="paragraph"/><h4>GSP Code</h4><p class="paragraph"/>One approach to supporting the switch user feature is to add code to one or more of your GSP templates. In this example the current username is displayed, and if the user has switched from another (using the <code>sec:ifSwitched</code> tag) then a 'resume' link is displayed. If not, and the user has the required role, a form is displayed to allow input of the username to switch to:<p class="paragraph"/><div class="code"><pre>&#60;sec:ifLoggedIn&#62;
Logged in as &#60;sec:username/&#62;
&#60;/sec:ifLoggedIn&#62;<p class="paragraph"/>&#60;sec:ifSwitched&#62;
&#60;a href='$&#123;request.contextPath&#125;/j_spring_security_exit_user'&#62;
   Resume as &#60;sec:switchedUserOriginalUsername/&#62;
&#60;/a&#62;
&#60;/sec:ifSwitched&#62;<p class="paragraph"/>&#60;sec:ifNotSwitched&#62;
   &#60;sec:ifAllGranted roles='ROLE_SWITCH_USER'&#62;<p class="paragraph"/>   &#60;form action='$&#123;request.contextPath&#125;/j_spring_security_switch_user' method='POST'&#62;
      Switch to user: &#60;input type='text' name='j_username'/&#62;&#60;br/&#62;
      &#60;input type='submit' value='Switch'/&#62;
   &#60;/form&#62;<p class="paragraph"/>   &#60;/sec:ifAllGranted&#62;
&#60;/sec:ifNotSwitched&#62;</pre></div>



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/hierarchicalRoles.html">&lt;&lt; <strong>13</strong><span>Hierarchical Roles</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/filters.html"><strong>15</strong><span>Filters</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-create-persistent-token.html">s2-create-persistent-token</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-quickstart.html">s2-quickstart</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
