<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Burt Beckwith, Puneet Behl">
<meta name="copyright" content="Apache License, Version 2.0">
<title>Spring Security Core Plugin - Reference Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Spring Security Core Plugin - Reference Documentation</h1>
<div class="details">
<span id="author" class="author">Burt Beckwith, Puneet Behl</span><br>
<span id="revnumber">version:&nbsp;<span style='display:inline-block;'><select onChange='window.document.location.href=this.options[this.selectedIndex].value;'><option selected='selected' value='https://grails.github.io/grails-spring-security-core/index.html'>SNAPSHOT</option><option value='https://grails.github.io/grails-spring-security-core/5.3.0/index.html'>5.3.0</option><option value='https://grails.github.io/grails-spring-security-core/4.0.5/index.html'>4.0.5</option><option value='https://grails.github.io/grails-spring-security-core/3.3.2/index.html'>3.3.2</option></select></span></span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction to the Spring Security Plugin</a>
<ul class="sectlevel2">
<li><a href="#release-history-and-acknowledgment">1.1. Release History and Acknowledgment</a></li>
<li><a href="#configGroovy">1.2. Configuration Settings</a></li>
<li><a href="#gettingStarted">1.3. Getting Started</a></li>
</ul>
</li>
<li><a href="#whatsNew">2. What&#8217;s New</a>
<ul class="sectlevel2">
<li><a href="#newInV5">2.1. What&#8217;s New in Version 5.0.0</a></li>
<li><a href="#newInV401">2.2. What&#8217;s New in Version 4.0.1</a></li>
<li><a href="#newInV4">2.3. What&#8217;s New in Version 4.0</a></li>
<li><a href="#newInV321">2.4. What&#8217;s New in Version 3.2.1</a></li>
<li><a href="#newInV3">2.5. What&#8217;s New in Version 3.0</a></li>
<li><a href="#newInV2">2.6. What&#8217;s New in Version 2.0</a></li>
</ul>
</li>
<li><a href="#domainClasses">3. Domain Classes</a>
<ul class="sectlevel2">
<li><a href="#personClass">3.1. Person Class</a></li>
<li><a href="#authorityClass">3.2. Authority Class</a></li>
<li><a href="#personAuthorityClass">3.3. PersonAuthority Class</a></li>
<li><a href="#authorityGroupClass">3.4. Group Class</a></li>
<li><a href="#personAuthorityGroupClass">3.5. PersonGroup Class</a></li>
<li><a href="#authorityGroupAuthorityClass">3.6. GroupAuthority Class</a></li>
<li><a href="#requestmapClass">3.7. Requestmap Class</a></li>
</ul>
</li>
<li><a href="#requestMappings">4. Configuring Request Mappings to Secure URLs</a>
<ul class="sectlevel2">
<li><a href="#pessimistic-lockdown">4.1. Pessimistic Lockdown</a></li>
<li><a href="#urls-and-authorities">4.2. URLs and Authorities</a></li>
<li><a href="#comparing-the-approaches">4.3. Comparing the Approaches</a></li>
<li><a href="#securedAnnotations">4.4. Defining Secured Annotations</a></li>
<li><a href="#configGroovyMap">4.5. Static Map</a></li>
<li><a href="#requestmapInstances">4.6. Requestmap Instances Stored in the Database</a></li>
<li><a href="#expressions">4.7. Using Expressions to Create Descriptive, Fine-Grained Rules</a></li>
</ul>
</li>
<li><a href="#helperClasses">5. Helper Classes</a>
<ul class="sectlevel2">
<li><a href="#securityTagLib">5.1. SecurityTagLib</a></li>
<li><a href="#springSecurityService">5.2. SpringSecurityService</a></li>
<li><a href="#springSecurityUtils">5.3. SpringSecurityUtils</a></li>
</ul>
</li>
<li><a href="#events">6. Events</a>
<ul class="sectlevel2">
<li><a href="#eventNotification">6.1. Event Notification</a></li>
<li><a href="#registeringEventListener">6.2. Registering an Event Listener</a></li>
<li><a href="#registeringCallbackClosures">6.3. Registering Callback Closures</a></li>
</ul>
</li>
<li><a href="#domainClassProperties">7. User, Authority (Role), and Requestmap Properties</a></li>
<li><a href="#authentication">8. Authentication</a>
<ul class="sectlevel2">
<li><a href="#basicAndDigestAuth">8.1. Basic and Digest Authentication</a></li>
<li><a href="#x509">8.2. Certificate (X.509) Login Authentication</a></li>
<li><a href="#rememberMeCookie">8.3. Remember-Me Cookie</a></li>
<li><a href="#ajax">8.4. Ajax Authentication</a></li>
</ul>
</li>
<li><a href="#authenticationProviders">9. Authentication Providers</a></li>
<li><a href="#userDetailsService">10. Custom UserDetailsService</a>
<ul class="sectlevel2">
<li><a href="#flushing-the-cached-authentication">10.1. Flushing the Cached Authentication</a></li>
</ul>
</li>
<li><a href="#passwords">11. Password and Account Protection</a>
<ul class="sectlevel2">
<li><a href="#hashing">11.1. Password Hashing</a></li>
<li><a href="#salt">11.2. Salted Passwords</a></li>
<li><a href="#locking">11.3. Account Locking and Forcing Password Change</a></li>
</ul>
</li>
<li><a href="#urlProperties">12. URL Properties</a></li>
<li><a href="#hierarchicalRoles">13. Hierarchical Roles</a>
<ul class="sectlevel2">
<li><a href="#persistent-role-hierarchy">13.1. Persistent role hierarchy</a></li>
</ul>
</li>
<li><a href="#switchUser">14. Switch User</a>
<ul class="sectlevel2">
<li><a href="#switching-to-another-user">14.1. Switching to Another User</a></li>
<li><a href="#switching-back-to-original-user">14.2. Switching Back to Original User</a></li>
<li><a href="#customizing-urls">14.3. Customizing URLs</a></li>
<li><a href="#gsp-code">14.4. GSP Code</a></li>
</ul>
</li>
<li><a href="#filters">15. Filters</a>
<ul class="sectlevel2">
<li><a href="#default-approach-to-configuring-filter-chains">15.1. Default Approach to Configuring Filter Chains</a></li>
<li><a href="#filternames">15.2. filterNames</a></li>
<li><a href="#chainmap">15.3. chainMap</a></li>
<li><a href="#clientregisterfilter">15.4. clientRegisterFilter</a></li>
</ul>
</li>
<li><a href="#channelSecurity">16. Channel Security</a>
<ul class="sectlevel2">
<li><a href="#header-checking">16.1. Header checking</a></li>
</ul>
</li>
<li><a href="#ip">17. IP Address Restrictions</a></li>
<li><a href="#sessionFixation">18. Session Fixation Prevention</a></li>
<li><a href="#logoutHandlers">19. Logout Handlers</a></li>
<li><a href="#voters">20. Voters</a></li>
<li><a href="#miscProperties">21. Miscellaneous Properties</a></li>
<li><a href="#tutorials">22. Tutorials</a>
<ul class="sectlevel2">
<li><a href="#usingControllerAnnotations">22.1. Using Controller Annotations to Secure URLs</a></li>
</ul>
</li>
<li><a href="#examples">23. Example Applications</a>
<ul class="sectlevel2">
<li><a href="#the-repos">23.1. The Repos</a></li>
<li><a href="#the-example-apps">23.2. The Example Apps</a></li>
</ul>
</li>
<li><a href="#controllerMethods">24. Controller Methods</a>
<ul class="sectlevel2">
<li><a href="#isloggedin-2">24.1. isLoggedIn</a></li>
<li><a href="#getprincipal-2">24.2. getPrincipal</a></li>
<li><a href="#getauthenticateduser">24.3. getAuthenticatedUser</a></li>
</ul>
</li>
<li><a href="#i18n">25. Internationalization</a></li>
<li><a href="#scripts">26. Scripts</a>
<ul class="sectlevel2">
<li><a href="#s2-quickstart">26.1. s2-quickstart</a></li>
<li><a href="#s2-create-persistent-token">26.2. s2-create-persistent-token</a></li>
<li><a href="#s2-create-role-hierarchy-entry">26.3. s2-create-role-hierarchy-entry</a></li>
</ul>
</li>
<li><a href="#debugging">27. Debugging</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">1. Introduction to the Spring Security Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Security plugin simplifies the integration of <a href="https://projects.spring.io/spring-security/">Spring Security</a> into Grails applications. The plugin provides sensible defaults with many configuration options for customization. Nearly everything is configurable or replaceable in the plugin and in Spring Security itself, which makes extensive use of interfaces.</p>
</div>
<div class="paragraph">
<p>This guide documents configuration defaults and describes how to configure and extend the Spring Security plugin for Grails applications.</p>
</div>
<div class="sect2">
<h3 id="release-history-and-acknowledgment">1.1. Release History and Acknowledgment</h3>
<div class="ulist">
<ul>
<li>
<p>Please check <a href="https://github.com/grails/grails-spring-security-core">GitHub Release Page</a> for recent release history</p>
</li>
<li>
<p>October 16, 2020</p>
<div class="ulist">
<ul>
<li>
<p>4.0.3</p>
</li>
</ul>
</div>
</li>
<li>
<p>July 17, 2020</p>
<div class="ulist">
<ul>
<li>
<p>4.0.2</p>
</li>
</ul>
</div>
</li>
<li>
<p>July 13, 2020</p>
<div class="ulist">
<ul>
<li>
<p>4.0.1</p>
</li>
</ul>
</div>
</li>
<li>
<p>February 27, 2020</p>
<div class="ulist">
<ul>
<li>
<p>4.0.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>May 25, 2019</p>
<div class="ulist">
<ul>
<li>
<p>4.0.0.RC2 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>May 13, 2019</p>
<div class="ulist">
<ul>
<li>
<p>4.0.0.RC1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>April 8, 2019</p>
<div class="ulist">
<ul>
<li>
<p>4.0.0.M1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>Jul 24, 2018</p>
<div class="ulist">
<ul>
<li>
<p>3.2.3 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>Jun 24, 2018</p>
<div class="ulist">
<ul>
<li>
<p>3.2.2 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>Feb 13, 2018</p>
<div class="ulist">
<ul>
<li>
<p>3.2.1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>Sep 26, 2017</p>
<div class="ulist">
<ul>
<li>
<p>3.2.0 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>May 18, 2017</p>
<div class="ulist">
<ul>
<li>
<p>3.2.0.M1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>April 22, 2017</p>
<div class="ulist">
<ul>
<li>
<p>3.1.2 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>May 10, 2016</p>
<div class="ulist">
<ul>
<li>
<p>3.1.1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>May 10, 2016</p>
<div class="ulist">
<ul>
<li>
<p>3.1.0 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>March 21, 2016</p>
<div class="ulist">
<ul>
<li>
<p>3.0.4 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>January 10, 2016</p>
<div class="ulist">
<ul>
<li>
<p>3.0.3 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>January 6, 2016</p>
<div class="ulist">
<ul>
<li>
<p>3.0.2 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>December 31, 2015</p>
<div class="ulist">
<ul>
<li>
<p>3.0.1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>December 8, 2015</p>
<div class="ulist">
<ul>
<li>
<p>3.0.0 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>November 23, 2015</p>
<div class="ulist">
<ul>
<li>
<p>3.0.0.M2 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>August 14, 2015</p>
<div class="ulist">
<ul>
<li>
<p>3.0.0.M1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>June 4, 2015</p>
<div class="ulist">
<ul>
<li>
<p>2.0-RC5 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>July 8, 2014</p>
<div class="ulist">
<ul>
<li>
<p>2.0-RC4 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>May 19, 2014</p>
<div class="ulist">
<ul>
<li>
<p>2.0-RC3 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>October 4, 2013</p>
<div class="ulist">
<ul>
<li>
<p>2.0-RC2 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/issues/?jql=project%20%3D%20GPSPRINGSECURITYCORE%20AND%20fixVersion%20%3D%20%22Grails-Spring-Security-Core%202.0%22%20ORDER%20BY%20updated%20DESC%2C%20priority%20DESC%2C%20created%20ASC">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>October 3, 2013</p>
<div class="ulist">
<ul>
<li>
<p>2.0-RC1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>April 6, 2012</p>
<div class="ulist">
<ul>
<li>
<p>1.2.7.3 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=13100">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>February 2, 2012</p>
<div class="ulist">
<ul>
<li>
<p>1.2.7.2 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=13062">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>January 18, 2012</p>
<div class="ulist">
<ul>
<li>
<p>1.2.7.1 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=13051">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>December 30, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.2.7 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=13025">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>December 2, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.2.6 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=13024">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>December 1, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.2.5 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>October 18, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.2.4 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>October 15, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.2.3 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>October 15, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.2.2 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=12907">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>August 17, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.2.1 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=12811">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>July 31, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.2 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=12503">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>May 23, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.1.3 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=12502">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>February 26, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.1.2 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>February 26, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.1.1 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=11909">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>August 8, 2010</p>
<div class="ulist">
<ul>
<li>
<p>1.1 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=11908">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>August 1, 2010</p>
<div class="ulist">
<ul>
<li>
<p>1.0.1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>July 27, 2010</p>
<div class="ulist">
<ul>
<li>
<p>1.0 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=11907">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>July 16, 2010</p>
<div class="ulist">
<ul>
<li>
<p>0.4.2 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=11906">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>June 29, 2010</p>
<div class="ulist">
<ul>
<li>
<p>0.4.1 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=11905">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>June 21, 2010</p>
<div class="ulist">
<ul>
<li>
<p>0.4 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=11904">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>May 12, 2010</p>
<div class="ulist">
<ul>
<li>
<p>0.3.1 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=11903">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>May 12, 2010</p>
<div class="ulist">
<ul>
<li>
<p>0.3 release</p>
</li>
<li>
<p><a href="http://jira.grails.org/secure/ReleaseNote.jspa?projectId=10229&amp;version=11902">JIRA Issues</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>May 2, 2010</p>
<div class="ulist">
<ul>
<li>
<p>0.2 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>April 27, 2010</p>
<div class="ulist">
<ul>
<li>
<p>initial 0.1 release</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This plugin is based on work done for the <a href="https://grails.org/plugin/acegi/">Acegi</a> plugin by Tsuyoshi Yamamoto.</p>
</div>
</div>
<div class="sect2">
<h3 id="configGroovy">1.2. Configuration Settings</h3>
<div class="paragraph">
<p>The Spring Security plugin maintains its configuration in <code>grails-app/conf/application.groovy</code>, although you can keep the plugin config in <code>application.yml</code> with the rest of the configuration if you prefer. Default values are in the plugin&#8217;s <code>grails-app/conf/DefaultSecurityConfig.groovy</code> file, and you add application-specific values to <code>application.groovy</code> (or <code>application.yml</code>). The default configuration is merged with your settings, with application values overriding the defaults and setting missing values.</p>
</div>
<div class="paragraph">
<p>This structure enables environment-specific configuration such as, for example, fewer structure-restrictive security rules during development than in production. Like any environment-specific configuration parameters, you wrap them in an <code>environments</code> block.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The plugin&#8217;s configuration values all start with <code>grails.plugin.springsecurity</code> to distinguish them from similarly named options in Grails and from other plugins. You must specify all property overrides with the <code>grails.plugin.springsecurity</code> prefix. For example, you specify the attribute <code>password.algorithm</code> as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.password.algorithm = 'bcrypt'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using cxf grails plugin in your app then move the cxf dependency above this plugin i.e.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">dependencies {
    implementation 'org.grails.plugins:cxf:3.1.1'
    // CXF above security.
    implementation 'org.grails.plugins:spring-security-core:{stableversion}'
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="gettingStarted">1.3. Getting Started</h3>
<div class="paragraph">
<p>Once you install the plugin, you simply run the initialization script, <a href="#s2-quickstart">s2-quickstart</a>, and make any required configuration changes in <code>application.groovy</code> / <code>application.yml</code>. The plugin registers its servlet API configuration (the Spring Security filter chain, etc.) programmatically, not in <code>web.xml</code> as was the case in earlier versions, and also configures the Spring beans in the application context that implement various pieces of functionality. Dependency management determines which jar files to use.</p>
</div>
<div class="paragraph">
<p>To get started using the Spring Security plugin with your Grails application, see <a href="#tutorials">Tutorials</a>.</p>
</div>
<div class="paragraph">
<p>You do not need deep knowledge of Spring Security to use the plugin, but it is helpful to understand the underlying implementation. See <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/reference/htmlsingle/">the Spring Security documentation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="whatsNew">2. What&#8217;s New</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="newInV5">2.1. What&#8217;s New in Version 5.0.0</h3>
<div class="paragraph">
<p>Version 5.x of the plugin requires Grails 5 or later; this version also updates to Spring Security Core version 5.6.1. We recommend you to check more details about what&#8217;s new in Spring Security 5.6 at <a href="https://docs.spring.io/spring-security/reference/whats-new.html" class="bare">https://docs.spring.io/spring-security/reference/whats-new.html</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="newInV401">2.2. What&#8217;s New in Version 4.0.1</h3>
<div class="sect3">
<h4 id="default-securitycontextholder-strategy">2.2.1. Default SecurityContextHolder strategy</h4>
<div class="paragraph">
<p>Version 4.0.1 of the plugin switched back to <code>"MODE_THREADLOCAL"</code> as the default strategy. This means that newly created threads do not inherit the security context of the parent thread.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="newInV4">2.3. What&#8217;s New in Version 4.0</h3>
<div class="paragraph">
<p>Version 4.x of the plugin requires Grails 4 or higher; to use the plugin in Grails 2 or 3 applications use the latest 3.3.x, 3.2.x or 2.x.x version of the plugin.</p>
</div>
<div class="paragraph">
<p>In general, using the Spring Security plugin in Grails 4 is nearly identical to using it in Grails 2, other than obvious differences under the hood such as no longer using <code>web.xml</code>. The configuration settings are the same, and the processes for customizing how things work (changing settings, overriding and customizing Spring beans, etc.) are generally the same. There were no package or configuration name changes, so customizations and extensions should continue to work. The plugin now uses Spring Security 5 (currently 5.1.13.RELEASE), but the changes required were primarily internal and don&#8217;t affect usage. There are new features in Spring Security 5 however, and the plugin will be updated in future releases to take advantage of those.</p>
</div>
<div class="paragraph">
<p>Spring Security 5 changed the way passwords are encoded and compared for matches. Formerly a salt was passed into the encoder when calling encode for the password.
To upgrade, you must migrate your password database data first to look like so by putting the salt in curly brackets before the password:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{bcrypt}someencryptedpassword   // using bcrypt
{noop}plaintextpassword         // using plain text</pre>
</div>
</div>
<div class="paragraph">
<p>This allows Spring Security to automatically figure out which algorithm class to use with DelegatingPasswordEncoder <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/crypto/password/DelegatingPasswordEncoder.html" class="bare">https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/crypto/password/DelegatingPasswordEncoder.html</a>.</p>
</div>
<div class="paragraph">
<p>Refer to the links below for more information on upgrading:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.baeldung.com/spring-security-5-password-storage" class="bare">https://www.baeldung.com/spring-security-5-password-storage</a></p>
</li>
<li>
<p><a href="https://dzone.com/articles/password-encoder-migration-with-spring-security-5" class="bare">https://dzone.com/articles/password-encoder-migration-with-spring-security-5</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you don&#8217;t migrate your password data, you will see exceptions like "There is no PasswordEncoder mapped for the id “null”". Keep in mind you might have to fix tests as well that aren&#8217;t encoding passwords.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are a few breaking changes. Anywhere you use the passwordEncoder bean it has new parameter to initialize it. The same is password matching, the new method is now <code>matches(CharSequence rawPassword, String prefixEncodedPassword)</code>.
See <code>SpringSecurityCoreGrailsPlugin.groovy</code> for more information on initializing the bean if you need to override it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="installation">2.3.1. Installation</h4>
<div class="sect4">
<h5 id="grails-4-0-x">Grails 4.0.x</h5>
<div class="paragraph">
<p>The &#8220;installation&#8221; process has changed in version 3+ of the plugin, but they&#8217;re the same as for any Grails 3 plugin. Simply add an entry in the <code>dependencies</code> block of your <code>build.gradle</code> file, changing the version as needed:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.gradle</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">dependencies {
   ...
   implementation 'org.grails.plugins:spring-security-core:6.0.-1'
   ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Version 4.0.x is only compatible with Grails 4.0.x or higher.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Snapshots are published automatically to <a href="https://oss.jfrog.org/">Artifactory OSS</a> on every successful build. To use them:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.gradle</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">repositories {
  ...
  maven { url "https://oss.jfrog.org/artifactory/oss-snapshot-local" }
}
dependencies {
   ...
   compile 'org.grails.plugins:spring-security-core:6.0.0-SNAPSHOT'
   ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="grails-3-0-x-3-1-x-3-2-x">Grails 3.0.x, 3.1.x, 3.2.x</h5>
<div class="paragraph">
<p>For previous Grails 3 versions ( 3.0.x, 3.1.x and 3.2.x ) use:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.gradle</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">dependencies {
   ...
   compile 'org.grails.plugins:spring-security-core:3.1.2'
   ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the <a href="#s2-quickstart">s2-quickstart</a> script to generate domain classes and add the initial configuration settings in <code>application.groovy</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration">2.3.2. Configuration</h4>
<div class="paragraph">
<p>In Grails 2, configuration settings were stored in <code>grails-app/conf/Config.groovy</code>, but they&#8217;re in YAML format in <code>grails-app/conf/application.yml</code> now. You can use the Groovy <code>ConfigObject</code> style if you want, in <code>grails-app/conf/application.groovy</code>. The file isn&#8217;t created by the <code>create-app</code> script but if you create it manually it will be recognized. When you run any of the plugin scripts, settings are added in <code>application.groovy</code> (it will be created if necessary) but if you prefer to keep your settings in YAML format, feel free to move them to <code>application.yml</code>. Note that this won&#8217;t work for values that aren&#8217;t supported in YAML format, for example Closures or other Java or Groovy objects.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="newInV321">2.4. What&#8217;s New in Version 3.2.1</h3>
<div class="sect3">
<h4 id="default-securitycontextholder-strategy-2">2.4.1. Default SecurityContextHolder strategy</h4>
<div class="paragraph">
<p>Version 3.2.1 of the plugin now uses <code>"MODE_INHERITABLETHREADLOCAL"</code> as the default strategy. This means that newly created threads inherit the security context of the parent thread.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Beware when using thread pools. Threads keep the security context they inherit when the thread is created the first time. The context isn&#8217;t updated when the thread is reused for a different task.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="newInV3">2.5. What&#8217;s New in Version 3.0</h3>
<div class="paragraph">
<p>Version 3.x of the plugin requires Grails 3 or higher; to use the plugin in Grails 2 applications use the latest 2.x.x version of the plugin.</p>
</div>
<div class="paragraph">
<p>In general, using the Spring Security plugin in Grails 3 is nearly identical to using it in Grails 2, other than obvious differences under the hood such as no longer using <code>web.xml</code>. The configuration settings are the same, and the processes for customizing how things work (changing settings, overriding and customizing Spring beans, etc.) are generally the same. There were no package or configuration name changes, so customizations and extensions should continue to work. The plugin now uses Spring Security 4 (currently 4.0.3.RELEASE), but the changes required were primarily internal and don&#8217;t affect usage. There are new features in Spring Security 4 however, and the plugin will be updated in future releases to take advantage of those.</p>
</div>
<div class="paragraph">
<p>Spring Security 4 changed the default URLs and parameter names for login, logout, switch-user, etc. This is handled by the plugin for you and is usually transparent, but you should be aware of the changes if you want to customize the filters or GSPs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/j_spring_security_check</code> (the <code>apf.filterProcessesUrl</code> config setting) changed to <code>/login/authenticate</code></p>
</li>
<li>
<p><code>/j_username</code> (the <code>apf.usernameParameter</code> and <code>switchUser.usernameParameter</code> config settings) changed to <code>username</code></p>
</li>
<li>
<p><code>/j_password</code> (the <code>apf.passwordParameter</code> config setting) changed to <code>password</code></p>
</li>
<li>
<p><code>/j_spring_security_logout</code> (the <code>logout.filterProcessesUrl</code> config setting) changed to <code>/logoff</code></p>
<div class="ulist">
<ul>
<li>
<p>In Spring Security 4 the value is actually <code>/logout</code>, but that conflicts with the standard <code>LogoutController</code> url, so the plugin uses <code>/logoff</code> instead</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>_spring_security_remember_me</code> (the <code>rememberMe.parameter</code> config setting) changed to <code>remember-me</code></p>
</li>
<li>
<p><code>/j_spring_security_switch_user</code> (the <code>switchUser.switchUserUrl</code> config setting) changed to <code>/login/impersonate</code></p>
</li>
<li>
<p><code>/j_spring_security_exit_user</code> (the <code>switchUser.exitUserUrl</code> config setting) changed to <code>/logout/impersonate</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the 2.x.x plugin was written primarily in Java, with Groovy used only for dynamic calls, but in version 3 all Java classes were converted to Groovy with the <code>@CompileStatic</code> annotation. Java was used because Spring Security is configured as a chain of servlet filters that fire for every request (including static resources) and the cumulative cost of many small Groovy performance hits can be non-trivial. But with <code>@CompileStatic</code> we get the best of both worlds - Java performance, and Groovy compactness. If you&#8217;re curious you can see these changes <a href="https://github.com/grails/grails-spring-security-core/commit/da06fa44d8bbea0ff374dd31b1c6b28426bdf7b4">in this GitHub commit</a>.</p>
</div>
<div class="paragraph">
<p>Also, since Grails 3 no longer supports Gant scripts, the plugin&#8217;s scripts were converted to the newer approach. This should have no effect on usage as the calling syntax and results are the same as before, although the console output looks somewhat different. You can see these changes <a href="https://github.com/grails/grails-spring-security-core/commit/16484f44fe25a6f1c8687b8e27db6f08ed871436">in this GitHub commit</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are a few breaking configuration changes as of version 3.0.0.M2. Prior to that version, some configuration properties were specified as a <code>Map</code> where the keys and values were both data. This caused various problems, primarily due to period characters in map keys. There are now no configuration properties that are single maps; all have been converted to lists of single-entry maps. This includes <code>controllerAnnotations.staticRules</code> and <code>interceptUrlMap</code> (see <a href="#requestMappings">Configuring Request Mappings to Secure URLs</a>), <code>ipRestrictions</code> (see <a href="#ip">IP Address Restrictions</a>), <code>filterChain.chainMap</code> (see <a href="#filters">Filters</a>), <code>secureChannel.definition</code> (see <a href="#channelSecurity">Channel Security</a>), and <code>failureHandler.exceptionMappings</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="installation-2">2.5.1. Installation</h4>
<div class="sect4">
<h5 id="grails-3-3-x">Grails 3.3.x</h5>
<div class="paragraph">
<p>The &#8220;installation&#8221; process has changed in version 3+ of the plugin, but they&#8217;re the same as for any Grails 3 plugin. Simply add an entry in the <code>dependencies</code> block of your <code>build.gradle</code> file, changing the version as needed:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.gradle</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">dependencies {
   ...
   implementation 'org.grails.plugins:spring-security-core:6.0.-1'
   ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Version 3.2.x is only compatible with Grails 3.3.x or higher.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Snapshots are published automatically to <a href="https://oss.jfrog.org/">Artifactory OSS</a> on every successful build. To use them:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.gradle</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">repositories {
  ...
  maven { url "https://oss.jfrog.org/artifactory/oss-snapshot-local" }
}
dependencies {
   ...
   compile 'org.grails.plugins:spring-security-core:6.0.0-SNAPSHOT'
   ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="grails-3-0-x-3-1-x-3-2-x-2">Grails 3.0.x, 3.1.x, 3.2.x</h5>
<div class="paragraph">
<p>For previous Grails 3 versions ( 3.0.x, 3.1.x and 3.2.x ) use:</p>
</div>
<div class="listingblock">
<div class="title"><code>build.gradle</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">dependencies {
   ...
   compile 'org.grails.plugins:spring-security-core:3.1.2'
   ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the <a href="#s2-quickstart">s2-quickstart</a> script to generate domain classes and add the initial configuration settings in <code>application.groovy</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration-2">2.5.2. Configuration</h4>
<div class="paragraph">
<p>In Grails 2, configuration settings were stored in <code>grails-app/conf/Config.groovy</code>, but they&#8217;re in YAML format in <code>grails-app/conf/application.yml</code> now. You can use the Groovy <code>ConfigObject</code> style if you want, in <code>grails-app/conf/application.groovy</code>. The file isn&#8217;t created by the <code>create-app</code> script but if you create it manually it will be recognized. When you run any of the plugin scripts, settings are added in <code>application.groovy</code> (it will be created if necessary) but if you prefer to keep your settings in YAML format, feel free to move them to <code>application.yml</code>. Note that this won&#8217;t work for values that aren&#8217;t supported in YAML format, for example Closures or other Java or Groovy objects.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="newInV2">2.6. What&#8217;s New in Version 2.0</h3>
<div class="paragraph">
<p>There are many changes in the 2.x versions of the plugin from the older approaches in 1.x.</p>
</div>
<div class="sect3">
<h4 id="package-changes">2.6.1. Package changes</h4>
<div class="paragraph">
<p>All classes are now in the <code>grails.plugin.springsecurity</code> package or a subpackage. The names tend to correspond to the analagous Spring Security classes where appropriate, for example <code>MutableLogoutFilter</code> is in the <code>grails.plugin.springsecurity.web.authentication.logout</code> package to correspond with the <code>org.springframework.security.web.authentication.logout</code> package.</p>
</div>
<div class="paragraph">
<p>Some of the changes were more subtle though; for example all classes in the old <code>grails.plugins.springsecurity</code> packages and subpackages are now in <code>grails.plugin.springsecurity</code>, only one character different. This will result in a non-trivial upgrade process for your applications, but that is a benefit as it will hopefully point you at other important changes you might have otherwise missed.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration-prefix-changes">2.6.2. Configuration prefix changes</h4>
<div class="paragraph">
<p>The prefix used in <code>Config.groovy</code> for the plugin&#8217;s configuration settings has changed from <code>grails.plugins.springsecurity</code> to <code>grails.plugin.springsecurity</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="more-aggressively-secure-by-default">2.6.3. More aggressively secure by default</h4>
<div class="paragraph">
<p>In 1.x it was assumed that defaulting pages to not be secured, and configuring guarded URLs as needed, was a more pragmatic approach. Now however, all URLs are initially blocked unless there is a request mapping rule, even if that rule allows all access. The assumption behind this change is that if you forget to guard a new URL, it can take a long time to discover that users had access, whereas if you forget to open access for allowed users when using the &#8220;pessimistic&#8221; approach, nobody can access the URL and the error will be quickly discovered. This approach is more work, but much safer.</p>
</div>
<div class="paragraph">
<p>This is described in more detail in <a href="#requestMappings">Configuring Request Mappings to Secure URLs</a>.</p>
</div>
<div class="sect4">
<h5 id="logout-post-only">Logout POST only</h5>
<div class="paragraph">
<p>By default only POST requests are allowed to trigger a logout. To allow GET access, add this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.logout.postOnly = false</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bcrypt-by-default">bcrypt by default</h5>
<div class="paragraph">
<p>The default password hashing algorithm is now <a href="https://en.wikipedia.org/wiki/Bcrypt">bcrypt</a> since it is a very robust hashing approach. <a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a> is similar and is also supported. You  can still use any message digest algorithm that is supported in your JDK; see <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html">this Java page</a> for the available algorithms.</p>
</div>
<div class="paragraph">
<p>New applications should use bcrypt or PBKDF2, but if you didn&#8217;t change the default settings in previous versions of the plugin and want to continue using the same algorithm, use these settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.password.algorithm = 'SHA-256'
grails.plugin.springsecurity.password.hash.iterations = 1</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="session-fixation-prevention-by-default">Session Fixation Prevention by default</h5>
<div class="paragraph">
<p>Session Fixation Prevention is now enabled by default, but can be disabled with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.useSessionFixationPrevention = false</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="secured-annotation">2.6.4. @Secured annotation</h4>
<div class="paragraph">
<p>As of Grails 2.0, controller actions can be defined as closures or methods, with methods being preferred. The @Secured annotation no longer supports being defined on controller action closures, so you will need to convert them to real methods.</p>
</div>
<div class="paragraph">
<p>You can also specify the HTTP method that an annotation is defined for (e.g. when using REST). When doing this you must explicitly name the <code>value</code> attribute, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Secured(value=["hasRole('ROLE_ADMIN')"], httpMethod='POST')
def someMethod() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, you can define a closure in the annotation which will be called during access checking. The closure must return <code>true</code> or <code>false</code> and has all of the methods and properties that are available when using SpEL expressions, since the closure&#8217;s <code>delegate</code> is set to a subclass of <code>WebSecurityExpressionRoot</code>, and also the Spring <code>ApplicationContext</code> as the <code>ctx</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Secured(closure = {
   assert request
   assert ctx
   authentication.name == 'admin1'
})
def someMethod() { ... }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="anonymous-authentication">2.6.5. Anonymous authentication</h4>
<div class="paragraph">
<p>In standard Spring Security and older versions of the plugin, there is support for an &#8220;anonymous&#8221; authentication. This is implemented by a filter that registers a simple <code>Authentication</code> in the <code>SecurityContext</code> to remove the need for null checks, since there will always be an <code>Authentication</code> available. This approach is still problematic though because the Principal of the anonymous authentication is a String, whereas it is a <code>UserDetails</code> instance when there is a non-anonymous authentication.</p>
</div>
<div class="paragraph">
<p>Since you still have to be careful to differentiate between anonymous and non-anonymous authentications, the plugin now creates an anonymous <code>Authentication</code> which will be an instance of <code>grails.plugin.springsecurity.authentication.GrailsAnonymousAuthenticationToken</code> with a standard <code>org.springframework.security.core.userdetails.User</code> instance as its Principal. The authentication will have a single granted role, <code>ROLE_ANONYMOUS</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="no-hql">2.6.6. No HQL</h4>
<div class="paragraph">
<p>Some parts of the code used HQL queries, for example in the generated <code>UserRole</code> class and in <code>SpringSecurityService.findRequestmapsByRole</code>. These have been replaced  by &#8220;where&#8221; queries to make data access more portable across GORM implementatioins.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-in-generated-classes">2.6.7. Changes in generated classes</h4>
<div class="paragraph">
<p>The <code>enabled</code> property in the generated <code>User</code> class now defaults to <code>true</code>. This will make creating instances a bit more DRY:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def u = new User(username: 'me', password: 'itsasecret').save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer the old approach, change your generated class.</p>
</div>
<div class="paragraph">
<p>Also, the plugin includes the <code>grails.plugin.springsecurity.LoginController.groovy</code> and <code>grails.plugin.springsecurity.LogoutController.groovy</code> controllers, and <code>grails-app/views/auth.gsp</code> and <code>grails-app/views/denied.gsp</code> GSPs. If you had no need previously to change these you can delete your files and the plugins' files will be used instead. If you do want to change them, copy each as needed to your application and make the required changes, and yours will be used instead.</p>
</div>
<div class="paragraph">
<p>One small change is that there is no longer a default value for the domain class name properties (<code>userLookup.userDomainClassName</code>, <code>authority.className</code>, <code>requestMap.className</code>, <code>rememberMe.persistentToken.domainClassName</code>). This was of little use and tended to cause confusing error messages when there was a misconfiguration.</p>
</div>
</div>
<div class="sect3">
<h4 id="securitycontextholder-strategy">2.6.8. SecurityContextHolder strategy</h4>
<div class="paragraph">
<p>You can now define the <code>SecurityContextHolder</code> strategy. By default it is stored in a <code>ThreadLocal</code>, but you can also configure it to use an <code>InheritableThreadLocal</code> to maintain the context in new threads, or a custom class that implements the <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/context/SecurityContextHolderStrategy.html">SecurityContextHolderStrategy</a> interface. To change the strategy, set the <code>grails.plugin.springsecurity.sch.strategyName</code> config property to <code>"MODE_THREADLOCAL"</code> (the default) to use a <code>ThreadLocal</code>, <code>"MODE_INHERITABLETHREADLOCAL"</code> to use an <code>InheritableThreadLocal</code>, or the name of a class that implements <code>SecurityContextHolderStrategy</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="debug-filter">2.6.9. Debug filter</h4>
<div class="paragraph">
<p>You can enable a &#8220;debug&#8221; filter based on the <code>org.springframework.security.config.debug.DebugFilter</code> class. It will log security information at the &#8220;info&#8221; level and can help when debugging configuration issues. This should only be enabled in development mode so consider adding the property that enables it inside an <code>environments</code> block in <code>grails-app/conf/application.yml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">environments:
    development:
        grails:
            logging:
                jul:
                    usebridge: true
            plugin:
                springsecurity:
                    debug:
                        useFilter: true
    production:
        grails:
            logging:
                jul:
                    usebridge: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also add the implementation class name in your logback configuration:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/logback.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">logger 'grails.plugin.springsecurity.web.filter.DebugFilter', INFO, ['STDOUT'], false</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="storing-usernames-in-the-session">2.6.10. Storing usernames in the session</h4>
<div class="paragraph">
<p>In Spring Security 3.0 and earlier, the username was stored in the HTTP session under the key &#8220;SPRING_SECURITY_LAST_USERNAME&#8221;. This no longer done, but the plugin will use the old behavior if the <code>grails.plugin.springsecurity.apf.storeLastUsername</code> setting is set to <code>true</code> (the default is <code>false</code>). Further, the name is no longer escaped before storing, it is stored exactly as entered by the user, so you must escape it when redisplaying to avoid XSS attacks.</p>
</div>
</div>
<div class="sect3">
<h4 id="authorities-annotation">2.6.11. @Authorities annotation</h4>
<div class="paragraph">
<p>You can use the new @Authorities annotation to make your annotations more DRY. See <a href="https://burtbeckwith.com/blog/?p=1398">this blog post</a> for a description about the motivation and implementation details. Note that the package for the annotation in the plugin is <code>grails.plugin.springsecurity.annotation</code>, not <code>grails.plugins.springsecurity.annotation</code> as described in the blog post.</p>
</div>
</div>
<div class="sect3">
<h4 id="miscellaneous-changes">2.6.12. Miscellaneous changes</h4>
<div class="sect4">
<h5 id="authenticationdetailssource">AuthenticationDetailsSource</h5>
<div class="paragraph">
<p>Previously you could configure the details class that was constructed by the <code>authenticationDetailsSource</code> bean by setting the <code>authenticationDetails.authClass</code> property. In Spring Security 3.2 this isn&#8217;t possible because <code>WebAuthenticationDetailsSource</code> always returns a <code>WebAuthenticationDetails</code>. But you can still customize the details class by creating a class that implements the <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/AuthenticationDetailsSource.html">AuthenticationDetailsSource</a> interface, e.g.:</p>
</div>
<div class="listingblock">
<div class="title"><code>MyAuthenticationDetailsSource.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany

import javax.servlet.http.HttpServletRequest

import org.springframework.security.authentication.AuthenticationDetailsSource

class MyAuthenticationDetailsSource implements AuthenticationDetailsSource&lt;HttpServletRequest, MyWebAuthenticationDetails&gt; {

   MyWebAuthenticationDetails buildDetails(HttpServletRequest context) {
      // build a MyWebAuthenticationDetails
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and registering that as the <code>authenticationDetailsSource</code> bean in <code>resources.groovy</code></p>
</div>
<div class="listingblock">
<div class="title"><code>resources.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import com.mycompany.MyAuthenticationDetailsSource

beans = {
   authenticationDetailsSource(MyAuthenticationDetailsSource) {
      // any required properties
   }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="domainClasses">3. Domain Classes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default the plugin uses regular Grails domain classes to access its required data. It&#8217;s easy to create your own user lookup code though, which can access a database or any other source to retrieve user and authority data. See <a href="#userDetailsService">Custom UserDetailsService</a> for how to implement this.</p>
</div>
<div class="paragraph">
<p>To use the standard user lookup you&#8217;ll need at a minimum a &#8220;person&#8221; and an &#8220;authority&#8221; domain class. In addition, if you want to store URL &lt;==&gt; Role mappings in the database (this is one of multiple approaches for defining the mappings) you need a &#8220;requestmap&#8221; domain class. If you use the recommended approach for mapping the many-to-many relationship between &#8220;person&#8221; and &#8220;authority&#8221;, you also need a domain class to map the join table.</p>
</div>
<div class="paragraph">
<p>To use the user/group lookup you&#8217;ll also need a &#8220;group&#8221; domain class. If you are using the recommended approach for mapping many-to-many relationship between &#8220;person&#8221; and &#8220;group&#8221; and between &#8220;group&#8221; and &#8220;authority&#8221; you&#8217;ll need a domain class for each to map the join tables. You can still additionally use &#8220;requestmap&#8221; with this approach.</p>
</div>
<div class="paragraph">
<p>The <a href="#s2-quickstart">s2-quickstart</a> script creates initial domain classes for you. You specify the package and class names, and it creates the corresponding domain classes. After that you can customize them as you like. You can add additional properties, methods, and so on, as long as the core security-related functionality remains.</p>
</div>
<div class="sect2">
<h3 id="personClass">3.1. Person Class</h3>
<div class="paragraph">
<p>Spring Security uses an <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/Authentication.html">Authentication</a> object to determine whether the current user is allowed to perform a secured action, such as accessing a URL, manipulating a secured domain object, invoking a secured method, and so on. This object is created during login. Typically overlap occurs between the need for authentication data and the need to represent a user in the application in ways that are unrelated to security. The mechanism for populating the authentication is completely pluggable in Spring Security; you only need to provide an implementation of <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/userdetails/UserDetailsService.html">UserDetailsService</a> and implement its one method, <code>loadUserByUsername(String username)</code>.</p>
</div>
<div class="paragraph">
<p>By default the plugin uses a Grails &#8220;person&#8221; domain class to manage this data. <code>username</code>, <code>enabled</code>, and <code>password</code> are the default names of the core required properties. You can easily plug in your own implementation (<a href="#userDetailsService">Custom UserDetailsService</a>), and rename the class, package, and properties. In addition, you should define an <code>authorities</code> property to retrieve roles; this can be a property or a <code>getAuthorities()</code> method, and it can be defined through a traditional GORM many-to-many or a custom mapping.</p>
</div>
<div class="paragraph">
<p>Assuming you choose <code>com.mycompany.myapp</code> as your package, and <code>User</code> as your class name, you&#8217;ll generate this class:</p>
</div>
<div class="listingblock">
<div class="title"><code>User.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import groovy.transform.EqualsAndHashCode
import groovy.transform.ToString
import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
@EqualsAndHashCode(includes='username')
@ToString(includes='username', includeNames=true, includePackage=false)
class User implements Serializable {

	private static final long serialVersionUID = 1

	String username
	String password
	boolean enabled = true
	boolean accountExpired
	boolean accountLocked
	boolean passwordExpired

	Set&lt;Role&gt; getAuthorities() {
		(UserRole.findAllByUser(this) as List&lt;UserRole&gt;)*.role as Set&lt;Role&gt;
	}

	static constraints = {
		password blank: false, password: true
		username blank: false, unique: true
	}

	static mapping = {
		password column: '`password`'
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, you can add other properties such as <code>email</code>, <code>firstName</code>, and <code>lastName</code>, convenience methods, and so on:</p>
</div>
<div class="listingblock">
<div class="title"><code>User.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import groovy.transform.EqualsAndHashCode
import groovy.transform.ToString
import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
@EqualsAndHashCode(includes='username')
@ToString(includes='username', includeNames=true, includePackage=false)
class User implements Serializable {

	private static final long serialVersionUID = 1

	String username
	String password
	boolean enabled = true
    String email <i class="conum" data-value="1"></i><b>(1)</b>
    String firstName <i class="conum" data-value="1"></i><b>(1)</b>
    String lastName <i class="conum" data-value="1"></i><b>(1)</b>
	boolean accountExpired
	boolean accountLocked
	boolean passwordExpired

    def someMethod() { <i class="conum" data-value="2"></i><b>(2)</b>
        ...
    }


	Set&lt;Role&gt; getAuthorities() {
		(UserRole.findAllByUser(this) as List&lt;UserRole&gt;)*.role as Set&lt;Role&gt;
	}

	static constraints = {
		password blank: false, password: true
		username blank: false, unique: true
	}

	static mapping = {
		password column: '`password`'
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Other properties</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Convenience methods</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>getAuthorities()</code> method is analagous to defining <code>static hasMany = [authorities: Authority]</code> in a traditional many-to-many mapping. This way <code>GormUserDetailsService</code> can call <code>user.authorities</code> during login to retrieve the roles without the overhead of a bidirectional many-to-many mapping.</p>
</div>
<div class="paragraph">
<p>The class and property names are configurable using these configuration attributes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. User class property names</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.userDomainClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.usernamePropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;username&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class username property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.passwordPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;password&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class password property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.authoritiesPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;authorities&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class role collection property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.enabledPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;enabled&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class enabled property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.accountExpiredPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;accountExpired&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class account expired property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.accountLockedPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;accountLocked&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class account locked property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.passwordExpiredPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;passwordExpired&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class password expired property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.authorityJoinClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User/Role many-many join class name</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="authorityClass">3.2. Authority Class</h3>
<div class="paragraph">
<p>The Spring Security plugin uses an &#8220;authority&#8221; class to represent a user&#8217;s roles in the application. In general this class restricts URLs to users who have been assigned the required access rights. A user can be granted multiple roles to indicate various access rights in the application, and should have at least one. A basic user who can access only non-restricted resources but can still authenticate is a bit unusual. Spring Security usually functions fine if a user has no granted authorities, but fails in a few places that assume one or more. So if a user authenticates successfully but has no granted roles, the plugin grants the user a &#8220;virtual&#8221; role, <code>ROLE_NO_ROLES</code>. Thus the user satisfies Spring Security&#8217;s requirements but cannot access secure resources, as you would not associate any secure resources with this role.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that you aren&#8217;t required to use roles at all; an application with simple security requirements could use the <code>isAuthenticated()</code> expression for guarded URLs to partition the site&#8217;s URLs into those that are accessible to anyone and those that merely require an authenticated user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Like the &#8220;person&#8221; class, the &#8220;authority&#8221; class has a default name, <code>Authority</code>, and a default name for its one required property, <code>authority</code>.
If you want to use another existing domain class, it simply has to have a property for name. As with the name of the class, the names of the properties can be whatever you want - they&#8217;re specified in <code>grails-app/conf/application.groovy</code>.</p>
</div>
<div class="paragraph">
<p>Assuming you choose <code>com.mycompany.myapp</code> as your package, and <code>Role</code> as your class name, you&#8217;ll generate this class:</p>
</div>
<div class="listingblock">
<div class="title"><code>Role.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import groovy.transform.EqualsAndHashCode
import groovy.transform.ToString
import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
@EqualsAndHashCode(includes='authority')
@ToString(includes='authority', includeNames=true, includePackage=false)
class Role implements Serializable {

	private static final long serialVersionUID = 1

	String authority

	static constraints = {
		authority blank: false, unique: true
	}

	static mapping = {
		cache true
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class and property names are configurable using these configuration attributes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Role class configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authority.className</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role class name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authority.nameField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;authority&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role class role name property</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Role names must start with &#8220;ROLE_&#8221;. This is configurable in Spring Security, but not in the plugin. It would be possible to allow different prefixes, but it&#8217;s important that the prefix not be blank as the prefix is used to differentiate between role names and tokens such as IS_AUTHENTICATED_FULLY/IS_AUTHENTICATED_ANONYMOUSLY/etc., and SpEL expressions.</p>
</div>
<div class="paragraph">
<p>The role names should be primarily an internal implementation detail; if you want to display friendlier names in a UI, it&#8217;s simple to remove the prefix first.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="personAuthorityClass">3.3. PersonAuthority Class</h3>
<div class="paragraph">
<p>The typical approach to mapping the relationship between &#8220;person&#8221; and &#8220;authority&#8221; is a many-to-many. Users have multiple roles, and roles are shared by multiple users. This approach can be problematic in Grails, because a popular role, for example, <code>ROLE_USER</code>, will be granted to many users in your application. GORM uses collections to manage adding and removing related instances and maps many-to-many relationships bidirectionally. Granting a role to a user requires loading all existing users who have that role because the collection is a <code>Set</code>. So even though no uniqueness concerns may exist, Hibernate loads them all to enforce uniqueness. The recommended approach in the plugin is to map a domain class to the join table that manages the many-to-many, and using that to grant and revoke roles to users.</p>
</div>
<div class="paragraph">
<p>Like the other domain classes, this class is generated for you, so you don&#8217;t need to deal with the details of mapping it. Assuming you choose <code>com.mycompany.myapp</code> as your package, and <code>User</code> and <code>Role</code> as your class names, you&#8217;ll generate this class:</p>
</div>
<div class="listingblock">
<div class="title"><code>UserRole.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.gorm.DetachedCriteria
import groovy.transform.ToString

import org.codehaus.groovy.util.HashCodeHelper
import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
@ToString(cache=true, includeNames=true, includePackage=false)
class UserRole implements Serializable {

	private static final long serialVersionUID = 1

	User user
	Role role

	@Override
	boolean equals(other) {
		if (other instanceof UserRole) {
			other.userId == user?.id &amp;&amp; other.roleId == role?.id
		}
	}

    @Override
	int hashCode() {
	    int hashCode = HashCodeHelper.initHash()
        if (user) {
            hashCode = HashCodeHelper.updateHash(hashCode, user.id)
		}
		if (role) {
		    hashCode = HashCodeHelper.updateHash(hashCode, role.id)
		}
		hashCode
	}

	static UserRole get(long userId, long roleId) {
		criteriaFor(userId, roleId).get()
	}

	static boolean exists(long userId, long roleId) {
		criteriaFor(userId, roleId).count()
	}

	private static DetachedCriteria criteriaFor(long userId, long roleId) {
		UserRole.where {
			user == User.load(userId) &amp;&amp;
			role == Role.load(roleId)
		}
	}

	static UserRole create(User user, Role role, boolean flush = false) {
		def instance = new UserRole(user: user, role: role)
		instance.save(flush: flush)
		instance
	}

	static boolean remove(User u, Role r) {
		if (u != null &amp;&amp; r != null) {
			UserRole.where { user == u &amp;&amp; role == r }.deleteAll()
		}
	}

	static int removeAll(User u) {
		u == null ? 0 : UserRole.where { user == u }.deleteAll() as int
	}

	static int removeAll(Role r) {
		r == null ? 0 : UserRole.where { role == r }.deleteAll() as int
	}

	static constraints = {
		role validator: { Role r, UserRole ur -&gt;
			if (ur.user?.id) {
				UserRole.withNewSession {
					if (UserRole.exists(ur.user.id, r.id)) {
						return ['userRole.exists']
					}
				}
			}
		}
	}

	static mapping = {
		id composite: ['user', 'role']
		version false
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The helper methods make it easy to grant or revoke roles. Assuming you have already loaded a user and a role, you grant the role to the user as follows:</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. Granting a role</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">User user = ...
Role role = ...
UserRole.create user, role</code></pre>
</div>
</div>
<div class="paragraph">
<p>Revoking a role is similar:</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Revoking a role</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">User user = ...
Role role = ...
UserRole.remove user, role</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class name is the only configurable attribute:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. UserRole configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.authorityJoinClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User/Role many-many join class name</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="authorityGroupClass">3.4. Group Class</h3>
<div class="paragraph">
<p>The plugin provides you the option of creating an access inheritance level between &#8220;person&#8221; and &#8220;authority&#8221;: the &#8220;group&#8221;. The next three classes you will read about (including this one) are only used in a &#8220;person&#8221;/&#8220;group&#8221;/&#8220;authority&#8221; implementation. Rather than granting authorities directly to a &#8220;person&#8221;, you can create a &#8220;group&#8221;, map authorities to it, and then map a &#8220;person&#8221; to that &#8220;group&#8221;. For applications that have a one or more groups of users who need the same level of access, having one or more &#8220;group&#8221; instances makes managing changes to access levels easier because the authorities that make up that access level are encapsulated in the &#8220;group&#8221;, and a single change will affect all of the users.</p>
</div>
<div class="paragraph">
<p>If you run the <a href="#s2-quickstart">s2-quickstart</a> script with the group name specified and use <code>com.mycompany.myapp</code> as your package and <code>RoleGroup</code> and <code>Role</code> as your class names, you&#8217;ll generate this class:</p>
</div>
<div class="listingblock">
<div class="title"><code>RoleGroup.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import groovy.transform.EqualsAndHashCode
import groovy.transform.ToString
import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
@EqualsAndHashCode(includes='name')
@ToString(includes='name', includeNames=true, includePackage=false)
class RoleGroup implements Serializable {

	private static final long serialVersionUID = 1

	String name

	Set&lt;Role&gt; getAuthorities() {
		(RoleGroupRole.findAllByRoleGroup(this) as List&lt;RoleGroupRole&gt;)*.role as Set&lt;Role&gt;
	}

	static constraints = {
		name blank: false, unique: true
	}

	static mapping = {
		cache true
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When running the <a href="#s2-quickstart">s2-quickstart</a> script with the group name specified, the &#8220;person&#8221; class will be generated differently to accommodate the use of groups. Assuming you use <code>com.mycompany.myapp</code> as your package and <code>User</code> and <code>RoleGroup</code> as your class names, the <code>getAuthorities()</code> method will be generated like so:</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. The generated <code>getAuthorities()</code> method when using role groups</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Set&lt;RoleGroup&gt; getAuthorities() {
	(UserRoleGroup.findAllByUser(this) as List&lt;UserRoleGroup&gt;)*.roleGroup as Set&lt;RoleGroup&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin assumes the attribute <code>authorities</code> will provide the &#8220;authority&#8221; collection for each class, but you can change the property names in <code>grails-app/conf/application.groovy</code>. You also must ensure that the property <code>useRoleGroups</code> is set to <code>true</code> in order for <code>GormUserDetailsService</code> to properly retrieve the <code>authorities</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. RoleGroup configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useRoleGroups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use &#8220;authority group&#8221; implementation when loading user authorities</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authority.groupAuthorityNameField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em> (the <a href="#s2-quickstart">s2-quickstart</a> script uses the name &#8220;authorities&#8221;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RoleGroup class role collection property</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="personAuthorityGroupClass">3.5. PersonGroup Class</h3>
<div class="paragraph">
<p>The typical approach to mapping the relationship between &#8220;person&#8221; and &#8220;group&#8221; is a many-to-many. In a standard implementation, users have multiple roles, and roles are shared by multiple users. In a group implementation, users have multiple groups, and groups are shared by multiple users. For the same reason we would use a join class between &#8220;person&#8221; and &#8220;authority&#8221;, we should use one between &#8220;person&#8221; and &#8220;group&#8221;. Please note that when using groups, there should not be a join class between &#8220;person&#8221; and &#8220;authority&#8221;, since &#8220;group&#8221; resides between the two.</p>
</div>
<div class="paragraph">
<p>If you run the <a href="#s2-quickstart">s2-quickstart</a> script with the group name specified, this class will be generated for you, so you don&#8217;t need to deal with the details of mapping it. Assuming you choose <code>com.mycompany.myapp</code> as your package, and <code>User</code> and <code>RoleGroup</code> as your class names, you&#8217;ll generate this class:</p>
</div>
<div class="listingblock">
<div class="title"><code>UserRoleGroup.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.gorm.DetachedCriteria
import groovy.transform.ToString
import org.codehaus.groovy.util.HashCodeHelper
import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
@ToString(cache=true, includeNames=true, includePackage=false)
class UserRoleGroup implements Serializable {

	private static final long serialVersionUID = 1

	User user
	RoleGroup roleGroup

	@Override
	boolean equals(other) {
		if (other instanceof UserRoleGroup) {
			other.userId == user?.id &amp;&amp; other.roleGroupId == roleGroup?.id
		}
	}

    @Override
	int hashCode() {
	    int hashCode = HashCodeHelper.initHash()
        if (user) {
            hashCode = HashCodeHelper.updateHash(hashCode, user.id)
		}
		if (roleGroup) {
		    hashCode = HashCodeHelper.updateHash(hashCode, roleGroup.id)
		}
		hashCode
	}

	static UserRoleGroup get(long userId, long roleGroupId) {
		criteriaFor(userId, roleGroupId).get()
	}

	static boolean exists(long userId, long roleGroupId) {
		criteriaFor(userId, roleGroupId).count()
	}

	private static DetachedCriteria criteriaFor(long userId, long roleGroupId) {
		UserRoleGroup.where {
			user == User.load(userId) &amp;&amp;
			roleGroup == RoleGroup.load(roleGroupId)
		}
	}

	static UserRoleGroup create(User user, RoleGroup roleGroup, boolean flush = false) {
		def instance = new UserRoleGroup(user: user, roleGroup: roleGroup)
		instance.save(flush: flush)
		instance
	}

	static boolean remove(User u, RoleGroup rg) {
		if (u != null &amp;&amp; rg != null) {
			UserRoleGroup.where { user == u &amp;&amp; roleGroup == rg }.deleteAll()
		}
	}

	static int removeAll(User u) {
		u == null ? 0 : UserRoleGroup.where { user == u }.deleteAll() as int
	}

	static int removeAll(RoleGroup rg) {
		rg == null ? 0 : UserRoleGroup.where { roleGroup == rg }.deleteAll() as int
	}

	static constraints = {
		user validator: { User u, UserRoleGroup ug -&gt;
			if (ug.roleGroup?.id) {
				UserRoleGroup.withNewSession {
					if (UserRoleGroup.exists(u.id, ug.roleGroup.id)) {
						return ['userGroup.exists']
					}
				}
			}
		}
	}

	static mapping = {
		id composite: ['roleGroup', 'user']
		version false
	}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="authorityGroupAuthorityClass">3.6. GroupAuthority Class</h3>
<div class="paragraph">
<p>The typical approach to mapping the relationship between &#8220;group&#8221; and &#8220;authority&#8221; is a many-to-many. In a standard implementation, users have multiple roles, and roles are shared by multiple users. In a group implementation, groups have multiple roles and roles are shared by multiple groups. For the same reason we would use a join class between &#8220;person&#8221; and &#8220;authority&#8221;, we should use one between &#8220;group&#8221; and &#8220;authority&#8221;.</p>
</div>
<div class="paragraph">
<p>If you run the <a href="#s2-quickstart">s2-quickstart</a> script with the group name specified, this class will be generated for you, so you don&#8217;t need to deal with the details of mapping it. Assuming you choose <code>com.mycompany.myapp</code> as your package, and <code>RoleGroup</code> and <code>Role</code> as your class names, you&#8217;ll generate this class:</p>
</div>
<div class="listingblock">
<div class="title"><code>RoleGroupRole.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.gorm.DetachedCriteria
import groovy.transform.ToString

import org.codehaus.groovy.util.HashCodeHelper
import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
@ToString(cache=true, includeNames=true, includePackage=false)
class RoleGroupRole implements Serializable {

	private static final long serialVersionUID = 1

	RoleGroup roleGroup
	Role role

	@Override
	boolean equals(other) {
		if (other instanceof RoleGroupRole) {
			other.roleId == role?.id &amp;&amp; other.roleGroupId == roleGroup?.id
		}
	}

	@Override
	int hashCode() {
	    int hashCode = HashCodeHelper.initHash()
        if (roleGroup) {
            hashCode = HashCodeHelper.updateHash(hashCode, roleGroup.id)
		}
		if (role) {
		    hashCode = HashCodeHelper.updateHash(hashCode, role.id)
		}
		hashCode
	}

	static RoleGroupRole get(long roleGroupId, long roleId) {
		criteriaFor(roleGroupId, roleId).get()
	}

	static boolean exists(long roleGroupId, long roleId) {
		criteriaFor(roleGroupId, roleId).count()
	}

	private static DetachedCriteria criteriaFor(long roleGroupId, long roleId) {
		RoleGroupRole.where {
			roleGroup == RoleGroup.load(roleGroupId) &amp;&amp;
			role == Role.load(roleId)
		}
	}

	static RoleGroupRole create(RoleGroup roleGroup, Role role, boolean flush = false) {
		def instance = new RoleGroupRole(roleGroup: roleGroup, role: role)
		instance.save(flush: flush)
		instance
	}

	static boolean remove(RoleGroup rg, Role r) {
		if (rg != null &amp;&amp; r != null) {
			RoleGroupRole.where { roleGroup == rg &amp;&amp; role == r }.deleteAll()
		}
	}

	static int removeAll(Role r) {
		r == null ? 0 : RoleGroupRole.where { role == r }.deleteAll() as int
	}

	static int removeAll(RoleGroup rg) {
		rg == null ? 0 : RoleGroupRole.where { roleGroup == rg }.deleteAll() as int
	}

	static constraints = {
		role validator: { Role r, RoleGroupRole rg -&gt;
			if (rg.roleGroup?.id) {
				RoleGroupRole.withNewSession {
					if (RoleGroupRole.exists(rg.roleGroup.id, r.id)) {
						return ['roleGroup.exists']
					}
				}
			}
		}
	}

	static mapping = {
		id composite: ['roleGroup', 'role']
		version false
	}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="requestmapClass">3.7. Requestmap Class</h3>
<div class="paragraph">
<p>Optionally, use this class to store request mapping entries in the database instead of defining them with annotations or in <code>application.groovy</code>. This option makes the class configurable at runtime; you can add, remove and edit rules without restarting your application.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Requestmap class configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestMap.className</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestmap class name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestMap.urlField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;url&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL pattern property name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestMap.configAttributeField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;configAttribute&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">authority pattern property name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestMap.httpMethodField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;httpMethod&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP method property name (optional, does not have to exist in the class if you don&#8217;t require URL/method security)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Assuming you choose <code>com.mycompany.myapp</code> as your package, and <code>Requestmap</code> as your class name, you&#8217;ll generate this class:</p>
</div>
<div class="listingblock">
<div class="title"><code>Requestmap.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import org.springframework.http.HttpMethod

import groovy.transform.EqualsAndHashCode
import groovy.transform.ToString
import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
@EqualsAndHashCode(includes=['configAttribute', 'httpMethod', 'url'])
@ToString(includes=['configAttribute', 'httpMethod', 'url'], cache=true, includeNames=true, includePackage=false)
class RequestMap implements Serializable {

	private static final long serialVersionUID = 1

	String configAttribute
	HttpMethod httpMethod
	String url

	static constraints = {
		configAttribute blank: false
		httpMethod nullable: true
		url blank: false, unique: 'httpMethod'
	}

	static mapping = {
		cache true
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use Requestmap entries to guard URLs, see <a href="#requestmapInstances">Requestmap Instances Stored in the Database</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requestMappings">4. Configuring Request Mappings to Secure URLs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can choose among the following approaches to configuring request mappings for secure application URLs. The goal is to map URL patterns to the roles required to access those URLs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Secured</code> annotations (default approach) - <a href="#securedAnnotations">Defining Secured Annotations</a></p>
</li>
<li>
<p>A simple Map in <code>application.groovy</code> - <a href="#configGroovyMap">Static Map</a></p>
</li>
<li>
<p><code>Requestmap</code> domain class instances stored in the database - <a href="#requestmapInstances">Requestmap Instances Stored in the Database</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can only use one method at a time. You configure it with the <code>securityConfigType</code> attribute; the value has to be an <code>SecurityConfigType</code> enum value or the name of the enum as a String.</p>
</div>
<div class="sect2">
<h3 id="pessimistic-lockdown">4.1. Pessimistic Lockdown</h3>
<div class="paragraph">
<p>Many applications are mostly public, with some pages only accessible to authenticated users with various roles. In this case, it might make sense to leave URLs open by default and restrict access on a case-by-case basis. However, if your application is primarily secure, you can use a pessimistic lockdown approach to deny access to all URLs that do not have an applicable URL &lt;==&gt; Role request mapping. But the pessimistic approach is safer; if you forget to restrict access to a URL using the optimistic approach, it might take a while to discover that unauthorized users can access the URL, but if you forget to allow access when using the pessimistic approach, no user can access it and the error should be quickly discovered.</p>
</div>
<div class="paragraph">
<p>The pessimistic approach is the default, and there are two configuration options that apply. If <code>rejectIfNoRule</code> is <code>true</code> (the default) then any URL that has no request mappings (an annotation, entry in <code>controllerAnnotations.staticRules</code> or <code>interceptUrlMap</code>, or a <code>Requestmap</code> instance) will be denied to all users. The other option is <code>fii.rejectPublicInvocations</code> and if it is <code>true</code> (the default) then un-mapped URLs will trigger an <code>IllegalArgumentException</code> and will show the error page. This is uglier, but more useful because it&#8217;s very clear that there is a misconfiguration. When <code>fii.rejectPublicInvocations</code> is <code>false</code> but <code>rejectIfNoRule</code> is <code>true</code> you just see the &#8220;Sorry, you&#8217;re not authorized to view this page.&#8221; error 403 message.</p>
</div>
<div class="paragraph">
<p>Note that the two settings are mutually exclusive. If <code>rejectIfNoRule</code> is <code>true</code> then <code>fii.rejectPublicInvocations</code> is ignored because the request will transition to the login page or the error 403 page. If you want the more obvious error page, set <code>fii.rejectPublicInvocations</code> to <code>true</code> and <code>rejectIfNoRule</code> to <code>false</code> to allow that check to occur.</p>
</div>
<div class="paragraph">
<p>To reject un-mapped URLs with a 403 error code, use these settings (or none since <code>rejectIfNoRule</code> defaults to <code>true</code>)</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. Enabling <code>rejectIfNoRule</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.rejectIfNoRule = true
grails.plugin.springsecurity.fii.rejectPublicInvocations = false</code></pre>
</div>
</div>
<div class="paragraph">
<p>and to reject with the error 500 page, use these (optionally omit <code>rejectPublicInvocations</code> since it defaults to <code>true</code>):</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Enabling <code>fii.rejectPublicInvocations</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.rejectIfNoRule = false
grails.plugin.springsecurity.fii.rejectPublicInvocations = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if you set <code>rejectIfNoRule</code> or <code>rejectPublicInvocations</code> to <code>true</code> you&#8217;ll need to configure the <code>staticRules</code> map to include URLs that can&#8217;t otherwise be guarded:</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. Example <code>controllerAnnotations.staticRules</code> configuration when using <code>rejectIfNoRule</code> or <code>fii.rejectPublicInvocations</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.controllerAnnotations.staticRules = [
   [pattern: '/',               access: ['permitAll']],
   [pattern: '/error',          access: ['permitAll']],
   [pattern: '/index',          access: ['permitAll']],
   [pattern: '/index.gsp',      access: ['permitAll']],
   [pattern: '/shutdown',       access: ['permitAll']],
   [pattern: '/assets/**',      access: ['permitAll']],
   [pattern: '/**/js/**',       access: ['permitAll']],
   [pattern: '/**/css/**',      access: ['permitAll']],
   [pattern: '/**/images/**',   access: ['permitAll']],
   [pattern: '/**/favicon.ico', access: ['permitAll']]
]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that the syntax of the <code>staticRules</code> block has changed from previous versions of the plugin where the keys were URL patterns and the values were access rules (roles, expressions, etc.) To avoid issues in configuration parsing and to allow optionally specifying the HTTP method associated with one or more of the rules, the <code>staticRules</code> block is now specified as a <code>List</code> of <code>Map</code>s. Each <code>Map</code> defines one combination of url pattern and access rules (and optionally HTTP method). If there are multiple access rules, specify them as a <code>List</code> of <code>String</code>s; if there is only one access rule, its value can be a <code>String</code> or a single-element <code>List</code>.</p>
</div>
<div class="paragraph">
<p>The preceding <code>staticRules</code> example includes the default mappings defined when running the <a href="#s2-quickstart">s2-quickstart</a> script. Here&#8217;s a more complete example using all configuration options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.controllerAnnotations.staticRules = [
   [pattern: '/',               access: ['permitAll']],
   [pattern: '/error',          access: ['permitAll']],
   [pattern: '/index',          access: ['permitAll']],
   [pattern: '/index.gsp',      access: ['permitAll']],
   [pattern: '/shutdown',       access: ['permitAll']],
   [pattern: '/assets/**',      access: ['permitAll']],
   [pattern: '/**/js/**',       access: ['permitAll']],
   [pattern: '/**/css/**',      access: ['permitAll']],
   [pattern: '/**/images/**',   access: ['permitAll']],
   [pattern: '/**/favicon.ico', access: ['permitAll']],

   [pattern: '/user/**',        access: 'ROLE_USER'],
   [pattern: '/admin/**',       access: ['ROLE_ADMIN', 'IS_AUTHENTICATED_FULLY']],
   [pattern: '/thing/register', access: 'isAuthenticated()', httpMethod: 'PUT']
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now in addition to the default mappings, we require an authentication with <code>ROLE_USER</code> for any URL starting with <code>/user</code>, a &#8220;fully authenticated&#8221; authentication (i.e. an explicit login was performed without using remember-me) with <code>ROLE_ADMIN</code> for any URL starting with <code>/admin</code>, and finally to access the URL <code>/thing/register</code> the user must be authenticated with any role(s) but must use a PUT request.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is needed when using annotations; if you use the <code>grails.plugin.springsecurity.interceptUrlMap</code> map in <code>application.groovy</code> you&#8217;ll need to add these URLs too, and likewise when using <code>Requestmap</code> instances. If you don&#8217;t use annotations, you must add rules for the login and logout controllers also. You can add Requestmaps manually, or in BootStrap.groovy, for example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. Creating default requestmap instances when using <code>rejectIfNoRule</code> or <code>fii.rejectPublicInvocations</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">for (String url in [
      '/', '/error', '/index', '/index.gsp', '/**/favicon.ico', '/shutdown',
      '/**/js/**', '/**/css/**', '/**/images/**',
      '/login', '/login.*', '/login/*',
      '/logout', '/logout.*', '/logout/*']) {
   new Requestmap(url: url, configAttribute: 'permitAll').save()
}
springSecurityService.clearCachedRequestmaps()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The analogous interceptUrlMap settings would be:</p>
</div>
<div class="listingblock">
<div class="title">Listing 8. Example <code>interceptUrlMap</code> configuration when using <code>rejectIfNoRule</code> or <code>fii.rejectPublicInvocations</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.interceptUrlMap = [
   [pattern: '/',               access: ['permitAll']],
   [pattern: '/error',          access: ['permitAll']],
   [pattern: '/index',          access: ['permitAll']],
   [pattern: '/index.gsp',      access: ['permitAll']],
   [pattern: '/shutdown',       access: ['permitAll']],
   [pattern: '/assets/**',      access: ['permitAll']],
   [pattern: '/**/js/**',       access: ['permitAll']],
   [pattern: '/**/css/**',      access: ['permitAll']],
   [pattern: '/**/images/**',   access: ['permitAll']],
   [pattern: '/**/favicon.ico', access: ['permitAll']],
   [pattern: '/login/**',       access: ['permitAll']],
   [pattern: '/logout/**',      access: ['permitAll']]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, when you enable the switch-user feature, you&#8217;ll have to specify access rules for the associated URLs, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">[pattern: '/login/impersonate', access: ['ROLE_ADMIN']],
[pattern: '/logout/impersonate', access: ['permitAll']]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="urls-and-authorities">4.2. URLs and Authorities</h3>
<div class="paragraph">
<p>In each approach you configure a mapping for a URL pattern to the role(s) that are required to access those URLs, for example, <code>/admin/user/**</code> requires <code>ROLE_ADMIN</code>. In addition, you can combine the role(s) with SpEL expressions and/or tokens such as IS_AUTHENTICATED_ANONYMOUSLY, IS_AUTHENTICATED_REMEMBERED, and IS_AUTHENTICATED_FULLY. One or more voters (<a href="#voters">Voters</a>) will process any tokens and enforce a rule based on them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IS_AUTHENTICATED_ANONYMOUSLY</p>
<div class="ulist">
<ul>
<li>
<p>signifies that anyone can access this URL. By default the <code>AnonymousAuthenticationFilter</code> ensures an &#8220;anonymous&#8221; <code>Authentication</code> with no roles so that every user has an authentication. The token accepts any authentication, even anonymous.</p>
</li>
<li>
<p>The SpEL expression <code>permitAll</code> is equivalent to <code>IS_AUTHENTICATED_ANONYMOUSLY</code> and is typically more intuitive to use</p>
</li>
</ul>
</div>
</li>
<li>
<p>IS_AUTHENTICATED_REMEMBERED</p>
<div class="ulist">
<ul>
<li>
<p>requires the user to be authenticated through a remember-me cookie or an explicit login.</p>
</li>
<li>
<p>The SpEL expression <code>isAuthenticated() or isRememberMe()</code> is equivalent to <code>IS_AUTHENTICATED_REMEMBERED</code> and is typically more intuitive to use</p>
</li>
</ul>
</div>
</li>
<li>
<p>IS_AUTHENTICATED_FULLY</p>
<div class="ulist">
<ul>
<li>
<p>requires the user to be fully authenticated with an explicit login.</p>
</li>
<li>
<p>The SpEL expression <code>isFullyAuthenticated()</code> is equivalent to <code>IS_AUTHENTICATED_FULLY</code> and is typically more intuitive to use</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>With <code>IS_AUTHENTICATED_FULLY</code> you can implement a security scheme whereby users can check a remember-me checkbox during login and be auto-authenticated each time they return to your site, but must still log in with a password for some parts of the site. For example, allow regular browsing and adding items to a shopping cart with only a cookie, but require an explicit login to check out or view purchase history.</p>
</div>
<div class="paragraph">
<p>For more information on <code>IS_AUTHENTICATED_FULLY</code>, <code>IS_AUTHENTICATED_REMEMBERED</code>, and <code>IS_AUTHENTICATED_ANONYMOUSLY</code>, see the Javadoc for <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/access/vote/AuthenticatedVoter.html">AuthenticatedVoter</a></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The plugin isn&#8217;t compatible with Grails <code>&lt;g:actionSubmit&gt;</code> tags. These are used in the autogenerated GSPs that are created for you, and they enable having multiple submit buttons, each with its own action, inside a single form. The problem from the security perspective is that the form posts to the default action of the controller, and Grails figures out the handler action to use based on the <code>action</code> attribute of the <code>actionSubmit</code> tag. So for example you can guard the <code>/person/delete</code> with a restrictive role, but given this typical edit form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;g:form&gt;
   ...
   &lt;g:actionSubmit class="save" action="update" value='Update' /&gt;
   &lt;g:actionSubmit class="delete" action="delete" value="'Delete' /&gt;
&lt;/g:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>both actions will be allowed if the user has permission to access the <code>/person/index</code> url, which would often be the case.</p>
</div>
<div class="paragraph">
<p>The workaround is to create separate forms without using <code>actionSubmit</code> and explicitly set the <code>action</code> on the <code>&lt;g:form&gt;</code> tags, which will result in form submissions to the expected urls and properly guarded urls.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="comparing-the-approaches">4.3. Comparing the Approaches</h3>
<div class="paragraph">
<p>Each approach has its advantages and disadvantages. Annotations and the <code>application.groovy</code> Map are less flexible because they are configured once in the code and you can update them only by restarting the application (in prod mode anyway). In practice this limitation is minor, because security mappings for most applications are unlikely to change at runtime.</p>
</div>
<div class="paragraph">
<p>On the other hand, storing <code>Requestmap</code> entries enables runtime-configurability. This approach gives you a core set of rules populated at application startup that you can edit, add to, and delete as needed. However, it separates the security rules from the application code, which is less convenient than having the rules defined in <code>grails-app/conf/application.groovy</code> or in the applicable controllers using annotations.</p>
</div>
<div class="paragraph">
<p>URLs must be mapped in lowercase if you use the <code>Requestmap</code> or <code>grails-app/conf/application.groovy</code> map approaches. For example, if you have a FooBarController, its urls will be of the form /fooBar/list, /fooBar/create, and so on, but these must be mapped as /foobar/, /foobar/list, /foobar/create. This mapping is handled automatically for you if you use annotations.</p>
</div>
</div>
<div class="sect2">
<h3 id="securedAnnotations">4.4. Defining Secured Annotations</h3>
<div class="paragraph">
<p>You can use an <code>@Secured</code> annotation (either the standard <code>org.springframework.security.access.annotation.Secured</code> or the plugin&#8217;s <code>grails.plugin.springsecurity.annotation.Secured</code> which has the same attributes and features but also supports defining a closure as the config attribute to make authorization decisions) in your controllers to configure which roles are required for which actions. To use annotations, specify <code>securityConfigType="Annotation"</code>, or leave it unspecified because it&#8217;s the default:</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. Specifying <code>securityConfigType</code> as &#8220;Annotation&#8221;</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.securityConfigType = "Annotation"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define the annotation at the class level, meaning that the specified roles are required for all actions, or at the action level, or both. If the class and an action are annotated then the action annotation values will be used since they&#8217;re more specific.</p>
</div>
<div class="paragraph">
<p>For example, given this controller:</p>
</div>
<div class="listingblock">
<div class="title">Listing 10. An annotated controller</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.plugin.springsecurity.annotation.Secured

class SecureAnnotatedController {

   @Secured('ROLE_ADMIN')
   def index() {
      render 'you have ROLE_ADMIN'
   }

   @Secured(['ROLE_ADMIN', 'ROLE_SUPERUSER'])
   def adminEither() {
      render 'you have ROLE_ADMIN or SUPERUSER'
   }

   def anybody() {
      render 'anyone can see this' // assuming you're not using "strict" mode,
                                   // otherwise the action is not viewable by anyone
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>you must be authenticated and have <code>ROLE_ADMIN</code> to see <code>/myapp/secureAnnotated</code> (or <code>/myapp/secureAnnotated/index</code>) and be authenticated and have <code>ROLE_ADMIN</code> or <code>ROLE_SUPERUSER</code> to see <code>/myapp/secureAnnotated/adminEither</code>. Any user can access <code>/myapp/secureAnnotated/anybody</code> if you have disabled &#8220;strict&#8221; mode (using <code>rejectIfNoRule</code>), and nobody can access the action by default since it has no access rule configured.</p>
</div>
<div class="paragraph">
<p>In addition, you can define a closure in the annotation which will be called during access checking. The closure must return <code>true</code> or <code>false</code> and has all of the methods and properties that are available when using SpEL expressions, since the closure&#8217;s <code>delegate</code> is set to a subclass of <code>WebSecurityExpressionRoot</code>, and also the Spring <code>ApplicationContext</code> as the <code>ctx</code> property:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. An example of using a Closure in with <code>@Secured</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Secured(closure = {
   assert request
   assert ctx
   authentication.name == 'admin1'
})
def someMethod() {
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Often most actions in a controller require similar access rules, so you can also define annotations at the class level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.plugin.springsecurity.annotation.Secured

@Secured('ROLE_ADMIN')
class SecureClassAnnotatedController {

   def index() {
      render 'index: you have ROLE_ADMIN'
   }

   def otherAction() {
      render 'otherAction: you have ROLE_ADMIN'
   }

   @Secured('ROLE_SUPERUSER')
   def super() {
      render 'super: you have ROLE_SUPERUSER'
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you need to be authenticated and have <code>ROLE_ADMIN</code> to see <code>/myapp/secureClassAnnotated</code> (or <code>/myapp/secureClassAnnotated/index</code>) or <code>/myapp/secureClassAnnotated/otherAction</code>. However, you must have <code>ROLE_SUPERUSER</code> to access <code>/myapp/secureClassAnnotated/super</code>. The action-scope annotation overrides the class-scope annotation. Note that &#8220;strict&#8221; mode isn&#8217;t applicable here since all actions have an access rule defined (either explicitly or inherited from the class-level annotation).</p>
</div>
<div class="paragraph">
<p>Additionally, you can specify the HTTP method that is required in each annotation for the access rule, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.plugin.springsecurity.annotation.Secured

class SecureAnnotatedController {

   @Secured(value = ['ROLE_ADMIN'], httpMethod = 'GET')
   def create() {
      ...
   }

   @Secured(value = ['ROLE_ADMIN'], httpMethod = 'POST')
   def save() {
      ...
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you must have ROLE_ADMIN for both the <code>create</code> and <code>save</code> actions but <code>create</code> requires a GET request (since it renders the form to create a new instance) and <code>save</code> requires POST (since it&#8217;s the action that the form posts to).</p>
</div>
<div class="sect3">
<h4 id="securing-restful-domain-classes">4.4.1. Securing RESTful domain classes</h4>
<div class="paragraph">
<p>Since Grails 2.3, domain classes can be annotated with the <code>grails.rest.Resource</code> AST transformation, which will generate internally a controller with the default CRUD operations.</p>
</div>
<div class="paragraph">
<p>You can also use the <code>@Secured</code> annotation on such domain classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@Resource
@Secured('ROLE_ADMIN')
class Thing {

   String name
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="controllerannotations-staticrules">4.4.2. controllerAnnotations.staticRules</h4>
<div class="paragraph">
<p>You can also define &#8220;static&#8221; mappings that cannot be expressed in the controllers, such as '/**' or for JavaScript, CSS, or image URLs. Use the <code>controllerAnnotations.staticRules</code> property, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.controllerAnnotations.staticRules = [
   ...
   [pattern: '/js/admin/**',   access: ['ROLE_ADMIN']],
   [pattern: '/someplugin/**', access: ['ROLE_ADMIN']]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example maps all URLs associated with <code>SomePluginController</code>, which has URLs of the form <code>/somePlugin/&#8230;&#8203;</code>, to <code>ROLE_ADMIN</code>; annotations are not an option here because you would not edit plugin code for a change like this.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When mapping URLs for controllers that are mapped in <code>UrlMappings.groovy</code>, you need to secure the un-url-mapped URLs. For example if you have a FooBarController that you map to <code>/foo/bar/$action</code>, you must register that in <code>controllerAnnotations.staticRules</code> as <code>/foobar/**</code>. This is different than the mapping you would use for the other two approaches and is necessary because <code>controllerAnnotations.staticRules</code> entries are treated as if they were annotations on the corresponding controller.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configGroovyMap">4.5. Static Map</h3>
<div class="paragraph">
<p>To use a static map in <code>application.groovy</code> to secure URLs, first specify <code>securityConfigType="InterceptUrlMap"</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 12. Specifying <code>securityConfigType</code> as &#8220;InterceptUrlMap&#8221;</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.securityConfigType = "InterceptUrlMap"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Define a Map in <code>application.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. Example <code>grails.plugin.springsecurity.interceptUrlMap</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.interceptUrlMap = [
   [pattern: '/',               access: ['permitAll']],
   [pattern: '/error',          access: ['permitAll']],
   [pattern: '/index',          access: ['permitAll']],
   [pattern: '/index.gsp',      access: ['permitAll']],
   [pattern: '/shutdown',       access: ['permitAll']],
   [pattern: '/assets/**',      access: ['permitAll']],
   [pattern: '/**/js/**',       access: ['permitAll']],
   [pattern: '/**/css/**',      access: ['permitAll']],
   [pattern: '/**/images/**',   access: ['permitAll']],
   [pattern: '/**/favicon.ico', access: ['permitAll']],
   [pattern: '/login',          access: ['permitAll']],
   [pattern: '/login/**',       access: ['permitAll']],
   [pattern: '/logout',         access: ['permitAll']],
   [pattern: '/logout/**',      access: ['permitAll']]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>and add any custom mappings as needed, e.g.</p>
</div>
<div class="listingblock">
<div class="title">Listing 14. Custom <code>interceptUrlMap</code> mappings</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.interceptUrlMap = [
   ...
   [pattern: '/secure/**',  access: ['ROLE_ADMIN']],
   [pattern: '/finance/**', access: ['ROLE_FINANCE', 'IS_AUTHENTICATED_FULLY']]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using this approach, make sure that you order the rules correctly. The first applicable rule is used, so for example if you have a controller that has one set of rules but an action that has stricter access rules, e.g.</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. Incorrect <code>interceptUrlMap</code> order</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">[pattern: '/secure/**',               access: ['ROLE_ADMIN', 'ROLE_SUPERUSER']],
[pattern: '/secure/reallysecure/**',  access: ['ROLE_SUPERUSER']]</code></pre>
</div>
</div>
<div class="paragraph">
<p>then this would fail - it wouldn&#8217;t restrict access to <code>/secure/reallysecure/list</code> to a user with <code>ROLE_SUPERUSER</code> since the first URL pattern matches, so the second would be ignored. The correct mapping would be</p>
</div>
<div class="listingblock">
<div class="title">Listing 16. Correct <code>interceptUrlMap</code> order</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">[pattern: '/secure/reallysecure/**', access: ['ROLE_SUPERUSER']],
[pattern: '/secure/**',              access: ['ROLE_ADMIN', 'ROLE_SUPERUSER']]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="requestmapInstances">4.6. Requestmap Instances Stored in the Database</h3>
<div class="paragraph">
<p>With this approach you use the <code>Requestmap</code> domain class to store mapping entries in the database. <code>Requestmap</code> has a <code>url</code> property that contains the secured URL pattern and a <code>configAttribute</code> property containing a comma-delimited list of required roles, SpEL expressions, and/or tokens such as <code>IS_AUTHENTICATED_FULLY</code>, <code>IS_AUTHENTICATED_REMEMBERED</code>, and <code>IS_AUTHENTICATED_ANONYMOUSLY</code>.</p>
</div>
<div class="paragraph">
<p>To use <code>Requestmap</code> entries, specify <code>securityConfigType="Requestmap"</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 17. Specifying <code>securityConfigType</code> as &#8220;Requestmap&#8221;</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.securityConfigType = "Requestmap"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You create <code>Requestmap</code> entries as you create entries in any Grails domain class:</p>
</div>
<div class="listingblock">
<div class="title">Listing 18. Creating <code>Requestmap</code> entries</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">for (String url in [
      '/', '/error', '/index', '/index.gsp', '/**/favicon.ico', '/shutdown',
      '/assets/**', '/**/js/**', '/**/css/**', '/**/images/**',
      '/login', '/login.*', '/login/*',
      '/logout', '/logout.*', '/logout/*']) {
   new Requestmap(url: url, configAttribute: 'permitAll').save()
}

new Requestmap(url: '/profile/**',    configAttribute: 'ROLE_USER').save()
new Requestmap(url: '/admin/**',      configAttribute: 'ROLE_ADMIN').save()
new Requestmap(url: '/admin/role/**', configAttribute: 'ROLE_SUPERVISOR').save()
new Requestmap(url: '/admin/user/**',
               configAttribute: 'ROLE_ADMIN,ROLE_SUPERVISOR').save()
new Requestmap(url: '/login/impersonate',
               configAttribute: 'ROLE_SWITCH_USER,IS_AUTHENTICATED_FULLY').save()
springSecurityService.clearCachedRequestmaps()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>configAttribute</code> value can have a single value or have multiple comma-delimited values. In this example only users with <code>ROLE_ADMIN</code> or <code>ROLE_SUPERVISOR</code> can access <code>/admin/user/**</code> urls, and only users with <code>ROLE_SWITCH_USER</code> can access the switch-user url (<code>/login/impersonate</code>) and in addition must be authenticated fully, i.e. not using a remember-me cookie. Note that when specifying multiple roles, the user must have at least one of them, but when combining <code>IS_AUTHENTICATED_FULLY</code>, <code>IS_AUTHENTICATED_REMEMBERED</code>, or <code>IS_AUTHENTICATED_ANONYMOUSLY</code> with one or more roles means the user must have one of the roles and satisty the <code>IS_AUTHENTICATED</code> rule.</p>
</div>
<div class="paragraph">
<p>Unlike the <code>application.groovy</code> Map approach (<a href="#configGroovyMap">Static Map</a>), you do not need to revise the <code>Requestmap</code> entry order because the plugin calculates the most specific rule that applies to the current request.</p>
</div>
<div class="sect3">
<h4 id="requestmap-cache">4.6.1. Requestmap Cache</h4>
<div class="paragraph">
<p><code>Requestmap</code> entries are cached for performance, but caching affects runtime configurability. If you create, edit, or delete an instance, the cache must be flushed and repopulated to be consistent with the database. You can call <code>springSecurityService.clearCachedRequestmaps()</code> to do this. For example, if you create a <code>RequestmapController</code> the <code>save</code> action should look like this (and the update and delete actions should similarly call <code>clearCachedRequestmaps()</code>):</p>
</div>
<div class="listingblock">
<div class="title">Listing 19. Calling <code>clearCachedRequestmaps()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class RequestmapController {

   def springSecurityService

   ...

   def save(Requestmap requestmap) {
      if (!requestmap.save(flush: true)) {
         render view: 'create', model: [requestmapInstance: requestmap]
         return
      }

      springSecurityService.clearCachedRequestmaps()

      flash.message = ...
      redirect action: 'show', id: requestmap.id
   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="expressions">4.7. Using Expressions to Create Descriptive, Fine-Grained Rules</h3>
<div class="paragraph">
<p>Spring Security uses the <a href="https://docs.spring.io/spring/docs/4.1.x/spring-framework-reference/html/expressions.html">Spring Expression Language (SpEL)</a>, which allows you to declare the rules for guarding URLs more descriptively than does the traditional approach, and also allows much more fine-grained rules. Where you traditionally would specify a list of role names and/or special tokens (for example, <code>IS_AUTHENTICATED_FULLY</code>), with <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/reference/htmlsingle/#el-access">Spring Security&#8217;s expression support</a>, you can instead use the embedded scripting language to define simple or complex access rules.</p>
</div>
<div class="paragraph">
<p>You can use expressions with any of the previously described approaches to securing application URLs. For example, consider this annotated controller:</p>
</div>
<div class="listingblock">
<div class="title">Listing 20. An annotated controller</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.yourcompany.yourapp

import grails.plugin.springsecurity.annotation.Secured

class SecureController {

   @Secured("hasRole('ROLE_ADMIN')")
   def someAction() {
      ...
   }

   @Secured("authentication.name == 'ralph'")
   def someOtherAction() {
      ...
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>someAction</code> requires <code>ROLE_ADMIN</code>, and <code>someOtherAction</code> requires that the user be logged in with username &#8220;ralph&#8221;.</p>
</div>
<div class="paragraph">
<p>The corresponding <code>Requestmap</code> URLs would be</p>
</div>
<div class="listingblock">
<div class="title">Listing 21. Creating Requestmap instances</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">new Requestmap(url: "/secure/someAction",
               configAttribute: "hasRole('ROLE_ADMIN')").save()

new Requestmap(url: "/secure/someOtherAction",
               configAttribute: "authentication.name == 'ralph'").save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the corresponding static mappings would be</p>
</div>
<div class="listingblock">
<div class="title">Listing 22. Adding mappings in <code>grails.plugin.springsecurity.interceptUrlMap</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.interceptUrlMap = [
   [pattern: '/secure/someAction',      access: ["hasRole('ROLE_ADMIN')"]],
   [pattern: '/secure/someOtherAction', access: ["authentication.name == 'ralph'"]]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring Security docs have a <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/reference/htmlsingle/#el-common-built-in">table listing the standard expressions</a>, which is copied here for reference:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Spring Security expressions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Expression</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hasRole(role)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if the current principal has the specified role</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hasAnyRole([role1,role2])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if the current principal has any of the supplied roles (given as a comma-separated list of strings)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>principal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows direct access to the principal object representing the current user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authentication</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows direct access to the current <code>Authentication</code> object obtained from the <code>SecurityContext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>permitAll</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always evaluates to <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>denyAll</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always evaluates to <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isAnonymous()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if the current principal is an anonymous user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isRememberMe()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if the current principal is a remember-me user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isAuthenticated()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if the user is not anonymous</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isFullyAuthenticated()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if the user is not an anonymous or a remember-me user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the HTTP request, allowing expressions such as &#8220;isFullyAuthenticated() or request.getMethod().equals('OPTIONS')&#8221;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition, you can use a web-specific expression <code>hasIpAddress</code>. However, you may find it more convenient to separate IP restrictions from role restrictions by using the IP address filter (<a href="#ip">IP Address Restrictions</a>).</p>
</div>
<div class="paragraph">
<p>To help you migrate traditional configurations to expressions, this table compares various configurations and their corresponding expressions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Traditional configurations and associated expressions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Traditional Config</strong></th>
<th class="tableblock halign-left valign-top"><strong>Expression</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ROLE_ADMIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hasRole('ROLE_ADMIN')</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ROLE_USER,ROLE_ADMIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hasAnyRole('ROLE_USER','ROLE_ADMIN')</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ROLE_ADMIN,IS_AUTHENTICATED_FULLY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hasRole('ROLE_ADMIN') and isFullyAuthenticated()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_AUTHENTICATED_ANONYMOUSLY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>permitAll</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_AUTHENTICATED_REMEMBERED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isAuthenticated() or isRememberMe()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_AUTHENTICATED_FULLY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isFullyAuthenticated()</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="helperClasses">5. Helper Classes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the plugin helper classes in your application to avoid dealing with some lower-level details of Spring Security.</p>
</div>
<div class="sect2">
<h3 id="securityTagLib">5.1. SecurityTagLib</h3>
<div class="paragraph">
<p>The plugin includes GSP tags to support conditional display based on whether the user is authenticated, and/or has the required role to perform a particular action. These tags are in the <code>sec</code> namespace and are implemented in <code>grails.plugin.springsecurity.SecurityTagLib</code>.</p>
</div>
<div class="sect3">
<h4 id="ifloggedin">5.1.1. ifLoggedIn</h4>
<div class="paragraph">
<p>Displays the inner body content if the user is authenticated.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 23. Example using <code>&lt;sec:ifLoggedIn&gt;</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:ifLoggedIn&gt;
Welcome Back!
&lt;/sec:ifLoggedIn&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ifnotloggedin">5.1.2. ifNotLoggedIn</h4>
<div class="paragraph">
<p>Displays the inner body content if the user is not authenticated.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 24. Example using <code>&lt;sec:ifNotLoggedIn&gt;</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:ifNotLoggedIn&gt;
&lt;g:link controller='login' action='auth'&gt;Login&lt;/g:link&gt;
&lt;/sec:ifNotLoggedIn&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ifallgranted">5.1.3. ifAllGranted</h4>
<div class="paragraph">
<p>Displays the inner body content only if all of the listed roles are granted.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 25. Example using <code>&lt;sec:ifAllGranted&gt;</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:ifAllGranted roles='ROLE_ADMIN,ROLE_SUPERVISOR'&gt;
...
secure stuff here
...
&lt;/sec:ifAllGranted&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ifanygranted">5.1.4. ifAnyGranted</h4>
<div class="paragraph">
<p>Displays the inner body content if at least one of the listed roles are granted.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 26. Example using <code>&lt;sec:ifAnyGranted&gt;</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:ifAnyGranted roles='ROLE_ADMIN,ROLE_SUPERVISOR'&gt;
...
secure stuff here
...
&lt;/sec:ifAnyGranted&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ifnotgranted">5.1.5. ifNotGranted</h4>
<div class="paragraph">
<p>Displays the inner body content if none of the listed roles are granted.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 27. Example using <code>&lt;sec:ifNotGranted&gt;</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:ifNotGranted roles='ROLE_USER'&gt;
...
non-user stuff here
...
&lt;/sec:ifNotGranted&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="loggedinuserinfo">5.1.6. loggedInUserInfo</h4>
<div class="paragraph">
<p>Displays the value of the specified UserDetails property if logged in. For example, to show the username property:</p>
</div>
<div class="listingblock">
<div class="title">Listing 28. Example using <code>&lt;sec:loggedInUserInfo&gt;</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:loggedInUserInfo field='username'/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have customized the UserDetails (e.g. with a custom UserDetailsService) to add a <code>fullName</code> property, you access it as follows:</p>
</div>
<div class="listingblock">
<div class="title">Listing 29. Example using <code>&lt;sec:loggedInUserInfo&gt;</code> for a nonstandard property</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">Welcome Back &lt;sec:loggedInUserInfo field='fullName'/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="username">5.1.7. username</h4>
<div class="paragraph">
<p>Displays the value of the UserDetails <code>username</code> property if logged in.</p>
</div>
<div class="listingblock">
<div class="title">Listing 30. Example using <code>&lt;sec:username&gt;</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:ifLoggedIn&gt;
Welcome Back &lt;sec:username/&gt;!
&lt;/sec:ifLoggedIn&gt;
&lt;sec:ifNotLoggedIn&gt;
&lt;g:link controller='login' action='auth'&gt;Login&lt;/g:link&gt;
&lt;/sec:ifNotLoggedIn&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ifswitched">5.1.8. ifSwitched</h4>
<div class="paragraph">
<p>Displays the inner body content only if the current user switched from another user. (See also <a href="#switchUser">Switch User</a>.)</p>
</div>
<div class="listingblock">
<div class="title">Listing 31. Example using <code>&lt;sec:ifSwitched&gt;</code> and <code>&lt;sec:ifNotSwitched&gt;</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:ifLoggedIn&gt;
Logged in as &lt;sec:username/&gt;
&lt;/sec:ifLoggedIn&gt;

&lt;sec:ifSwitched&gt;
    &lt;form action='${request.contextPath}/logout/impersonate' method='POST'&gt;
        &lt;input type='submit' value="Resume as ${grails.plugin.springsecurity.SpringSecurityUtils.switchedUserOriginalUsername}"/&gt;
    &lt;/form&gt;
&lt;/sec:ifSwitched&gt;

&lt;sec:ifNotSwitched&gt;

   &lt;sec:ifAllGranted roles='ROLE_SWITCH_USER'&gt;

   &lt;form action='${request.contextPath}/login/impersonate'
         method='POST'&gt;

      Switch to user: &lt;input type='text' name='username'/&gt;&lt;br/&gt;

      &lt;input type='submit' value='Switch'/&gt; &lt;/form&gt;

   &lt;/sec:ifAllGranted&gt;

&lt;/sec:ifNotSwitched&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ifnotswitched">5.1.9. ifNotSwitched</h4>
<div class="paragraph">
<p>Displays the inner body content only if the current user has not switched from another user.</p>
</div>
</div>
<div class="sect3">
<h4 id="switcheduseroriginalusername">5.1.10. switchedUserOriginalUsername</h4>
<div class="paragraph">
<p>Renders the original user&#8217;s username if the current user switched from another user.</p>
</div>
<div class="listingblock">
<div class="title">Listing 32. Example using <code>&lt;sec:switchedUserOriginalUsername&gt;</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:ifSwitched&gt;
    &lt;form action='${request.contextPath}/logout/impersonate' method='POST'&gt;
        &lt;input type='submit' value="Resume as ${grails.plugin.springsecurity.SpringSecurityUtils.switchedUserOriginalUsername}"/&gt;
    &lt;/form&gt;
&lt;/sec:ifSwitched&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="access">5.1.11. access</h4>
<div class="paragraph">
<p>Renders the body if the specified expression evaluates to <code>true</code> or specified URL is allowed.</p>
</div>
<div class="listingblock">
<div class="title">Listing 33. Example using <code>&lt;sec:access&gt;</code> with an expression</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:access expression="hasRole('ROLE_USER')"&gt;

You're a user

&lt;/sec:access&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 34. Example using <code>&lt;sec:access&gt;</code> with a URL</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:access url='/admin/user'&gt;

&lt;g:link controller='admin' action='user'&gt;Manage Users&lt;/g:link&gt;

&lt;/sec:access&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also guard access to links generated from controller and action names or named URL mappings instead of hard-coding the values, for example</p>
</div>
<div class="listingblock">
<div class="title">Listing 35. Example using <code>&lt;sec:access&gt;</code> with a controller and action</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:access controller='admin' action='user'&gt;

&lt;g:link controller='admin' action='user'&gt;Manage Users&lt;/g:link&gt;

&lt;/sec:access&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or if you have a named URL mapping you can refer to that:</p>
</div>
<div class="listingblock">
<div class="title">Listing 36. Example using <code>&lt;sec:access&gt;</code> with a URL mapping</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:access mapping='manageUsers'&gt;

&lt;g:link mapping='manageUsers'&gt;Manage Users&lt;/g:link&gt;

&lt;/sec:access&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For even more control of the generated URL (still avoiding hard-coding) you can use <code>createLink</code> to build the URL, for example</p>
</div>
<div class="listingblock">
<div class="title">Listing 37. Example using <code>&lt;sec:access&gt;</code> with <code>&lt;g:createLink&gt;</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:access url='${createLink(controller: 'admin', action: 'user', base: '/')}'&gt;

&lt;g:link controller='admin' action='user'&gt;Manage Users&lt;/g:link&gt;

&lt;/sec:access&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be sure to include the <code>base: '/'</code> attribute in this case to avoid appending the context name to the URL.</p>
</div>
</div>
<div class="sect3">
<h4 id="noaccess">5.1.12. noAccess</h4>
<div class="paragraph">
<p>Renders the body if the specified expression evaluates to <code>false</code> or URL isn&#8217;t allowed.</p>
</div>
<div class="listingblock">
<div class="title">Listing 38. Example using <code>&lt;sec:noAccess&gt;</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:noAccess expression="hasRole('ROLE_USER')"&gt;

You're not a user

&lt;/sec:noAccess&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="link">5.1.13. link</h4>
<div class="paragraph">
<p>A wrapper around the standard Grails link tag that renders if the specified expression evaluates to <code>true</code> or URL is allowed.</p>
</div>
<div class="paragraph">
<p>To define the expression to evaluate within the tag itself:</p>
</div>
<div class="listingblock">
<div class="title">Listing 39. Example using <code>&lt;sec:link&gt;</code> with an expression</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:link controller='myController' action='myAction' expression="hasRole('ROLE_USER')"&gt;My link text&lt;/sec:link&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use access controls defined, for example, in the interceptUrlMap:</p>
</div>
<div class="listingblock">
<div class="title">Listing 40. Example using <code>&lt;sec:link&gt;</code> without an expression</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:link controller='myController' action='myAction'&gt;My link text&lt;/sec:link&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, nothing will be rendered if the specified expression evaluates to <code>false</code> or URL is not allowed. To render only the text that would have been linked, set the <code>fallback</code> attribute:</p>
</div>
<div class="listingblock">
<div class="title">Listing 41. Example using <code>&lt;sec:link fallback='true'&gt;</code> without an expression</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:link controller='myController' action='myAction' fallback='true'&gt;This text will display but won't be linked if the user doesn't have access&lt;/sec:link&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="springSecurityService">5.2. SpringSecurityService</h3>
<div class="paragraph">
<p><code>grails.plugin.springsecurity.SpringSecurityService</code> provides security utility functions. It is a regular Grails service, so you use dependency injection to inject it into a controller, service, taglib, and so on:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def springSecurityService</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="getcurrentuser">5.2.1. getCurrentUser()</h4>
<div class="paragraph">
<p>Retrieves a domain class instance for the currently authenticated user. During authentication a user/person domain class instance is retrieved to get the user&#8217;s password, roles, etc. and the id of the instance is saved. This method uses the id and the domain class to re-load the instance, or the username if the <code>UserDetails</code> instance is not a <code>GrailsUser</code>.</p>
</div>
<div class="paragraph">
<p>If you do not need domain class data other than the id, you should use the <code>loadCurrentUser</code> method instead.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 42. Example using <code>getCurrentUser()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SomeController {

   def springSecurityService

   def someAction() {
      def user = springSecurityService.currentUser
      ...
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="loadcurrentuser">5.2.2. loadCurrentUser()</h4>
<div class="paragraph">
<p>Often it is not necessary to retrieve the entire domain class instance, for example when using it in a query where only the id is needed as a foreign key. This method uses the GORM <code>load</code> method to create a proxy instance. This will never be null, but can be invalid if the id doesn&#8217;t correspond to a row in the database, although this is very unlikely in this scenario because the instance would have been there during authentication.</p>
</div>
<div class="paragraph">
<p>If you need other data than just the id, use the <code>getCurrentUser</code> method instead.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 43. Example using <code>loadCurrentUser()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SomeController {

   def springSecurityService

   def someAction(Long id) {
      def user = springSecurityService.isLoggedIn() ?
            springSecurityService.loadCurrentUser() :
            null
      if (user) {
         CreditCard card = CreditCard.findByIdAndUser(id, user)
         ...
      }
      ...
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="isloggedin">5.2.3. isLoggedIn()</h4>
<div class="paragraph">
<p>Checks whether there is a currently logged-in user.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 44. Example using <code>isLoggedIn()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SomeController {

   def springSecurityService

   def someAction() {
      if (springSecurityService.isLoggedIn()) {
         ...
      }
      else {
         ...
      }
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="getauthentication">5.2.4. getAuthentication()</h4>
<div class="paragraph">
<p>Retrieves the current user&#8217;s <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/Authentication.html">Authentication</a>. If authenticated, this will typically be a <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/UsernamePasswordAuthenticationToken.html">UsernamePasswordAuthenticationToken</a>.</p>
</div>
<div class="paragraph">
<p>If not authenticated and the <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/web/authentication/AnonymousAuthenticationFilter.html">AnonymousAuthenticationFilter</a> is active (true by default) then the anonymous user&#8217;s authentication will be returned. This will be an instance of <code>grails.plugin.springsecurity.authentication.GrailsAnonymousAuthenticationToken</code> with a standard <code>org.springframework.security.core.userdetails.User</code> instance as its Principal. The authentication will have a single granted role, <code>ROLE_ANONYMOUS</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 45. Example using <code>getAuthentication()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SomeController {

   def springSecurityService

   def someAction() {
      def auth = springSecurityService.authentication
      String username = auth.username
      def authorities = auth.authorities // a Collection of GrantedAuthority
      boolean authenticated = auth.authenticated
      ...
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="getprincipal">5.2.5. getPrincipal()</h4>
<div class="paragraph">
<p>Retrieves the currently logged in user&#8217;s <code>Principal</code>. If authenticated, the principal will be a <code>grails.plugin.springsecurity.userdetails.GrailsUser</code>, unless you have created a custom <code>UserDetailsService</code>, in which case it will be whatever implementation of <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/userdetails/UserDetails.html">UserDetails</a> you use there.</p>
</div>
<div class="paragraph">
<p>If not authenticated and the <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/web/authentication/AnonymousAuthenticationFilter.html">AnonymousAuthenticationFilter</a> is active (true by default) then a standard <code>org.springframework.security.core.userdetails.User</code> is used.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 46. Example using <code>getPrincipal()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class SomeController {

   def springSecurityService

   def someAction() {
      def principal = springSecurityService.principal
      String username = principal.username
      def authorities = principal.authorities // a Collection of GrantedAuthority
      boolean enabled = principal.enabled
      ...
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="encodepassword">5.2.6. encodePassword()</h4>
<div class="paragraph">
<p>Hashes a password with the configured hashing scheme. By default the plugin uses bcrypt, but you can configure the scheme with the <code>grails.plugin.springsecurity.password.algorithm</code> attribute in <code>application.groovy</code>. The supported values are &#8216;bcrypt&#8217; to use bcrypt, &#8216;pbkdf2&#8217; to use <a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a>, or any message digest algorithm that is supported in your JDK; see <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html">this Java page</a> for the available algorithms.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You are <strong>strongly</strong> discouraged from using MD5 or SHA-1 algorithms because of their well-known vulnerabilities. You should also use a salt for your passwords, which greatly increases the computational complexity of computing passwords if your database gets compromised. See <a href="#salt">Salted Passwords</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 47. Example using <code>encodePassword()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class PersonController {

   def springSecurityService

   def updateAction(Person person) {

      params.salt = person.salt
      if (person.password != params.password) {
         params.password = springSecurityService.encodePassword(password, salt)
         def salt = ... // e.g. randomly generated using some utility method
         params.salt = salt
      }
      person.properties = params
      if (!person.save(flush: true)) {
         render view: 'edit', model: [person: person]
         return
      }
      redirect action: 'show', id: person.id
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are hashing the password in an PersistenceEventListener or in the User domain class (using <code>beforeInsert</code> and <code>encodePassword</code>) then don&#8217;t call <code>springSecurityService.encodePassword()</code> in your controller since you&#8217;ll double-hash the password and users won&#8217;t be able to log in. It&#8217;s best to encapsulate the password handling logic in a single point.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="updaterole">5.2.7. updateRole()</h4>
<div class="paragraph">
<p>Updates a role and, if you use <code>Requestmap</code> instances to secure URLs, updates the role name in all affected <code>Requestmap</code> definitions if the name was changed.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 48. Example using <code>updateRole()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class RoleController {

   def springSecurityService

   def update(Role role) {
      if (!springSecurityService.updateRole(role, params)) {
         render view: 'edit', model: [roleInstance: role]
         return
      }

      flash.message = "The role was updated"
      redirect action: show, id: role.id
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deleterole">5.2.8. deleteRole()</h4>
<div class="paragraph">
<p>Deletes a role and, if you use <code>Requestmap</code> instances to secure URLs, removes the role from all affected <code>Requestmap</code> definitions. If a <code>Requestmap</code>'s config attribute is only the role name (for example, <code>[pattern: '/foo/bar', access: 'ROLE_FOO']</code>), it is deleted.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 49. Example using <code>deleteRole()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class RoleController {

   def springSecurityService

   def delete(Role role) {
      try {
         springSecurityService.deleteRole role
         flash.message = "The role was deleted"
         redirect action: list
      }
      catch (DataIntegrityViolationException e) {
         flash.message = "Unable to delete the role"
         redirect action: show, id: params.id
      }
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="clearcachedrequestmaps">5.2.9. clearCachedRequestmaps()</h4>
<div class="paragraph">
<p>Flushes the Requestmaps cache and triggers a complete reload. If you use <code>Requestmap</code> instances to secure URLs, the plugin loads and caches all <code>Requestmap</code> instances as a performance optimization. This action saves database activity because the requestmaps are checked for each request. Do not allow the cache to become stale. When you create, edit or delete a <code>Requestmap</code>, flush the cache. Both <code>updateRole()</code> and <code>deleteRole()</code> call clearCachedRequestmaps()for you. Call this method when you create a new <code>Requestmap</code> or do other <code>Requestmap</code> work that affects the cache.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 50. Example using <code>clearCachedRequestmaps()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class RequestmapController {

   def springSecurityService

   def save(Requestmap requestmap) {
      if (!requestmap.save(flush: true)) {
         render view: 'create', model: [requestmapInstance: requestmap]
         return
      }

      springSecurityService.clearCachedRequestmaps()
      flash.message = "Requestmap created"
      redirect action: show, id: requestmap.id
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reauthenticate">5.2.10. reauthenticate()</h4>
<div class="paragraph">
<p>Rebuilds an <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/Authentication.html">Authentication</a> for the given username and registers it in the security context. You typically use this method after updating a user&#8217;s authorities or other data that is cached in the <code>Authentication</code> or <code>Principal</code>. It also removes the user from the user cache to force a refresh at next login.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 51. Example using <code>reauthenticate()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class UserController {

   def springSecurityService

   def update(User user) {

      params.salt = user.salt
      if (params.password) {
         params.password = springSecurityService.encodePassword(params.password, salt)
         def salt = ... // e.g. randomly generated using some utility method
         params.salt = salt
      }
      user.properties = params
      if (!user.save(flush: true)) {
         render view: 'edit', model: [userInstance: user]
         return
      }

      if (springSecurityService.loggedIn &amp;&amp;
             springSecurityService.principal.username == user.username) {
         springSecurityService.reauthenticate user.username
      }

      flash.message = "The user was updated"
      redirect action: show, id: user.id
   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="springSecurityUtils">5.3. SpringSecurityUtils</h3>
<div class="paragraph">
<p><code>grails.plugin.springsecurity.SpringSecurityUtils</code> is a utility class with static methods that you can call directly without using dependency injection. It is primarily an internal class but can be called from application code.</p>
</div>
<div class="sect3">
<h4 id="authoritiestoroles">5.3.1. authoritiesToRoles()</h4>
<div class="paragraph">
<p>Extracts role names from an array or <code>Collection</code> of <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/GrantedAuthority.html">GrantedAuthority</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="getprincipalauthorities">5.3.2. getPrincipalAuthorities()</h4>
<div class="paragraph">
<p>Retrieves the currently logged-in user&#8217;s authorities. It is empty (but never <code>null</code>) if the user is not logged in.</p>
</div>
</div>
<div class="sect3">
<h4 id="parseauthoritiesstring">5.3.3. parseAuthoritiesString()</h4>
<div class="paragraph">
<p>Splits a comma-delimited String containing role names into a <code>List</code> of <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/GrantedAuthority.html">GrantedAuthority</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ifallgranted-2">5.3.4. ifAllGranted()</h4>
<div class="paragraph">
<p>Checks whether the current user has all specified roles (a comma-delimited String of role names). Primarily used by <code>SecurityTagLib.ifAllGranted</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ifnotgranted-2">5.3.5. ifNotGranted()</h4>
<div class="paragraph">
<p>Checks whether the current user has none of the specified roles (a comma-delimited String of role names). Primarily used by <code>SecurityTagLib.ifNotGranted</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ifanygranted-2">5.3.6. ifAnyGranted()</h4>
<div class="paragraph">
<p>Checks whether the current user has any of the specified roles (a comma-delimited String of role names). Primarily used by <code>SecurityTagLib.ifAnyGranted</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="getsecurityconfig">5.3.7. getSecurityConfig()</h4>
<div class="paragraph">
<p>Retrieves the security part of the <code>Configuration</code> (from <code>grails-app/conf/application.groovy</code> merged with the plugin&#8217;s default configuration).</p>
</div>
</div>
<div class="sect3">
<h4 id="loadsecondaryconfig">5.3.8. loadSecondaryConfig()</h4>
<div class="paragraph">
<p>Used by dependent plugins to add configuration attributes.</p>
</div>
</div>
<div class="sect3">
<h4 id="reloadsecurityconfig">5.3.9. reloadSecurityConfig()</h4>
<div class="paragraph">
<p>Forces a reload of the security configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="isajax">5.3.10. isAjax()</h4>
<div class="paragraph">
<p>Checks whether the request was triggered by an Ajax call. The standard way is to determine whether <code>X-Requested-With</code> request header is set and has the value <code>XMLHttpRequest</code>. In addition, you can configure the name of the header with the <code>grails.plugin.springsecurity.ajaxHeader</code> configuration attribute, but this is not recommended because all major JavaScript toolkits use the standard name. Further, you can register a closure in <code>application.groovy</code> with the name <code>ajaxCheckClosure</code> that will be used to check if a request is an Ajax request. It is passed the request as its single argument, e.g.</p>
</div>
<div class="listingblock">
<div class="title">Listing 52. Customizing Ajax detection with <code>grails.plugin.springsecurity.ajaxCheckClosure</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.ajaxCheckClosure = { request -&gt;
   // return true or false
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also force the request to be treated as Ajax by appending <code>&amp;ajax=true</code> to your request query string.</p>
</div>
</div>
<div class="sect3">
<h4 id="registerprovider">5.3.11. registerProvider()</h4>
<div class="paragraph">
<p>Used by dependent plugins to register an <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/AuthenticationProvider.html">AuthenticationProvider</a> bean name.</p>
</div>
</div>
<div class="sect3">
<h4 id="registerfilter">5.3.12. registerFilter()</h4>
<div class="paragraph">
<p>Used by dependent plugins to register a filter bean name in a specified position in the filter chain.</p>
</div>
</div>
<div class="sect3">
<h4 id="isswitched">5.3.13. isSwitched()</h4>
<div class="paragraph">
<p>Checks whether the current user switched from another user.</p>
</div>
</div>
<div class="sect3">
<h4 id="getswitcheduseroriginalusername">5.3.14. getSwitchedUserOriginalUsername()</h4>
<div class="paragraph">
<p>Gets the original user&#8217;s username if the current user switched from another user.</p>
</div>
</div>
<div class="sect3">
<h4 id="dowithauth">5.3.15. doWithAuth()</h4>
<div class="paragraph">
<p>Executes a Closure with the current authentication. The one-parameter version which takes just a Closure assumes that there&#8217;s an authentication in the HTTP Session and that the Closure is running in a separate thread from the web request, so the <code>SecurityContext</code> and <code>Authentication</code> aren&#8217;t available to the standard <code>ThreadLocal</code>. This is primarily of use when you explicitly launch a new thread from a controller action or service called in request scope, not from a Quartz job which isn&#8217;t associated with an authentication in any thread.</p>
</div>
<div class="paragraph">
<p>The two-parameter version takes a username and a Closure to authenticate as. This is will authenticate as the specified user and execute the closure with that authentication. It restores the authentication to the one that was active if it exists, or clears the context otherwise. This is similar to run-as and switch-user but is only local to the Closure.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="events">6. Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Security fires application events after various security-related actions such as successful login, unsuccessful login, and so on. Spring Security uses two main event classes, <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/event/AbstractAuthenticationEvent.html">AbstractAuthenticationEvent</a> and <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/access/event/AbstractAuthorizationEvent.html">AbstractAuthorizationEvent</a>.</p>
</div>
<div class="sect2">
<h3 id="eventNotification">6.1. Event Notification</h3>
<div class="paragraph">
<p>You can set up event notifications in two ways. The sections that follow describe each approach in more detail.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Register an event listener, ignoring events that do not interest you. Spring allows only partial event subscription; you use generics to register the class of events that interest you, and you are notified of that class and all subclasses.</p>
</li>
<li>
<p>Register one or more callback closures in <code>grails-app/conf/application.groovy</code> that take advantage of the plugin&#8217;s <code>grails.plugin.springsecurity.SecurityEventListener</code>. The listener does the filtering for you.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="authenticationeventpublisher">6.1.1. AuthenticationEventPublisher</h4>
<div class="paragraph">
<p>Spring Security publishes events using an <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/AuthenticationEventPublisher.html">AuthenticationEventPublisher</a> which in turn fire events using the <a href="https://docs.spring.io/spring/docs/4.1.x/javadoc-api/org/springframework/context/ApplicationEventPublisher.html">ApplicationEventPublisher</a>. By default no events are fired since the <code>AuthenticationEventPublisher</code> instance registered is a <code>grails.plugin.springsecurity.authentication.NullAuthenticationEventPublisher</code>. But you can enable event publishing by setting <code>grails.plugin.springsecurity.useSecurityEventListener = true</code> in <code>grails-app/conf/application.groovy</code>.</p>
</div>
<div class="paragraph">
<p>You can use the <code>useSecurityEventListener</code> setting to temporarily disable and enable the callbacks, or enable them per-environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="usernamenotfoundexception">6.1.2. UsernameNotFoundException</h4>
<div class="paragraph">
<p>Most authentication exceptions trigger an event with a similar name as described in this table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Exceptions and associated events</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Exception</strong></th>
<th class="tableblock halign-left valign-top"><strong>Event</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccountExpiredException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationFailureExpiredEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationServiceException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationFailureServiceExceptionEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LockedException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationFailureLockedEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CredentialsExpiredException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationFailureCredentialsExpiredEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DisabledException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationFailureDisabledEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BadCredentialsException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationFailureBadCredentialsEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UsernameNotFoundException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationFailureBadCredentialsEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ProviderNotFoundException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationFailureProviderNotFoundEvent</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This holds for all exceptions except <code>UsernameNotFoundException</code> which triggers an <code>AuthenticationFailureBadCredentialsEvent</code> just like a <code>BadCredentialsException</code>. This is a good idea since it doesn&#8217;t expose extra information - there&#8217;s no differentiation between a bad password and a missing user. In addition, by default a missing user will trigger a <code>BadCredentialsException</code> for the same reasons. You can configure Spring Security to re-throw the original <code>UsernameNotFoundException</code> instead of converting it to a <code>BadCredentialsException</code> by setting <code>grails.plugin.springsecurity.dao.hideUserNotFoundExceptions = false</code> in <code>grails-app/conf/application.groovy</code>.</p>
</div>
<div class="paragraph">
<p>Fortunately all subclasses of <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/event/AbstractAuthenticationFailureEvent.html">AbstractAuthenticationFailureEvent</a> have a <code>getException()</code> method that gives you access to the exception that triggered the event, so you can use that to differentiate between a bad password and a missing user (if <code>hideUserNotFoundExceptions=false</code>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="registeringEventListener">6.2. Registering an Event Listener</h3>
<div class="paragraph">
<p>Enable events with <code>grails.plugin.springsecurity.useSecurityEventListener = true</code> and create one or more Groovy or Java classes, for example:</p>
</div>
<div class="listingblock">
<div class="title"><code>MySecurityEventListener.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.foo.bar

import org.springframework.context.ApplicationListener
import org.springframework.security.authentication.event.AuthenticationSuccessEvent

class MySecurityEventListener
      implements ApplicationListener&lt;AuthenticationSuccessEvent&gt; {

   void onApplicationEvent(AuthenticationSuccessEvent event) {
      // handle the event
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Register the class in <code>grails-app/conf/spring/resources.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 53. Registration of the event listener bean in <code>resources.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import com.foo.bar.MySecurityEventListener

beans = {
   mySecurityEventListener(MySecurityEventListener)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="registeringCallbackClosures">6.3. Registering Callback Closures</h3>
<div class="paragraph">
<p>Alternatively, enable events with <code>grails.plugin.springsecurity.useSecurityEventListener = true</code> and register one or more callback closure(s) in <code>grails-app/conf/application.groovy</code> and let <code>SecurityEventListener</code> do the filtering.</p>
</div>
<div class="paragraph">
<p>Implement the event handlers that you need, for example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 54. Adding event handling closures in <code>application.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.useSecurityEventListener = true

grails.plugin.springsecurity.onInteractiveAuthenticationSuccessEvent = { e, appCtx -&gt;
   // handle InteractiveAuthenticationSuccessEvent
}

grails.plugin.springsecurity.onAbstractAuthenticationFailureEvent = { e, appCtx -&gt;
   // handle AbstractAuthenticationFailureEvent
}

grails.plugin.springsecurity.onAuthenticationSuccessEvent = { e, appCtx -&gt;
   // handle AuthenticationSuccessEvent
}

grails.plugin.springsecurity.onAuthenticationSwitchUserEvent = { e, appCtx -&gt;
   // handle AuthenticationSwitchUserEvent
}

grails.plugin.springsecurity.onAuthorizationEvent = { e, appCtx -&gt;
   // handle AuthorizationEvent
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>None of these closures are required; if none are configured, nothing will be called. Just implement the event handlers that you need.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When a user authenticates, Spring Security initially fires an <code>AuthenticationSuccessEvent</code>. This event fires before the <code>Authentication</code> is registered in the <code>SecurityContextHolder</code>, which means that the <code>springSecurityService</code> methods that access the logged-in user will not work. Later in the processing a second event is fired, an <code>InteractiveAuthenticationSuccessEvent</code>, and when this happens the <code>SecurityContextHolder</code> will have the <code>Authentication</code>. Depending on your needs, you can implement a callback for either or both events.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="domainClassProperties">7. User, Authority (Role), and Requestmap Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Properties you are most likely to override are the <code>User</code> and  <code>Authority</code> (and <code>Requestmap</code> if you use the database to store mappings) class and property names.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Domain class configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.userDomainClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.usernamePropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;username&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class username property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.usernameIgnoreCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;false&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ignore case when searching for usernamePropertyName</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.passwordPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;password&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class password property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.authoritiesPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;authorities&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class role collection property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.enabledPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;enabled&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class enabled property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.accountExpiredPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;accountExpired&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class account expired property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.accountLockedPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;accountLocked&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class account locked property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.passwordExpiredPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;passwordExpired&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User class password expired property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLookup.authorityJoinClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User/Role many-many join class name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authority.className</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role class name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authority.nameField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;authority&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role class role name property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestMap.className</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requestmap class name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestMap.urlField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;url&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requestmap class URL pattern property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestMap.configAttributeField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;configAttribute&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requestmap class role/token property</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="authentication">8. Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Security plugin supports several approaches to authentication.</p>
</div>
<div class="paragraph">
<p>The default approach stores users and roles in your database, and uses an HTML login form which prompts the user for a username and password. The plugin also supports other approaches as described in the sections below, as well as add-on plugins that provide external authentication providers such as <a href="https://grails.org/plugin/spring-security-ldap">LDAP</a>, and single sign-on using <a href="https://grails.org/plugin/spring-security-cas">CAS</a></p>
</div>
<div class="sect2">
<h3 id="basicAndDigestAuth">8.1. Basic and Digest Authentication</h3>
<div class="paragraph">
<p>To use <a href="https://en.wikipedia.org/wiki/Basic_access_authentication">HTTP Basic Authentication</a> in your application, set the <code>useBasicAuth</code> attribute to <code>true</code>. Also change the <code>basic.realmName</code> default value to one that suits your application, for example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 55. Basic Authentication example settings</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.useBasicAuth = true
grails.plugin.springsecurity.basic.realmName = "Ralph's Bait and Tackle"</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Basic Authentication configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useBasicAuth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use Basic authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">basic.realmName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Grails Realm&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Realm name displayed in the browser authentication popup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">basic.credentialsCharset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;UTF-8&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The character set used to decode Base64-encoded data</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>With this authentication in place, users are prompted with the standard browser login dialog instead of being redirected to a login page.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t want all of your URLs guarded by Basic authentication, you can partition the URL patterns and apply Basic authentication to some, but regular form login to others. For example, if you have a web service that uses Basic authentication for <code>/webservice/**</code> URLs, you would configure that using the <code>chainMap</code> config attribute:</p>
</div>
<div class="listingblock">
<div class="title">Listing 56. Example filter chain mappings for Basic authentication</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.filterChain.chainMap = [
   [pattern: '/webservice/**', filters: 'JOINED_FILTERS,-exceptionTranslationFilter'],
   [pattern: '/**',            filters: 'JOINED_FILTERS,-basicAuthenticationFilter,-basicExceptionTranslationFilter']
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we&#8217;re using the <code>JOINED_FILTERS</code> keyword instead of explicitly listing the filter names. Specifying <code>JOINED_FILTERS</code> means to use all of the filters that were configured using the various config options. In each case we also specify that we want to exclude one or more filters by prefixing their names with <code>-</code>.</p>
</div>
<div class="paragraph">
<p>For the <code>/webservice/**</code> URLs, we want all filters except for the standard <code>ExceptionTranslationFilter</code> since we want to use just the one configured for Basic Auth. And for the <code>/**</code> URLs (everything else) we want everything except for the Basic authentication filter and its configured <code>ExceptionTranslationFilter</code>.</p>
</div>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Digest_access_authentication">Digest Authentication</a> is similar to Basic but is more secure because it does not send your password in obfuscated cleartext. Digest resembles Basic in practice - you get the same browser popup dialog when you authenticate. But because the credential transfer is genuinely hashed (instead of just Base64-encoded as with Basic authentication) you do not need SSL to guard your logins.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Digest Authentication configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useDigestAuth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use Digest authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digest.realmName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Grails Realm&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Realm name displayed in the browser popup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digest.key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;changeme&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key used to build the nonce for authentication; it should be changed but that&#8217;s not required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digest.nonceValiditySeconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How long a nonce stays valid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digest.passwordAlreadyEncoded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether you are managing the password hashing yourself</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digest.createAuthenticatedToken</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, creates an authenticated <code>UsernamePasswordAuthenticationToken</code> to avoid loading the user from the database twice. However, this process skips the <code>isAccountNonExpired()</code>, <code>isAccountNonLocked()</code>, <code>isCredentialsNonExpired()</code>, and <code>isEnabled()</code> checks, so it is not advised.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digest.useCleartextPasswords</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, a cleartext password encoder is used (not recommended). If <code>false</code>, passwords hashed by <code>DigestAuthPasswordEncoder</code> are stored in the database</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Digest authentication has a problem in that by default you store cleartext passwords in your database. This is because the browser hashes your password along with the username and Realm name, and this is compared to the password hashed using the same algorithm during authentication. The browser does not know about your <code>MessageDigest</code> algorithm or salt source, so to hash them the same way you need to load a cleartext password from the database.</p>
</div>
<div class="paragraph">
<p>The plugin does provide an alternative, although it has no configuration options (in particular the digest algorithm cannot be changed). If <code>digest.useCleartextPasswords</code> is <code>false</code> (the default), then the <code>passwordEncoder</code> bean is replaced with an instance of <code>grails.plugin.springsecurity.authentication.encoding.DigestAuthPasswordEncoder</code>. This encoder uses the same approach as the browser, that is, it combines your password along with your username and Realm name essentially as a salt, and hashes with MD5. MD5 is not recommended in general, but given the typical size of the salt it is reasonably safe to use.</p>
</div>
<div class="paragraph">
<p>The only required attribute is <code>useDigestAuth</code>, which you must set to <code>true</code>, but you probably also want to change the realm name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.useDigestAuth = true
grails.plugin.springsecurity.digest.realmName = "Ralph's Bait and Tackle"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Digest authentication cannot be applied to a subset of URLs like Basic authentication can. This is due to the password encoding issues. So you cannot use the <code>chainMap</code> attribute here - all URLs will be guarded.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that since the Digest authentication password encoder is different from the typical encoders you must pass the username as the &#8220;salt&#8221; value. The code in the generated User class assumes you&#8217;re not using a salt value, so you&#8217;ll need to change the code in <code>encodePassword()</code> from</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">password = springSecurityService.encodePassword(password)</code></pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">password = springSecurityService.encodePassword(password, username)</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="x509">8.2. Certificate (X.509) Login Authentication</h3>
<div class="paragraph">
<p>Another authentication mechanism supported by Spring Security is certificate-based, or &#8220;mutual authentication&#8221;. It requires HTTPS, and you must configure the server to require a client certificate (ordinarily only the server provides a certificate). Your username is extracted from the client certificate if it is valid, and you are &#8220;pre-authenticated&#8221;. As long as a corresponding username exists in the database, your authentication succeeds and you are not asked for a password. Your <code>Authentication</code> contains the authorities associated with your username.</p>
</div>
<div class="paragraph">
<p>The table describes available configuration options.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. X.509 configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useX509</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to support certificate-based logins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x509.continueFilterChainOnUnsuccessfulAuthentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to proceed when an authentication attempt fails to allow other authentication mechanisms to process the request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x509.subjectDnRegex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;CN=(.*?)(?:,|$)&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regular expression for extracting the username from the certificate&#8217;s subject name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x509.checkForPrincipalChanges</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to re-extract the username from the certificate and check that it&#8217;s still the current user when a valid <code>Authentication</code> already exists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x509.invalidateSessionOnPrincipalChange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to invalidate the session if the principal changed (based on a <code>checkForPrincipalChanges</code> check)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x509.subjectDnClosure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set, the plugin&#8217;s <code>ClosureX509PrincipalExtractor</code> class is used to extract information from the X.509 certificate using the specified closure</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x509.throwExceptionWhenTokenRejected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code> thrown a <code>BadCredentialsException</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The details of configuring your server for SSL and configuring browser certificates are beyond the scope of this document. If you use Tomcat, see its <a href="https://tomcat.apache.org/tomcat-8.0-doc/ssl-howto.html">SSL documentation</a>. To get a test environment working, see the instructions in <a href="https://stackoverflow.com/q/1180397/160313">this discussion at Stack Overflow</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="rememberMeCookie">8.3. Remember-Me Cookie</h3>
<div class="paragraph">
<p>Spring Security supports creating a remember-me cookie so that users are not required to log in with a username and password for each session. This is optional and is usually implemented as a checkbox on the login form; the default <code>auth.gsp</code> supplied by the plugin has this feature.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Remember-me configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rememberMe.cookieName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails_remember_me</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remember-me cookie name; should be unique per application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rememberMe.cookieDomain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remember-me cookie domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rememberMe.alwaysRemember</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, create a remember-me cookie even if no checkbox is on the form</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rememberMe.tokenValiditySeconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1209600</code> (14 days)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max age of the cookie in seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rememberMe.parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remember-me</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login form remember-me checkbox name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rememberMe.key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grailsRocks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value used to encode cookies; should be unique per application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rememberMe.useSecureCookie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use a secure cookie or not; if <code>true</code> a secure cookie is created, if <code>false</code> a non-secure cookie is created, and if not set, a secure cookie is created if the request used HTTPS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rememberMe.createSessionOnSuccess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to create a session of one doesn&#8217;t exist to ensure that the <code>Authentication</code> is stored for future requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rememberMe.persistent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, stores persistent login information in the database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rememberMe.persistentToken.domainClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain class used to manage persistent logins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rememberMe.persistentToken.seriesLength</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of characters in the cookie&#8217;s <code>series</code> attribute</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rememberMe.persistentToken.tokenLength</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of characters in the cookie&#8217;s <code>token</code> attribute</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">atr.rememberMeClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/RememberMeAuthenticationToken.html">RememberMeAuthenticationToken</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remember-me authentication class</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You are most likely to change these attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rememberMe.cookieName</code>. Purely aesthetic as most users will not look at their cookies, but you probably want the display name to be application-specific rather than &#8220;grails_remember_me&#8221;.</p>
</li>
<li>
<p><code>rememberMe.key</code>. Part of a salt when the cookie is hashed. Changing the default makes it harder to execute brute-force attacks.</p>
</li>
<li>
<p><code>rememberMe.tokenValiditySeconds</code>. Default is two weeks; set it to what makes sense for your application.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="persistent-logins">8.3.1. Persistent Logins</h4>
<div class="paragraph">
<p>The remember-me cookie is very secure, but for an even stronger solution you can use persistent logins that store the username in the database. See the <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/reference/htmlsingle/#remember-me">Spring Security docs</a> for a description of the implementation.</p>
</div>
<div class="paragraph">
<p>Persistent login is also useful for authentication schemes like Facebook, where you do not manage passwords in your database, but most of the other user information is stored locally. Without a password you cannot use the standard cookie format, so persistent logins enable remember-me cookies in these scenarios.</p>
</div>
<div class="paragraph">
<p>To use this feature, run the <a href="#s2-create-persistent-token">s2-create-persistent-token</a> script. This will create the domain class, and register its name in <code>grails-app/conf/application.groovy</code>. It will also enable persistent logins by setting <code>rememberMe.persistent</code> to <code>true</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ajax">8.4. Ajax Authentication</h3>
<div class="paragraph">
<p>The typical pattern of using web site authentication to access restricted pages involves intercepting access requests for secure pages, redirecting to a login page (possibly off-site, for example when using a Single Sign-on implementation such as <a href="http://grails.org/plugin/spring-security-cas">CAS</a>), and redirecting back to the originally-requested page after a successful login. Each page can also have a login link to allow explicit logins at any time.</p>
</div>
<div class="paragraph">
<p>Another option is to also have a login link on each page and to use JavaScript to present a login form within the current page in a popup. The JavaScript code submits the authentication request and displays success or error messages as appropriate.</p>
</div>
<div class="paragraph">
<p>The plugin supports Ajax logins, but you need to create your own client-side code. There are only a few necessary changes, and of course the sample code here is pretty basic so you should enhance it for your needs.</p>
</div>
<div class="paragraph">
<p>The approach here involves editing your template page(s) to show &#8220;You&#8217;re logged in as &#8230;&#8203;&#8221; text if logged in and a login link if not, along with a hidden login form that is shown using JavaScript.</p>
</div>
<div class="paragraph">
<p>This example uses <a href="https://jquery.com/">jQuery</a> and <a href="http://jquery.iceburg.net/jqModal/">jqModal</a>, a jQuery plugin that creates and manages dialogs and popups. Download <code>jqModal.js</code> and copy it to <code>grails-app/assets/javascripts</code>, and download <code>jqModal.css</code> and copy it to <code>grails-app/assets/stylesheets</code>.</p>
</div>
<div class="paragraph">
<p>Create <code>grails-app/assets/javascripts/ajaxLogin.js</code> and add this JavaScript code:</p>
</div>
<div class="listingblock">
<div class="title"><code>ajaxLogin.js</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">var onLogin;

$.ajaxSetup({
   beforeSend: function(jqXHR, event) {
      if (event.url != $("#ajaxLoginForm").attr("action")) {
         // save the 'success' function for later use if
         // it wasn't triggered by an explicit login click
         onLogin = event.success;
      }
   },
   statusCode: {
      // Set up a global Ajax error handler to handle 401
      // unauthorized responses. If a 401 status code is
      // returned the user is no longer logged in (e.g. when
      // the session times out), so re-display the login form.
      401: function() {
         showLogin();
      }
   }
});

function showLogin() {
   var ajaxLogin = $("#ajaxLogin");
   ajaxLogin.css("text-align", "center");
   ajaxLogin.jqmShow();
}

function logout(event) {
   event.preventDefault();
   $.ajax({
      url: $("#_logout").attr("href"),
      method: "POST",
      success: function(data, textStatus, jqXHR) {
         window.location = "/";
      },
      error: function(jqXHR, textStatus, errorThrown) {
         console.log("Logout error, textStatus: " + textStatus +
                     ", errorThrown: " + errorThrown);
      }
   });
}

function authAjax() {
   $("#loginMessage").html("Sending request ...").show();

   var form = $("#ajaxLoginForm");
   $.ajax({
      url:       form.attr("action"),
      method:   "POST",
      data:      form.serialize(),
      dataType: "JSON",
      success: function(json, textStatus, jqXHR) {
         if (json.success) {
            form[0].reset();
            $("#loginMessage").empty();
            $("#ajaxLogin").jqmHide();
            $("#loginLink").html(
               'Logged in as ' + json.username +
               ' (&lt;a href="' + $("#_logout").attr("href") +
               '" id="logout"&gt;Logout&lt;/a&gt;)');
            $("#logout").click(logout);
            if (onLogin) {
               // execute the saved event.success function
               onLogin(json, textStatus, jqXHR);
            }
         }
         else if (json.error) {
            $("#loginMessage").html('&lt;span class="errorMessage"&gt;' +
                                    json.error + "&lt;/error&gt;");
         }
         else {
            $("#loginMessage").html(jqXHR.responseText);
         }
      },
      error: function(jqXHR, textStatus, errorThrown) {
         if (jqXHR.status == 401 &amp;&amp; jqXHR.getResponseHeader("Location")) {
            // the login request itself wasn't allowed, possibly because the
            // post url is incorrect and access was denied to it
            $("#loginMessage").html('&lt;span class="errorMessage"&gt;' +
               'Sorry, there was a problem with the login request&lt;/error&gt;');
         }
         else {
            var responseText = jqXHR.responseText;
            if (responseText) {
               var json = $.parseJSON(responseText);
               if (json.error) {
                  $("#loginMessage").html('&lt;span class="errorMessage"&gt;' +
                                          json.error + "&lt;/error&gt;");
                  return;
               }
            }
            else {
               responseText = "Sorry, an error occurred (status: " +
                              textStatus + ", error: " + errorThrown + ")";
            }
            $("#loginMessage").html('&lt;span class="errorMessage"&gt;' +
                                    responseText + "&lt;/error&gt;");
         }
      }
   });
}

$(function() {
   $("#ajaxLogin").jqm({ closeOnEsc: true });
   $("#ajaxLogin").jqmAddClose("#cancelLogin");
   $("#ajaxLoginForm").submit(function(event) {
      event.preventDefault();
      authAjax();
   });
   $("#authAjax").click(authAjax);
   $("#logout").click(logout);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>and create <code>grails-app/assets/stylesheets/ajaxLogin.css</code> and add this CSS:</p>
</div>
<div class="listingblock">
<div class="title"><code>ajaxLogin.css</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="css">#ajaxLogin {
   padding:    0px;
   text-align: center;
   display:    none;
}

#ajaxLogin .inner {
   width:              400px;
   padding-bottom:     6px;
   margin:             60px auto;
   text-align:         left;
   border:             1px solid #aab;
   background-color:   #f0f0fa;
   -moz-box-shadow:    2px 2px 2px #eee;
   -webkit-box-shadow: 2px 2px 2px #eee;
   -khtml-box-shadow:  2px 2px 2px #eee;
   box-shadow:         2px 2px 2px #eee;
}

#ajaxLogin .inner .fheader {
   padding:          18px 26px 14px 26px;
   background-color: #f7f7ff;
   margin:           0px 0 14px 0;
   color:            #2e3741;
   font-size:        18px;
   font-weight:      bold;
}

#ajaxLogin .inner .cssform p {
   clear:         left;
   margin:        0;
   padding:       4px 0 3px 0;
   padding-left:  105px;
   margin-bottom: 20px;
   height:        1%;
}

#ajaxLogin .inner .cssform input[type="text"],
#ajaxLogin .inner .cssform input[type="password"] {
   width: 150px;
}

#ajaxLogin .inner .cssform label {
   font-weight:   bold;
   float:         left;
   text-align:    right;
   margin-left:  -105px;
   width:         150px;
   padding-top:   3px;
   padding-right: 10px;
}

.ajaxLoginButton {
   background-color: #efefef;
   font-weight: bold;
   padding: 0.5em 1em;
   display: -moz-inline-stack;
   display: inline-block;
   vertical-align: middle;
   white-space: nowrap;
   overflow: visible;
   text-decoration: none;
      -moz-border-radius: 0.3em;
   -webkit-border-radius: 0.3em;
           border-radius: 0.3em;
}

.ajaxLoginButton:hover, .ajaxLoginButton:focus {
   background-color: #999999;
   color: #ffffff;
}

#ajaxLogin .inner .login_message {
   padding: 6px 25px 20px 25px;
   color:   #c33;
}

#ajaxLogin .inner .text_ {
   width: 120px;
}

#ajaxLogin .inner .chk {
   height: 12px;
}

.errorMessage {
   color: red;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s no need to register the JavaScript files in <code>grails-app/assets/javascripts/application.js</code> if you have this <code>require_tree</code> directive:</p>
</div>
<div class="listingblock">
<div class="title"><code>application.js</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">//= require_tree .</code></pre>
</div>
</div>
<div class="paragraph">
<p>but you can explicitly include them if you want. Register the two CSS files in <code>/grails-app/assets/stylesheets/application.css</code>:</p>
</div>
<div class="listingblock">
<div class="title"><code>application.css</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="css">/*
 ...
 *= require ajaxLogin
 *= require jqModal
 ...
 */</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll need some GSP code to define the HTML, so create <code>grails-app/views/includes/_ajaxLogin.gsp</code> and add this:</p>
</div>
<div class="listingblock">
<div class="title"><code>_ajaxLogin.gsp</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;span id="logoutLink" style="display: none;"&gt;
&lt;g:link elementId='_logout' controller='logout'&gt;Logout&lt;/g:link&gt;
&lt;/span&gt;

&lt;span id="loginLink" style="position: relative; margin-right: 30px; float: right"&gt;
&lt;sec:ifLoggedIn&gt;
   Logged in as &lt;sec:username/&gt; (&lt;g:link elementId='logout' controller='logout'&gt;Logout&lt;/g:link&gt;)
&lt;/sec:ifLoggedIn&gt;
&lt;sec:ifNotLoggedIn&gt;
   &lt;a href="#" onclick="showLogin(); return false;"&gt;Login&lt;/a&gt;
&lt;/sec:ifNotLoggedIn&gt;
&lt;/span&gt;

&lt;div id="ajaxLogin" class="jqmWindow" style="z-index: 3000;"&gt;
   &lt;div class="inner"&gt;
      &lt;div class="fheader"&gt;Please Login..&lt;/div&gt;
      &lt;form action="${request.contextPath}/login/authenticate" method="POST"
            id="ajaxLoginForm" name="ajaxLoginForm" class="cssform" autocomplete="off"&gt;
         &lt;p&gt;
            &lt;label for="username"&gt;Username:&lt;/label&gt;
            &lt;input type="text" class="text_" name="username" id="username" /&gt;
         &lt;/p&gt;
         &lt;p&gt;
            &lt;label for="password"&gt;Password&lt;/label&gt;
            &lt;input type="password" class="text_" name="password" id="password" /&gt;
         &lt;/p&gt;
         &lt;p&gt;
            &lt;label for="remember_me"&gt;Remember me&lt;/label&gt;
            &lt;input type="checkbox" class="chk" id="remember_me" name="remember-me"/&gt;
         &lt;/p&gt;
         &lt;p&gt;
            &lt;input type="submit" id="authAjax" name="authAjax"
                   value="Login" class="ajaxLoginButton" /&gt;
            &lt;input type="button" id="cancelLogin" value="Cancel"
                   class="ajaxLoginButton" /&gt;
         &lt;/p&gt;
      &lt;/form&gt;
      &lt;div style="display: none; text-align: left;" id="loginMessage"&gt;&lt;/div&gt;
   &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally, update the <code>grails-app/views/layouts/main.gsp</code> layout to include <code>_ajaxLogin.gsp</code>, adding it after the <code>&lt;body&gt;</code> tag:</p>
</div>
<div class="listingblock">
<div class="title"><code>main.gsp</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;html lang="en" class="no-js"&gt;
   &lt;head&gt;
      ...
      &lt;g:layoutHead/&gt;
   &lt;/head&gt;
   &lt;body&gt;
      &lt;g:render template='/includes/ajaxLogin'/&gt;
      ...
      &lt;g:layoutBody/&gt;
   &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The important aspects of this code are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is a &lt;span&gt; positioned in the top-right that shows the username and a logout link when logged in, and a login link otherwise.</p>
</li>
<li>
<p>The form posts to the same URL as the regular form, <code>/login/authenticate</code>, and is mostly the same except for the addition of a &#8220;Cancel&#8221; button (you can also dismiss the dialog by clicking outside of it or with the escape key).</p>
</li>
<li>
<p>Error messages are displayed within the popup &lt;div&gt;.</p>
</li>
<li>
<p>Because there is no page redirect after successful login, the Javascript replaces the login link to give a visual indication that the user is logged in.</p>
</li>
<li>
<p>The Logout link also uses Ajax to submit a POST request to the standard logout url and redirect you to the index page after the request finishes.</p>
<div class="ulist">
<ul>
<li>
<p>Note that in the JavaScript <code>logout</code> function, you&#8217;ll need to change the url in the <code>success</code> callback to the correct post-logout value, e.g. <code>window.location = "/appname";</code> if you have configured the contextPath to be "/appname"</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="how-does-ajax-login-work">8.4.1. How Does Ajax login Work?</h4>
<div class="paragraph">
<p>Most Ajax libraries include an <code>X-Requested-With</code> header that indicates that the request was made by <code>XMLHttpRequest</code> instead of being triggered by clicking a regular hyperlink or form submit button. The plugin uses this header to detect Ajax login requests, and uses subclasses of some of Spring Security&#8217;s classes to use different redirect urls for Ajax requests than regular requests. Instead of showing full pages, <code>LoginController</code> has JSON-generating methods <code>ajaxSuccess()</code>, <code>ajaxDenied()</code>, and <code>authfail()</code> that generate JSON that the login Javascript code can use to appropriately display success or error messages.</p>
</div>
<div class="paragraph">
<p>To summarize, the typical flow would be</p>
</div>
<div class="ulist">
<ul>
<li>
<p>click the link to display the login form</p>
</li>
<li>
<p>enter authentication details and click Login</p>
</li>
<li>
<p>the form is submitted using an Ajax request</p>
</li>
<li>
<p>if the authentication succeeds:</p>
<div class="ulist">
<ul>
<li>
<p>a redirect to <code>/login/ajaxSuccess</code> occurs (this URL is configurable)</p>
</li>
<li>
<p>the rendered response is JSON and it contains two values, a boolean value <code>success</code> with the value <code>true</code> and a string value <code>username</code> with the authenticated user&#8217;s login name</p>
</li>
<li>
<p>the client determines that the login was successful and updates the page to indicate the the user is logged in; this is necessary since there&#8217;s no page redirect like there would be for a non-Ajax login</p>
</li>
</ul>
</div>
</li>
<li>
<p>if the authentication fails:</p>
<div class="ulist">
<ul>
<li>
<p>a redirect to <code>/login/authfail?ajax=true</code> occurs (this URL is configurable)</p>
</li>
<li>
<p>the rendered response is JSON and it contains one value, a string value <code>error</code> with the displayable error message; this will be different depending on why the login was unsuccessful (bad username or password, account locked, etc.)</p>
</li>
<li>
<p>the client determines that the login was not successful and displays the error message</p>
</li>
</ul>
</div>
</li>
<li>
<p>note that both a successful and an unsuccessful login will trigger the <code>onSuccess</code> Ajax callback; the <code>onError</code> callback will only be triggered if there&#8217;s an exception or network issue</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authenticationProviders">9. Authentication Providers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The plugin registers authentication providers that perform authentication by implementing the <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/AuthenticationProvider.html">AuthenticationProvider</a> interface.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Authentication provider configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">providerNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['daoAuthenticationProvider', 'anonymousAuthenticationProvider', 'rememberMeAuthenticationProvider']</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean names of authentication providers</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use <code>daoAuthenticationProvider</code> to authenticate using the User and Role database tables, <code>rememberMeAuthenticationProvider</code> to log in with a rememberMe cookie, and <code>anonymousAuthenticationProvider</code> to create an &#8220;anonymous&#8221; authentication if no other provider authenticates.</p>
</div>
<div class="paragraph">
<p>To customize this list, you define a <code>providerNames</code> attribute with a list of bean names. The beans must be declared either by the plugin, or yourself in <code>resources.groovy</code>. Suppose you have a custom <code>MyAuthenticationProvider</code> in <code>resources.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 57. Registering a custom authentication provider bean in <code>resources.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import com.foo.MyAuthenticationProvider

beans = {
   myAuthenticationProvider(MyAuthenticationProvider) {
      // attributes
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You register the provider in <code>grails-app/conf/application.groovy</code> as:</p>
</div>
<div class="listingblock">
<div class="title">Listing 58. Registering a custom authentication provider name in <code>grails.plugin.springsecurity.providerNames</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.providerNames = [
   'myAuthenticationProvider',
   'anonymousAuthenticationProvider',
   'rememberMeAuthenticationProvider']</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="userDetailsService">10. Custom UserDetailsService</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you authenticate users from a database using <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/dao/DaoAuthenticationProvider.html">DaoAuthenticationProvider</a> (the default mode in the plugin if you have not enabled OpenID, LDAP, and so on), an implementation of <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/userdetails/UserDetailsService.html">UserDetailsService</a> is required. This class is responsible for returning a concrete implementation of <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/userdetails/UserDetails.html">UserDetails</a>. The plugin provides <code>grails.plugin.springsecurity.userdetails.GormUserDetailsService</code> as its <code>UserDetailsService</code> implementation and <code>grails.plugin.springsecurity.userdetails.GrailsUser</code> (which extends Spring Security&#8217;s <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/userdetails/User.html">User</a>) as its <code>UserDetails</code> implementation.</p>
</div>
<div class="paragraph">
<p>You can extend or replace <code>GormUserDetailsService</code> with your own implementation by defining a bean in <code>grails-app/conf/spring/resources.groovy</code> with the same bean name, <code>userDetailsService</code>. This works because application beans are configured after plugin beans and there can only be one bean for each name. The plugin uses an extension of <code>UserDetailsService</code>, <code>grails.plugin.springsecurity.userdetails.GrailsUserDetailsService</code>, which adds the method <code>UserDetails loadUserByUsername(String username, boolean loadRoles)</code> to support use cases like in LDAP where you often infer all roles from LDAP but might keep application-specific user details in the database. Create the class in <code>src/groovy</code> and not in <code>grails-app/services</code> - although the interface name includes &#8220;Service&#8221;, this is just a coincidence and the bean wouldn&#8217;t benefit from being a Grails service.</p>
</div>
<div class="paragraph">
<p>In the following example, the <code>UserDetails</code> and <code>GrailsUserDetailsService</code> implementation adds the full name of the user domain class in addition to the standard information. If you extract extra data from your domain class, you are less likely to need to reload the user from the database. Most of your common data can be kept along with your security credentials.</p>
</div>
<div class="paragraph">
<p>This example adds in a <code>fullName</code> property. Keeping the full name cached avoids hitting the database just for that lookup. <code>GrailsUser</code> already adds the <code>id</code> value from the domain class to so we can do a more efficient database load of the user. If all you have is the username, then you need to call <code>User.findByUsername(principal.username)</code>, but if you have the id you can call <code>User.get(principal.id)</code>. Even if you have a unique index on the <code>username</code> database column, loading by primary key is usually more efficient because it takes advantage of Hibernate&#8217;s first-level and second-level caches.</p>
</div>
<div class="paragraph">
<p>There is not much to implement other than your application-specific lookup code:</p>
</div>
<div class="listingblock">
<div class="title"><code>MyUserDetails.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.plugin.springsecurity.userdetails.GrailsUser
import org.springframework.security.core.GrantedAuthority

class MyUserDetails extends GrailsUser {

   final String fullName

   MyUserDetails(String username, String password, boolean enabled,
                 boolean accountNonExpired, boolean credentialsNonExpired,
                 boolean accountNonLocked,
                 Collection&lt;GrantedAuthority&gt; authorities,
                 long id, String fullName) {
      super(username, password, enabled, accountNonExpired,
            credentialsNonExpired, accountNonLocked, authorities, id)

      this.fullName = fullName
   }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>MyUserDetailsService.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.plugin.springsecurity.SpringSecurityUtils
import grails.plugin.springsecurity.userdetails.GrailsUserDetailsService
import grails.plugin.springsecurity.userdetails.NoStackUsernameNotFoundException
import grails.gorm.transactions.Transactional
import org.springframework.security.core.authority.SimpleGrantedAuthority
import org.springframework.security.core.userdetails.UserDetails
import org.springframework.security.core.userdetails.UsernameNotFoundException

class MyUserDetailsService implements GrailsUserDetailsService {

   /**
    * Some Spring Security classes (e.g. RoleHierarchyVoter) expect at least
    * one role, so we give a user with no granted roles this one which gets
    * past that restriction but doesn't grant anything.
    */
   static final List NO_ROLES = [new SimpleGrantedAuthority(SpringSecurityUtils.NO_ROLE)]

   UserDetails loadUserByUsername(String username, boolean loadRoles)
         throws UsernameNotFoundException {
      return loadUserByUsername(username)
   }

   @Transactional(readOnly=true, noRollbackFor=[IllegalArgumentException, UsernameNotFoundException])
   UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {

      User user = User.findByUsername(username)
      if (!user) throw new NoStackUsernameNotFoundException()

      def roles = user.authorities

      // or if you are using role groups:
      // def roles = user.authorities.collect { it.authorities }.flatten().unique()

      def authorities = roles.collect {
         new SimpleGrantedAuthority(it.authority)
      }

      return new MyUserDetails(user.username, user.password, user.enabled,
            !user.accountExpired, !user.passwordExpired,
            !user.accountLocked, authorities ?: NO_ROLES, user.id,
            user.firstName + " " + user.lastName)
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>loadUserByUsername</code> method is transactional, but read-only, to avoid lazy loading exceptions when accessing the <code>authorities</code> collection. There are obviously no database updates here but this is a convenient way to keep the Hibernate <code>Session</code> open to enable accessing the roles.</p>
</div>
<div class="paragraph">
<p>To use your implementation, register it in <code>grails-app/conf/spring/resources.groovy</code> like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 59. Registering a custom <code>UserDetailsService</code> in <code>resources.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import com.mycompany.myapp.MyUserDetailsService

beans = {
   userDetailsService(MyUserDetailsService)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another option for loading users and roles from the database is to subclass <code>grails.plugin.springsecurity.userdetails.GormUserDetailsService</code> - the methods are all protected so you can override as needed.</p>
</div>
<div class="paragraph">
<p>This approach works with all beans defined in <code>SpringSecurityCoreGrailsPlugin.doWithSpring()</code> - you can replace or subclass any of the Spring beans to provide your own functionality when the standard extension mechanisms are insufficient.</p>
</div>
<div class="sect2">
<h3 id="flushing-the-cached-authentication">10.1. Flushing the Cached Authentication</h3>
<div class="paragraph">
<p>If you store mutable data in your custom <code>UserDetails</code> implementation (such as full name in the preceding example), be sure to rebuild the <code>Authentication</code> if it changes. <code>springSecurityService</code> has a <code>reauthenticate</code> method that does this for you:</p>
</div>
<div class="listingblock">
<div class="title">Listing 60. Calling <code>reauthenticate()</code> after making a change that affects the cached authentication</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyController {

   def springSecurityService

   def someAction() {
      def user = ...
      // update user data
      user.save()
      springSecurityService.reauthenticate user.username
      ...
   }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="passwords">11. Password and Account Protection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The sections that follow discuss approaches to protecting passwords and user accounts.</p>
</div>
<div class="sect2">
<h3 id="hashing">11.1. Password Hashing</h3>
<div class="paragraph">
<p>By default the plugin uses the bcrypt algorithm to hash passwords. You can customize this with the <code>grails.plugin.springsecurity.password.algorithm</code> attribute as described below. In addition you can increase the security of your passwords by adding a salt, which can be a property of the <code>UserDetails</code> instance, a global static value, or any custom value you want.</p>
</div>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Bcrypt">bcrypt</a> is a much more secure alternative to the message digest approaches since it supports a customizable work level which when increased takes more computation time to hash the users' passwords, but also dramatically increases the cost of brute force attacks. Given how easy it is to <a href="https://www.google.com/search?q=gpu%20password%20cracking">use GPUs to crack passwords</a>, you should definitely consider using bcrypt for new projects and switching to it for existing projects. Note that due to the approach used by bcrypt, you cannot add an additional salt like you can with the message digest algorithms.</p>
</div>
<div class="paragraph">
<p>Enable bcrypt by using the <code>'bcrypt'</code> value for the <code>algorithm</code> config attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.password.algorithm = 'bcrypt'</code></pre>
</div>
</div>
<div class="paragraph">
<p>and optionally changing the number of rekeying rounds (which will affect the time it takes to hash passwords), e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.password.bcrypt.logrounds = 15</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the number of rounds must be between 4 and 31.</p>
</div>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a> is also supported.</p>
</div>
<div class="paragraph">
<p>The table shows configurable password hashing attributes.</p>
</div>
<div class="paragraph">
<p>If you want to use a message digest hashing algorithm, see <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html">this Java page</a> for the available algorithms.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Password Hashing configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password.algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;bcrypt&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">passwordEncoder algorithm; &#8220;bcrypt&#8221; to use bcrypt, &#8220;pbkdf2&#8221; to use PBKDF2, or any message digest algorithm that is supported in your JDK</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password.encodeHashAsBase64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, Base64-encode the hashed password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password.bcrypt.logrounds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the number of rekeying rounds to use when using bcrypt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password.hash.iterations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the number of iterations which will be executed on the hashed password/salt when using a message digest algorithm</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The bcrypt <code>logrounds</code> and <code>iterations</code> are set to a lower number to improve speed while testing.
If you rely on them to be higher, set them manually when testing.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="salt">11.2. Salted Passwords</h3>
<div class="paragraph">
<p>The Spring Security plugin uses hashed passwords and a digest algorithm that you specify. For enhanced protection against dictionary attacks, you should use a salt in addition to digest hashing.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that if you use bcrypt (the default setting) or pbkdf2, do not configure a salt (e.g. the <code>dao.reflectionSaltSourceProperty</code> property or a custom <code>saltSource</code> bean) because these algorithms use their own internally.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are two approaches to using salted passwords in the plugin - defining a property in the <code>UserDetails</code> class to access by reflection, or by directly implementing <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/dao/SaltSource.html">SaltSource</a> yourself.</p>
</div>
<div class="sect3">
<h4 id="dao-reflectionsaltsourceproperty">11.2.1. dao.reflectionSaltSourceProperty</h4>
<div class="paragraph">
<p>Set the <code>dao.reflectionSaltSourceProperty</code> configuration property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.dao.reflectionSaltSourceProperty = 'username'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This property belongs to the <code>UserDetails</code> class. By default it is an instance of <code>grails.plugin.springsecurity.userdetails.GrailsUser</code>, which extends the standard Spring Security <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/userdetails/User.html">User class</a> and not your &#8220;person&#8221; domain class. This limits the available properties unless you use a custom UserDetailsService (<a href="#userDetailsService">Custom UserDetailsService</a>).</p>
</div>
<div class="paragraph">
<p>As long as the username does not change, this approach works well for the salt. If you choose a property that the user can change, the user cannot log in again after changing it unless you re-hash the password with the new value. So it&#8217;s best to use a property that doesn&#8217;t change.</p>
</div>
<div class="paragraph">
<p>Another option is to generate a random salt when creating users and store this in the database by adding a new property to the &#8220;person&#8221; class. This approach requires a custom <code>UserDetailsService</code> because you need a custom <code>UserDetails</code> implementation that also has a &#8220;salt&#8221; property, but this is more flexible and works in cases where users can change their username.</p>
</div>
</div>
<div class="sect3">
<h4 id="systemwidesaltsource-and-custom-saltsource">11.2.2. SystemWideSaltSource and Custom SaltSource</h4>
<div class="paragraph">
<p>Spring Security supplies a simple <code>SaltSource</code> implementation, <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/dao/SystemWideSaltSource.html">SystemWideSaltSource</a>, which uses the same salt for each user. It&#8217;s less robust than using a different value for each user but still better than no salt at all.</p>
</div>
<div class="paragraph">
<p>An example override of the salt source bean using SystemWideSaltSource would look like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 61. Configuring <code>SystemWideSaltSource</code> as the <code>saltSource</code> bean in <code>application.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.springframework.security.authentication.dao.SystemWideSaltSource

beans = {
   saltSource(SystemWideSaltSource) {
      systemWideSalt = 'the_salt_value'
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To have full control over the process, you can implement the <code>SaltSource</code> interface and replace the plugin&#8217;s implementation with your own by defining a bean in <code>grails-app/conf/spring/resources.groovy</code> with the name <code>saltSource</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 62. Configuring a custom implementation of the <code>saltSource</code> bean in <code>application.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import com.foo.bar.MySaltSource

beans = {
   saltSource(MySaltSource) {
      // set properties
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hashing-passwords">11.2.3. Hashing Passwords</h4>
<div class="paragraph">
<p>Regardless of the implementation, you need to be aware of what value to use for a salt when creating or updating users, for example, in a <code>save</code> or <code>update</code> action in a <code>UserController</code>. When hashing the password, use the two-parameter version of <code>springSecurityService.encodePassword()</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 63. Explicitly hashing passwords</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class UserController {

   def springSecurityService

   def save(User user) {
      user.password = springSecurityService.encodePassword(
            params.password, user.username)
      if (!user.save(flush: true)) {
         render view: 'create', model: [userInstance: user]
         return
      }

      flash.message = "The user was created"
      redirect action: show, id: user.id
   }

   def update(User user) {

      if (params.password) {
         params.password = springSecurityService.encodePassword(
                    params.password, user.username)
      }
      if (!user.save(flush: true)) {
         render view: 'edit', model: [userInstance: user]
         return
      }

      if (springSecurityService.loggedIn &amp;&amp;
               springSecurityService.principal.username == user.username) {
         springSecurityService.reauthenticate user.username
      }

      flash.message = "The user was updated"
      redirect action: show, id: user.id
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are encoding the password in the User domain class (using <code>beforeInsert</code> and <code>encodePassword</code>) then don&#8217;t call <code>springSecurityService.encodePassword()</code> in your controller since you&#8217;ll double-hash the password and users won&#8217;t be able to log in. It&#8217;s best to encapsulate the password handling logic in the domain class. In newer versions of the plugin (version 1.2 and higher) code is auto-generated in the user class so you&#8217;ll need to adjust that password hashing for your salt approach.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="locking">11.3. Account Locking and Forcing Password Change</h3>
<div class="paragraph">
<p>Spring Security supports four ways of disabling a user account. When you attempt to log in, the <code>UserDetailsService</code> implementation creates an instance of <code>UserDetails</code> that uses these accessor methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>isAccountNonExpired()</code></p>
</li>
<li>
<p><code>isAccountNonLocked()</code></p>
</li>
<li>
<p><code>isCredentialsNonExpired()</code></p>
</li>
<li>
<p><code>isEnabled()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you use the <a href="#s2-quickstart">s2-quickstart</a> script to create a user domain class, it creates a class with corresponding properties to manage this state.</p>
</div>
<div class="paragraph">
<p>When an accessor returns <code>true</code> for <code>accountExpired</code>, <code>accountLocked</code>, or <code>passwordExpired</code> or returns <code>false</code> for <code>enabled</code>, a corresponding exception is thrown:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Account locked and disabled exceptions</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Accessor</strong></th>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Exception</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isAccountNonExpired()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>accountExpired</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/AccountExpiredException.html">AccountExpiredException</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isAccountNonLocked()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>accountLocked</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/LockedException.html">LockedException</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isCredentialsNonExpired()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>passwordExpired</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/CredentialsExpiredException.html">CredentialsExpiredException</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isEnabled()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/DisabledException.html">DisabledException</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can configure exception mappings in <code>application.groovy</code> to associate a URL to any or all of these exceptions to determine where to redirect after a failure, for example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 64. Example <code>grails.plugin.springsecurity.failureHandler.exceptionMappings</code> configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import org.springframework.security.authentication.LockedException
import org.springframework.security.authentication.DisabledException
import org.springframework.security.authentication.AccountExpiredException
import org.springframework.security.authentication.CredentialsExpiredException

grails.plugin.springsecurity.failureHandler.exceptionMappings = [
   [exception: LockedException.name,             url: '/user/accountLocked'],
   [exception: DisabledException.name,           url: '/user/accountDisabled'],
   [exception: AccountExpiredException.name,     url: '/user/accountExpired'],
   [exception: CredentialsExpiredException.name, url: '/user/passwordExpired']
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without a mapping for a particular exception, the user is redirected to the standard login fail page (by default <code>/login/authfail</code>), which displays an error message from this table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Login failure messages</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errors.login.disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Sorry, your account is disabled.&#8221;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errors.login.expired</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Sorry, your account has expired.&#8221;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errors.login.passwordExpired</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Sorry, your password has expired.&#8221;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errors.login.locked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Sorry, your account is locked.&#8221;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errors.login.fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Sorry, we were not able to find a user with that username and password.&#8221;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can customize these messages by setting the corresponding property in <code>application.groovy</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.errors.login.locked = "None shall pass."</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this functionality to manually lock a user&#8217;s account or expire the password, but you can automate the process. For example, use the <a href="https://grails.org/plugin/quartz">Quartz plugin</a> to periodically expire everyone&#8217;s password and force them to go to a page where they update it. Keep track of the date when users change their passwords and use a Quartz job to expire their passwords once the password is older than a fixed max age.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example for a password expired workflow. You&#8217;d need a simple action to display a password reset form (similar to the login form):</p>
</div>
<div class="listingblock">
<div class="title">Listing 65. Adding a <code>passwordExpired()</code> controller action</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def passwordExpired() {
   [username: session['SPRING_SECURITY_LAST_USERNAME']]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the form would look something like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 66. Sample GSP code for a password reset page</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;div id='login'&gt;
   &lt;div class='inner'&gt;
      &lt;g:if test='${flash.message}'&gt;
      &lt;div class='login_message'&gt;${flash.message}&lt;/div&gt;
      &lt;/g:if&gt;
      &lt;div class='fheader'&gt;Please update your password..&lt;/div&gt;
      &lt;g:form action='updatePassword' id='passwordResetForm' class='cssform' autocomplete='off'&gt;
         &lt;p&gt;
            &lt;label for='username'&gt;Username&lt;/label&gt;
            &lt;span class='text_'&gt;${username}&lt;/span&gt;
         &lt;/p&gt;
         &lt;p&gt;
            &lt;label for='password'&gt;Current Password&lt;/label&gt;
            &lt;g:passwordField name='password' class='text_' /&gt;
         &lt;/p&gt;
         &lt;p&gt;
            &lt;label for='password'&gt;New Password&lt;/label&gt;
            &lt;g:passwordField name='password_new' class='text_' /&gt;
         &lt;/p&gt;
         &lt;p&gt;
            &lt;label for='password'&gt;New Password (again)&lt;/label&gt;
            &lt;g:passwordField name='password_new_2' class='text_' /&gt;
         &lt;/p&gt;
         &lt;p&gt;
            &lt;input type='submit' value='Reset' /&gt;
         &lt;/p&gt;
      &lt;/g:form&gt;
   &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s important that you not allow the user to specify the username (it&#8217;s available in the HTTP session) but that you require the current password, otherwise it would be simple to forge a password reset.</p>
</div>
<div class="paragraph">
<p>The GSP form would submit to an action like this one:</p>
</div>
<div class="listingblock">
<div class="title">Listing 67. Adding an <code>updatePassword()</code> controller action</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">def updatePassword(String password, String password_new, String password_new_2) {
   String username = session['SPRING_SECURITY_LAST_USERNAME']
   if (!username) {
      flash.message = 'Sorry, an error has occurred'
      redirect controller: 'login', action: 'auth'
      return
   }

   if (!password || !password_new || !password_new_2 || password_new != password_new_2) {
      flash.message = 'Please enter your current password and a valid new password'
      render view: 'passwordExpired', model: [username: session['SPRING_SECURITY_LAST_USERNAME']]
      return
   }

   User user = User.findByUsername(username)
   if (!passwordEncoder.matches(password, user.password)) {
      flash.message = 'Current password is incorrect'
      render view: 'passwordExpired', model: [username: session['SPRING_SECURITY_LAST_USERNAME']]
      return
   }

   if (passwordEncoder.matches(password_new, user.password)) {
      flash.message = 'Please choose a different password from your current one'
      render view: 'passwordExpired', model: [username: session['SPRING_SECURITY_LAST_USERNAME']]
      return
   }

   user.password = password_new
   user.passwordExpired = false
   user.save() // if you have password constraints check them here

   redirect controller: 'login', action: 'auth'
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="user-cache">11.3.1. User Cache</h4>
<div class="paragraph">
<p>If the <code>cacheUsers</code> configuration property is set to <code>true</code>, Spring Security caches <code>UserDetails</code> instances to save trips to the database (the default is <code>false</code>). This optimization is minor, because typically only two small queries occur during login&#8201;&#8212;&#8201;one to load the user, and one to load the authorities.</p>
</div>
<div class="paragraph">
<p>If you enable this feature, you must remove any cached instances after making a change that affects login. If you do not remove cached instances, even though a user&#8217;s account is locked or disabled, logins succeed because the database is bypassed. By removing the cached data, you force at trip to the database to retrieve the latest updates.</p>
</div>
<div class="paragraph">
<p>Here is a sample Quartz job that demonstrates how to find and disable users with passwords that are too old:</p>
</div>
<div class="listingblock">
<div class="title"><code>ExpirePasswordsJob.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

class ExpirePasswordsJob {

   static triggers = {
      cron name: 'myTrigger', cronExpression: '0 0 0 * * ?' // midnight daily
   }

   def userCache

   void execute() {

      def users = User.executeQuery(
            'from User u where u.passwordChangeDate &lt;= :cutoffDate',
            [cutoffDate: new Date() - 180])

      for (user in users) {
         // flush each separately so one failure doesn't rollback all of the others
         try {
            user.passwordExpired = true
            user.save(flush: true)
            userCache.removeUserFromCache user.username
         }
         catch (e) {
            log.error "problem expiring password for user $user.username : $e.message", e
         }
      }
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your application includes a dependency for <code>org.hibernate:hibernate-ehcache</code> (to provide an Ehcache-based 2nd-level cache implementation) you might have a conflict with the Ehcache dependency. <code>hibernate-ehcache</code> has a dependency for <code>ehcache-core</code>, but this plugin has a dependency for <code>ehcache</code>, so you will end up with both jars in your classpath. <code>hibernate-ehcache</code> works fine with the full <code>ehcache</code> jar, so you can avoid this problem by excluding <code>ehcache-core</code> in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">compile 'org.hibernate:hibernate-ehcache', {
   exclude module: 'ehcache-core'
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="urlProperties">12. URL Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The table shows configurable URL-related properties.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. URL-related Properties</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apf.filterProcessesUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/login/authenticate&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login form post URL, intercepted by Spring Security filter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apf.usernameParameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;username&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login form username parameter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apf.passwordParameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;password&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login form password parameter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apf.allowSessionCreation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to allow authentication to create an HTTP session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apf.postOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to allow only POST login requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apf.continueChainBefore SuccessfulAuthentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">whether to continue calling subsequent filters in the filter chain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apf.storeLastUsername</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to store the login username in the HTTP session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failureHandler.defaultFailureUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/login/authfail?login_error=1&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redirect URL for failed logins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failureHandler.ajaxAuthFailUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/login/authfail?ajax=true&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redirect URL for failed Ajax logins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failureHandler.exceptionMappings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map of exception class name (subclass of <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/AuthenticationException.html">AuthenticationException</a>) to which the URL will redirect for that exception type after authentication failure</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failureHandler.useForward</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to render the error page (<code>true</code>) or redirect (<code>false</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failureHandler.allowSessionCreation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable session creation to store the authentication failure exception</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">successHandler.defaultTargetUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default post-login URL if there is no saved request that triggered the login</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">successHandler.alwaysUseDefault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, always redirects to the value of <code>successHandler.defaultTargetUrl</code> after successful authentication; otherwise redirects to to originally-requested page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">successHandler.targetUrlParameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;spring-security-redirect&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of optional login form parameter that specifies destination after successful login</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">successHandler.useReferer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use the HTTP <code>Referer</code> header to determine post-login destination</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">successHandler.ajaxSuccessUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/login/ajaxSuccess&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL for redirect after successful Ajax login</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auth.loginFormUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/login/auth&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of login page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auth.forceHttps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, redirects login page requests to HTTPS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auth.ajaxLoginFormUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/login/authAjax&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of Ajax login page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auth.useForward</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to render the login page (<code>true</code>) or redirect (<code>false</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout.afterLogoutUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL for redirect after logout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout.filterProcessesUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/logoff&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logout URL, intercepted by Spring Security filter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout.handlerNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['rememberMeServices', 'securityContextLogoutHandler']</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logout handler bean names. See <a href="#logoutHandlers">Logout Handlers</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout.clearAuthentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code> removes the <code>Authentication</code> from the <code>SecurityContext</code> to prevent issues with concurrent requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout.invalidateHttpSession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to invalidate the HTTP session when logging out</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout.targetUrlParameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the querystring parameter name for the post-logout URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout.alwaysUseDefaultTargetUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">whether to always use the <code>afterLogoutUrl</code> as the post-logout URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout.redirectToReferer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">whether to use the <code>Referer</code> header value as the post-logout URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout.postOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code> only POST requests will be allowed to logout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adh.errorPage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/login/denied&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the 403 error page (or set to <code>null</code> to send a 403 error and not render a page)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adh.ajaxErrorPage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/login/ajaxDenied&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the 403 error page for Ajax requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adh.useForward</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code> a forward will be used to render the error page, otherwise a redirect is used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ajaxHeader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;X-Requested-With&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Header name sent by Ajax library, used to detect Ajax</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ajaxCheckClosure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional closure that can determine if a request is Ajax</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">redirectStrategy.contextRelative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the redirect URL will be the value after the request context path. This results in the loss of protocol information (HTTP or HTTPS), so causes problems if a redirect is being performed to change from HTTP to HTTPS or vice versa</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchUser URLs</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#switchUser">Switch User</a>, under <strong>Customizing URLs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fii.alwaysReauthenticate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, re-authenticates when there is a <code>Authentication</code> in the <code>SecurityContext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fii.rejectPublicInvocations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disallow URL access when there is no request mapping</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fii.validateConfigAttributes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to check that all <code>ConfigAttribute</code> instances are valid at startup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fii.publishAuthorizationSuccess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to publish an <code>AuthorizedEvent</code> after successful access check</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fii.observeOncePerRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>false</code> allow checks to happen multiple times, for example when JSP forwards are being used and filter security is desired on each included fragment of the HTTP request</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="hierarchicalRoles">13. Hierarchical Roles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hierarchical roles are a convenient way to reduce clutter in your request mappings.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Hierarchical Roles configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">roleHierarchy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchical role definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">roleHierarchyEntryClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain class used to manage persistent role hierarchy entries</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, if you have several types of &#8220;admin&#8221; roles that can be used to access a URL pattern and you do not use hierarchical roles, you need to specify all the admin roles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.plugin.springsecurity.annotation.Secured

class SomeController {

   @Secured(['ROLE_ADMIN', 'ROLE_FINANCE_ADMIN', 'ROLE_SUPERADMIN'])
   def someAction() {
      ...
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if you have a business rule that says <code>ROLE_FINANCE_ADMIN</code> implies being granted <code>ROLE_ADMIN</code>, and that <code>ROLE_SUPERADMIN</code> implies being granted <code>ROLE_FINANCE_ADMIN</code>, you can express that hierarchy as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.roleHierarchy = '''
   ROLE_SUPERADMIN &gt; ROLE_FINANCE_ADMIN
   ROLE_FINANCE_ADMIN &gt; ROLE_ADMIN
'''</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can simplify your mappings by specifying only the roles that are required:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.plugin.springsecurity.annotation.Secured

class SomeController {

   @Secured('ROLE_ADMIN')
   def someAction() {
      ...
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also reduce the number of granted roles in the database. Where previously you had to grant <code>ROLE_SUPERADMIN</code>, <code>ROLE_FINANCE_ADMIN</code>, and <code>ROLE_ADMIN</code>, now you only need to grant <code>ROLE_SUPERADMIN</code>.</p>
</div>
<div class="sect2">
<h3 id="persistent-role-hierarchy">13.1. Persistent role hierarchy</h3>
<div class="paragraph">
<p>Specifying a static string in the <code>roleHierarchy</code> property will be sufficient for most applications, but you can also store the information in your database. This is particularly useful if you&#8217;re also storing requestmaps in the database. To use persistant storage, run the <a href="#s2-create-role-hierarchy-entry">s2-create-role-hierarchy-entry</a> script. This will create the domain class and enable persistent storage by registering its name as the <code>roleHierarchyEntryClassName</code> setting in <code>grails-app/conf/application.groovy</code>.</p>
</div>
<div class="paragraph">
<p>For example, running</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails s2-create-role-hierarchy-entry com.yourapp.RoleHierarchyEntry</pre>
</div>
</div>
<div class="paragraph">
<p>will generate this class in <code>grails-app/domain/com/yourapp/RoleHierarchyEntry.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title"><code>RoleHierarchyEntry.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.yourapp

import groovy.transform.EqualsAndHashCode
import groovy.transform.ToString

@EqualsAndHashCode(includes='entry')
@ToString(includes='entry', includeNames=true, includePackage=false)
class RoleHierarchyEntry implements Serializable {

   private static final long serialVersionUID = 1

   String entry

   static constraints = {
      entry blank: false, unique: true
   }

   static mapping = {
      cache true
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To store the equivalent entries for the ROLE_SUPERADMIN / ROLE_FINANCE_ADMIN / ROLE_ADMIN hierarchy, add code like this to a method in a transactional service:</p>
</div>
<div class="listingblock">
<div class="title">Listing 68. Persisting <code>RoleHierarchyEntry</code> instances</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">if (!RoleHierarchyEntry.count()) {
   new RoleHierarchyEntry(entry: 'ROLE_SUPERADMIN &gt; ROLE_FINANCE_ADMIN').save()
   new RoleHierarchyEntry(entry: 'ROLE_FINANCE_ADMIN &gt; ROLE_ADMIN').save()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember to update the <code>roleHierarchy</code> beans <code>hierarchy</code> definition by calling <code>SpringSecurityService#reloadDBRoleHierarchy</code>, or your model changes are not reflected in the running application.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="switchUser">14. Switch User</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable a user to switch from the current <code>Authentication</code> to another user&#8217;s, set the <code>useSwitchUserFilter</code> attribute to <code>true</code>. This feature is similar to the &#8220;su&#8221; command in Unix. It enables, for example, an admin to act as a regular user to perform some actions, and then switch back.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is very powerful; it allows full access to everything the switched-to user can access without requiring the user&#8217;s password. Limit who can use this feature by guarding the user switch URL with a role, for example, <code>ROLE_SWITCH_USER</code>, <code>ROLE_ADMIN</code>, and so on.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="switching-to-another-user">14.1. Switching to Another User</h3>
<div class="paragraph">
<p>To switch to another user, typically you create a form that submits to <code>/login/impersonate</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 69. An HTML form for switching to another user</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:ifAllGranted roles='ROLE_SWITCH_USER'&gt;

   &lt;form action='/login/impersonate' method='POST'&gt;
      Switch to user: &lt;input type='text' name='username'/&gt; &lt;br/&gt;
      &lt;input type='submit' value='Switch'/&gt;
   &lt;/form&gt;

&lt;/sec:ifAllGranted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the form is guarded by a check that the logged-in user has <code>ROLE_SWITCH_USER</code> and is not shown otherwise. You also need to guard the user switch URL, and the approach depends on your mapping scheme. If you use annotations, add a rule to the <code>controllerAnnotations.staticRules</code> attribute:</p>
</div>
<div class="listingblock">
<div class="title">Listing 70. Guarding the switch user url with <code>controllerAnnotations.staticRules</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.controllerAnnotations.staticRules = [
   ...
   [pattern: '/login/impersonate', access: ['ROLE_SWITCH_USER', 'IS_AUTHENTICATED_FULLY']]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code>Requestmap</code>s, create a rule like this (for example, in <code>BootStrap</code>):</p>
</div>
<div class="listingblock">
<div class="title">Listing 71. Guarding the switch user url with a database requestmap</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">new Requestmap(url: '/login/impersonate',
               configAttribute: 'ROLE_SWITCH_USER,IS_AUTHENTICATED_FULLY').save(flush: true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use the static <code>application.groovy</code> map, add the rule there:</p>
</div>
<div class="listingblock">
<div class="title">Listing 72. Guarding the switch user url with <code>interceptUrlMap</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.interceptUrlMap = [
   ...
   [pattern: '/login/impersonate', access: ['ROLE_SWITCH_USER', 'IS_AUTHENTICATED_FULLY']]
]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="switching-back-to-original-user">14.2. Switching Back to Original User</h3>
<div class="paragraph">
<p>To resume as the original user, POST to <code>/logout/impersonate</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 73. A link to switch back to the real user</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:ifSwitched&gt;
    &lt;form action='${request.contextPath}/logout/impersonate' method='POST'&gt;
        &lt;input type='submit' value="Resume as ${grails.plugin.springsecurity.SpringSecurityUtils.switchedUserOriginalUsername}"/&gt;
    &lt;/form&gt;
&lt;/sec:ifSwitched&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customizing-urls">14.3. Customizing URLs</h3>
<div class="paragraph">
<p>You can customize the URLs that are used for this feature, although it is rarely necessary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.switchUser.switchUserUrl = ...
grails.plugin.springsecurity.switchUser.exitUserUrl = ...
grails.plugin.springsecurity.switchUser.targetUrl = ...
grails.plugin.springsecurity.switchUser.switchFailureUrl = ...</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Switch user configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useSwitchUserFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use the switch user filter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchUser.switchUserUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/login/impersonate&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL to access (via POST) to switch to another user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchUser.exitUserUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;/logout/impersonate&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL to access (via POST) to switch to another user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchUser.switchUserMatcher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SwitchUserFilter.switchUserMatcher</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An alternative to <code>switchUserUrl</code>, define an <code>AntPathRequestMatcher</code> to determine if a request needs to switch user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchUser.exitUserMatcher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SwitchUserFilter.exitUserMatcher</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An alternative to <code>exitUserUrl</code>, define an <code>AntPathRequestMatcher</code> to determine if a request needs to exit switch user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchUser.targetUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as <code>successHandler.defaultTargetUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL for redirect after switching</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchUser.switchFailureUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as <code>failureHandler.defaultFailureUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL for redirect after an error during an attempt to switch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">switchUser.usernameParameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SwitchUserFilter.SPRING_SECURITY_SWITCH_USERNAME_KEY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username request parameter name</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="gsp-code">14.4. GSP Code</h3>
<div class="paragraph">
<p>One approach to supporting the switch user feature is to add code to one or more of your GSP templates. In this example the current username is displayed, and if the user has switched from another (using the <code>sec:ifSwitched</code> tag) then a &#8220;resume&#8221; button is displayed. If not, and the user has the required role, a form is displayed to allow input of the username to switch to:</p>
</div>
<div class="listingblock">
<div class="title">Listing 74. Example GSP code to conditionally display a switch user form and resume form</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="html">&lt;sec:ifLoggedIn&gt;
Logged in as &lt;sec:username/&gt;
&lt;/sec:ifLoggedIn&gt;

&lt;sec:ifSwitched&gt;
    &lt;form action='${request.contextPath}/logout/impersonate' method='POST'&gt;
      &lt;input type='submit' value="Resume as ${grails.plugin.springsecurity.SpringSecurityUtils.switchedUserOriginalUsername}"/&gt;
   &lt;/form&gt;
&lt;/sec:ifSwitched&gt;

&lt;sec:ifNotSwitched&gt;
   &lt;sec:ifAllGranted roles='ROLE_SWITCH_USER'&gt;

   &lt;form action='${request.contextPath}/login/impersonate' method='POST'&gt;
      Switch to user: &lt;input type='text' name='username'/&gt;&lt;br/&gt;
      &lt;input type='submit' value='Switch'/&gt;
   &lt;/form&gt;

   &lt;/sec:ifAllGranted&gt;
&lt;/sec:ifNotSwitched&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="filters">15. Filters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are a few different approaches to configuring filter chains.</p>
</div>
<div class="sect2">
<h3 id="default-approach-to-configuring-filter-chains">15.1. Default Approach to Configuring Filter Chains</h3>
<div class="paragraph">
<p>The default is to use configuration attributes to determine which extra filters to use (for example, Basic Auth, Switch User, etc.) and add these to the &#8220;core&#8221; filters. For example, setting <code>grails.plugin.springsecurity.useSwitchUserFilter = true</code> adds <code>switchUserProcessingFilter</code> to the filter chain (and in the correct order). The filter chain built here is applied to all URLs. If you need more flexibility, you can use <code>filterChain.chainMap</code> as discussed in <strong>chainMap</strong> below.</p>
</div>
</div>
<div class="sect2">
<h3 id="filternames">15.2. filterNames</h3>
<div class="paragraph">
<p>To define custom filters, to remove a core filter from the Spring Security filter chain (not recommended), or to otherwise have control over the Spring Security filter chain, you can specify the <code>filterNames</code> property as a list of strings. As with the default approach, the Spring Security filter chain built here is applied to all URLs.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 75. Sample <code>grails.plugin.springsecurity.filterChain.filterNames</code> configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.filterChain.filterNames = [
   'securityContextPersistenceFilter', 'logoutFilter',
   'authenticationProcessingFilter', 'myCustomProcessingFilter',
   'rememberMeAuthenticationFilter', 'anonymousAuthenticationFilter',
   'exceptionTranslationFilter', 'filterInvocationInterceptor'
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example creates a Spring Security filter chain corresponding to the Spring beans with the specified names.</p>
</div>
</div>
<div class="sect2">
<h3 id="chainmap">15.3. chainMap</h3>
<div class="paragraph">
<p>Use the <code>filterChain.chainMap</code> attribute to define which filters are applied to different URL patterns. You define a Map that specifies one or more lists of filter bean names, each with a corresponding URL pattern.</p>
</div>
<div class="listingblock">
<div class="title">Listing 76. Sample <code>grails.plugin.springsecurity.filterChain.chainMap</code> configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.filterChain.chainMap = [
   [pattern: '/urlpattern1/**', filters: 'filter1,filter2,filter3,filter4'],
   [pattern: '/urlpattern2/**', filters: 'filter1,filter3,filter5'],
   [pattern: '/**',             filters: 'JOINED_FILTERS']
]</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The format of <code>filterChain.chainMap</code> has changed from previous versions to avoid configuration parsing issues. In previous versions the property was a single Map, where the keys were the access patterns and the values were filter names. The old format is no longer supported and your configurations must be updated to the newer format.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, four filters are applied to URLs matching <code>/urlpattern1/**</code> and three different filters are applied to URLs matching <code>/urlpattern2/**</code>. In addition the special token <code>JOINED_FILTERS</code> is applied to all URLs. This is a conventient way to specify that all defined filters (configured either with configuration rules like <code>useSwitchUserFilter</code> or explicitly using <code>filterNames</code>) should apply to this pattern.</p>
</div>
<div class="paragraph">
<p>The order of the mappings is important. Each URL will be tested in order from top to bottom to find the first matching one. So you need a <code>/**</code> catch-all rule at the end for URLs that do not match one of the earlier rules.</p>
</div>
<div class="paragraph">
<p>There&#8217;s also a filter negation syntax that can be very convenient. Rather than specifying all of the filter names (and risking forgetting one or putting them in the wrong order), you can use the <code>JOINED_FILTERS</code> keyword and one or more filter names prefixed with a <code>-</code> . This means to use all configured filters except for the excluded ones. For example, if you had a web service that uses Basic Auth for <code>/webservice/**</code> URLs, you would configure that using:</p>
</div>
<div class="listingblock">
<div class="title">Listing 77. Using <code>JOINED_FILTERS</code> in a <code>filterChain.chainMap</code> configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.filterChain.chainMap = [
   [pattern: '/webservice/**', filters: 'JOINED_FILTERS,-exceptionTranslationFilter'],
   [pattern: '/**',            filters: 'JOINED_FILTERS,-basicAuthenticationFilter,-basicExceptionTranslationFilter']
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the <code>/webservice/**</code> URLs, we want all filters except for the standard <code>ExceptionTranslationFilter</code> since we want to use just the one configured for Basic Auth. And for the <code>/**</code> URLs (everything else) we want everything except for the Basic Auth filter and its configured <code>ExceptionTranslationFilter</code>.</p>
</div>
<div class="paragraph">
<p>Additionally, you can use a <code>chainMap</code> configuration to declare one or more URL patterns which should have no filters applied. Use the name <code>'none'</code> for these patterns, e.g.</p>
</div>
<div class="listingblock">
<div class="title">Listing 78. Using <code>none</code> in a <code>filterChain.chainMap</code> configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.filterChain.chainMap = [
   [pattern: '/someurlpattern/**', filters: 'none'],
   [pattern: '/**',                filters: 'JOINED_FILTERS']
]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clientregisterfilter">15.4. clientRegisterFilter</h3>
<div class="paragraph">
<p>An alternative to setting the <code>filterNames</code> property is <code>grails.plugin.springsecurity.SpringSecurityUtils.clientRegisterFilter()</code>. This property allows you to add a custom filter to the chain at a specified position. Each standard filter has a corresponding position in the chain (see <code>grails.plugin.springsecurity.SecurityFilterPosition</code> for details). So if you have created an application-specific filter, register it in <code>grails-app/conf/spring/resources.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import com.mycompany.myapp.MyFilter
import org.springframework.boot.context.embedded.FilterRegistrationBean

beans = {
   myFilter(MyFilter) {
      // properties
   }

   myFilterDeregistrationBean(FilterRegistrationBean) {
      filter = ref('myFilter')
      enabled = false
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in addition to the filter bean, there is also a disabled <code>FilterRegistrationBean</code> registered. This is needed because Spring Boot automatically registers filter beans in the <code>ApplicationContext</code>, so you must register your own <code>FilterRegistrationBean</code> and set its <code>enabled</code> property to <code>false</code> to prevent this.</p>
</div>
<div class="paragraph">
<p>Then register the filter in <code>grails-app/init/BootStrap.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import grails.plugin.springsecurity.SecurityFilterPosition
import grails.plugin.springsecurity.SpringSecurityUtils

class BootStrap {

   def init = {
      SpringSecurityUtils.clientRegisterFilter(
          'myFilter', SecurityFilterPosition.OPENID_FILTER.order + 10)
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This bootstrap code registers your filter just after the Open ID filter (if it&#8217;s configured). You cannot register a filter in the same position as another, so it&#8217;s a good idea to add a small delta to its position to put it after or before a filter that it should be next to in the chain. The Open ID filter position is just an example - add your filter in the position that makes sense.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="channelSecurity">16. Channel Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use channel security to configure which URLs require HTTP and which require HTTPS.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Channel Security configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">portMapper.httpPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8080</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP port your application uses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">portMapper.httpsPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8443</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS port your application uses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secureChannel.definition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map of URL pattern to channel rule</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secureChannel.secureHeaderName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'X-Forwarded-Proto'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the header to check for HTTPS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secureChannel.secureHeaderValue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'http'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The header value for <code>secureHeaderName</code> that indicates a need to redirect from HTTPS to HTTP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secureChannel.secureConfigAttributeKeyword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'REQUIRES_SECURE_CHANNEL'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The config attribute token to use for marking a pattern as requiring HTTPS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secureChannel.insecureHeaderName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'X-Forwarded-Proto'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the header to check for HTTP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secureChannel.insecureHeaderValue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'https'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The header value for <code>insecureHeaderName</code> that indicates a need to redirect from HTTP to HTTPS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secureChannel.insecureConfigAttributeKeyword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'REQUIRES_INSECURE_CHANNEL'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The config attribute token to use for marking a pattern as requiring HTTP.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Build a <code>List</code> of single-entry <code>Map</code>s under the <code>secureChannel.definition</code> key, where URL patterns are stored under the key &#8220;pattern&#8221;, and the values are stored under the key &#8220;access&#8221; and are one of the access keywords <code>REQUIRES_SECURE_CHANNEL</code>, <code>REQUIRES_INSECURE_CHANNEL</code>, or <code>ANY_CHANNEL</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 79. Sample <code>grails.plugin.springsecurity.secureChannel.definition</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.secureChannel.definition = [
   [pattern: '/login/**',        access: 'REQUIRES_SECURE_CHANNEL'],
   [pattern: '/maps/**',         access: 'REQUIRES_INSECURE_CHANNEL'],
   [pattern: '/images/login/**', access: 'REQUIRES_SECURE_CHANNEL'],
   [pattern: '/images/**',       access: 'ANY_CHANNEL']
]</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The format of <code>secureChannel.definition</code> has changed from previous versions to avoid configuration parsing issues. In previous versions the property was a single Map, where the keys were the access patterns and the values were one of the access keywords above. The old format is no longer supported and your configurations must be updated to the newer format.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>URLs are checked in order, so be sure to put more specific rules before less specific. In the preceding example, <code>/images/login/**</code> is more specific than <code>/images/**</code>, so it appears first in the configuration.</p>
</div>
<div class="sect2">
<h3 id="header-checking">16.1. Header checking</h3>
<div class="paragraph">
<p>The default implementation of channel security is fairly simple; if you&#8217;re using HTTP but HTTPS is required, you get redirected to the corresponding SSL URL and vice versa. But when using a load balancer such as an F5 BIG-IP it&#8217;s not possible to just check secure/insecure. In that case you can configure the load balancer to set a request header indicating the current state. To use this approach, set the <code>useHeaderCheckChannelSecurity</code> configuration property to <code>true</code> and optionally change the header names or values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.secureChannel.useHeaderCheckChannelSecurity = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the header name is &#8220;X-Forwarded-Proto&#8221; and the secure header value is &#8220;http&#8221; (i.e. if you&#8217;re not secure, redirect to secure) and the insecure header value is &#8220;https&#8221; (i.e. if you&#8217;re secure, redirect to insecure). You can change any or all of these default values though:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.secureChannel.secureHeaderName = '...'
grails.plugin.springsecurity.secureChannel.secureHeaderValue = '...'
grails.plugin.springsecurity.secureChannel.insecureHeaderName = '...'
grails.plugin.springsecurity.secureChannel.insecureHeaderValue = '...'</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ip">17. IP Address Restrictions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ordinarily you can guard URLs sufficiently with roles, but the plugin provides an extra layer of security with its ability to restrict by IP address.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. IP Address Restriction configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipRestrictions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map of URL patterns to IP address patterns.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, make an admin-only part of your site accessible only from IP addresses of the local LAN or VPN, such as 192.168.1.xxx or 10.xxx.xxx.xxx. You can also set this up at your firewall and/or routers, but it is convenient to encapsulate it within your application.</p>
</div>
<div class="paragraph">
<p>To use this feature, specify an <code>ipRestrictions</code> configuration as a <code>List</code> of <code>Map</code>s, one for each combination of URL pattern to IP address patterns that can access those URLs. The IP patterns can be single-value strings, or multi-value lists of strings. They can use <a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing">CIDR</a> masks, and can specify either IPv4 or IPv6 patterns. For example, given this configuration:</p>
</div>
<div class="listingblock">
<div class="title">Listing 80. Sample <code>grails.plugin.springsecurity.ipRestrictions</code> configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.ipRestrictions = [
   [pattern: '/pattern1/**', access: '123.234.345.456'],
   [pattern: '/pattern2/**', access: '10.0.0.0/8'],
   [pattern: '/pattern3/**', access: ['10.10.200.42', '10.10.200.63']]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>pattern1</code> URLs can be accessed only from the external address 123.234.345.456, <code>pattern2</code> URLs can be accessed only from a 10.xxx.xxx.xxx intranet address, and <code>pattern3</code> URLs can be accessed only from 10.10.200.42 or 10.10.200.63. All other URL patterns are accessible from any IP address.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The format of <code>ipRestrictions</code> has changed from previous versions to avoid configuration parsing issues. In previous versions the property was a single Map, where the keys were the access patterns and the values were the IP addresses that are allowed. The old format is no longer supported and your configurations must be updated to the newer format.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All addresses can always be accessed from localhost regardless of IP pattern, primarily to support local development mode.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot compare IPv4 and IPv6 addresses, so if your server supports both, you need to specify the IP patterns using the address format that is actually being used. Otherwise the filter throws exceptions. One option is to set the <code>java.net.preferIPv4Stack</code> system property, for example, by adding it to <code>JAVA_OPTS</code> or <code>GRAILS_OPTS</code> as <code>-Djava.net.preferIPv4Stack=true</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sessionFixation">18. Session Fixation Prevention</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To guard against <a href="https://en.wikipedia.org/wiki/Session_fixation">session-fixation attacks</a> set the <code>useSessionFixationPrevention</code> attribute to <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.useSessionFixationPrevention = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Upon successful authentication a new HTTP session is created and the previous session&#8217;s attributes are copied into it. If you start your session by clicking a link that was generated by someone trying to hack your account, which contained an active session id, you are no longer sharing the previous session after login. You have your own session.</p>
</div>
<div class="paragraph">
<p>Session fixation is less of a problem now that Grails by default does not include jsessionid in URLs (see <a href="https://jira.grails.org/browse/GRAILS-3364">this JIRA issue</a>), but it&#8217;s still a good idea to use this feature.</p>
</div>
<div class="paragraph">
<p>Note that there is an issue when using the <a href="https://grails.org/plugin/cookie-session">cookie-session</a> plugin; see <a href="https://github.com/benlucchesi/grails-cookie-session-v2/issues/17">this issue</a> for more details.</p>
</div>
<div class="paragraph">
<p>The table shows configuration options for session fixation.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. Session Fixation Prevention configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useSessionFixationPrevention</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use session fixation prevention</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionFixationPrevention.migrate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to copy the session attributes of the existing session to the new session after login</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionFixationPrevention.alwaysCreateSession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to always create a session even if one did not exist at the start of the request</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="logoutHandlers">19. Logout Handlers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You register a list of logout handlers by implementing the <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/web/authentication/logout/LogoutHandler.html">LogoutHandler</a> interface. The list is called when a user explicitly logs out.</p>
</div>
<div class="paragraph">
<p>By default, a <code>securityContextLogoutHandler</code> bean is registered to clear the <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/context/SecurityContextHolder.html">SecurityContextHolder</a>. Also, unless you are using Facebook or OpenID, <code>rememberMeServices</code> bean is registered to reset your cookie. (Facebook and OpenID authenticate externally so we don&#8217;t have access to the password to create a remember-me cookie.) If you are using Facebook, a <code>facebookLogoutHandler</code> is registered to reset its session cookies.</p>
</div>
<div class="paragraph">
<p>To customize this list, you define a <code>logout.handlerNames</code> attribute with a list of bean names.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. Logout Handler configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout.handlerNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['rememberMeServices', 'securityContextLogoutHandler']</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logout handler bean names</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The beans must be declared either by the plugin or by you in <code>resources.groovy</code>. For example, suppose you have a custom <code>MyLogoutHandler</code> in <code>resources.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 81. Registering a custom logout handler in <code>resources.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import com.foo.MyLogoutHandler

beans = {
   myLogoutHandler(MyLogoutHandler) {
      // attributes
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You register it in <code>grails-app/conf/application.groovy</code> as:</p>
</div>
<div class="listingblock">
<div class="title">Listing 82. Adding a custom logout handler in <code>grails.plugin.springsecurity.logout.handlerNames</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.logout.handlerNames = [
   'rememberMeServices', 'securityContextLogoutHandler', 'myLogoutHandler'
]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="voters">20. Voters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Voters are classes that implement the Spring Security <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/access/AccessDecisionVoter.html">AccessDecisionVoter</a> interface and are used to confirm whether a successful authentication is authorized for the current request.</p>
</div>
<div class="paragraph">
<p>You can register the voters to use with the <code>voterNames</code> setting; each element in the collection is the name of an existing Spring bean.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. Voters configuration options</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">voterNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['authenticatedVoter', 'roleVoter', 'webExpressionVoter', 'closureVoter']</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean names of voters</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The default voters include a <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/access/vote/RoleHierarchyVoter.html">RoleHierarchyVoter</a> to ensure users have the required roles for the request, an <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/access/vote/AuthenticatedVoter.html">AuthenticatedVoter</a> to support <code>IS_AUTHENTICATED_FULLY</code>, <code>IS_AUTHENTICATED_REMEMBERED</code>, and <code>IS_AUTHENTICATED_ANONYMOUSLY</code> tokens, a <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/web/access/expression/WebExpressionVoter.html">WebExpressionVoter</a> to evaluate SpEL expressions, and a <code>grails.plugin.springsecurity.access.vote.ClosureVoter</code> to invoke annotation closures.</p>
</div>
<div class="paragraph">
<p>To customize this list, you define a <code>voterNames</code> attribute with a list of bean names. Any existing bean that implements the interface can be used, whether it is declared by this plugin, in your application&#8217;s resources.groovy, another plugin, or any other source.</p>
</div>
<div class="paragraph">
<p>Suppose you have registered a bean for a custom <code>MyAccessDecisionVoter</code> in <code>resources.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import com.foo.MyAccessDecisionVoter

beans = {
   myAccessDecisionVoter(MyAccessDecisionVoter) {
      // attributes
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You register it in <code>grails-app/conf/application.groovy</code> as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.voterNames = [
   'authenticatedVoter', 'roleVoter', 'webExpressionVoter',
   'closureVoter', 'myAccessDecisionVoter'
]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="miscProperties">21. Miscellaneous Properties</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. Miscellaneous Properties</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the plugin is enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">printStatusMessages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to print status messages such as &#8220;Configuring Spring Security Core &#8230;&#8203;&#8221;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rejectIfNoRule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;strict&#8221; mode where a request mapping is required for all resources; if <code>true</code> make sure to allow <code>permitAll</code> for &#8220;/&#8221;, &#8220;/js/**&#8221;, &#8220;/css/**&#8221;, &#8220;/images/**&#8221;, &#8220;/login/**&#8221;, &#8220;/logout/**&#8221;, and so on</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">anon.key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;foo&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">anonymousProcessingFilter key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">atr.anonymousClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity.authentication. GrailsAnonymousAuthenticationToken</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anonymous token class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useHttpSession EventPublisher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, an <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/web/session/HttpSessionEventPublisher.html">HttpSession EventPublisher</a> will be configured</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cacheUsers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, logins are cached using an <code>EhCache</code>. See &#8220;Account Locking and Forcing Password Change&#8221;, under &#8220;User Cache&#8221;: <a href="#locking">Account Locking and Forcing Password Change</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useSecurity EventListener</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, configure <code>SecurityEventListener</code>. See <a href="#events">Events</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dao.reflectionSaltSourceProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Which property to use for the reflection-based salt source. See <a href="#salt">Salted Passwords</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dao.hideUserNotFoundExceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>true</code>, throws a new <code>BadCredentialsException</code> if a username is not found or the password is incorrect, but if <code>false</code> re-throws the <code>UsernameNot FoundException</code> thrown by <code>UserDetailsService</code> (considered less secure than throwing <code>BadCredentialsException</code> for both exceptions)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestCache.createSession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether caching <code>SavedRequest</code> can trigger the creation of a session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">roleHierarchy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hierarchical role definition. See <a href="#hierarchicalRoles">Hierarchical Roles</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">voterNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['authenticatedVoter', 'roleVoter', 'closureVoter']</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean names of voters. See <a href="#voters">Voters</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">providerNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['daoAuthenticationProvider', 'anonymousAuthenticationProvider', 'rememberMeAuthenticationProvider']</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean names of authentication providers. See <a href="#authenticationProviders">Authentication Providers</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">securityConfigType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Annotation&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of request mapping to use, one of &#8220;Annotation&#8221;, &#8220;Requestmap&#8221;, or &#8220;InterceptUrlMap&#8221; (or the corresponding enum value from <code>SecurityConfigType</code>). See <a href="#requestMappings">Configuring Request Mappings to Secure URLs</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">controllerAnnotations.lowercase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to do URL comparisons using lowercase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">controllerAnnotations.staticRules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extra rules that cannot be mapped using annotations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interceptUrlMap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request mapping definition when using &#8220;InterceptUrlMap&#8221;. See <a href="#configGroovyMap">Static Map</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">registerLoggerListener</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, registers a <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/access/event/LoggerListener.html">LoggerListener</a> that logs interceptor-related application events</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scr.allowSessionCreation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to allow creating a session in the <code>securityContextRepository</code> bean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scr.disableUrlRewriting</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to disable URL rewriting (and the jsessionid attribute)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scr.springSecurityContextKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpSessionSecurityContextRepository. SPRING_SECURITY_CONTEXT_KEY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The HTTP session key to store the <code>SecurityContext</code> under</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scpf.forceEagerSessionCreation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to eagerly create a session in the <code>securityContextRepository</code> bean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sch.strategyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SecurityContextHolder.MODE_THREADLOCAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The strategy to use for storing the <code>SecurityContext</code> - can be one of <code>MODE_THREADLOCAL</code>, <code>MODE_INHERITABLETHREADLOCAL</code>, or <code>MODE_GLOBAL</code>, or the name of a class implementing <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/core/context/SecurityContextHolderStrategy.html">SecurityContextHolderStrategy</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug.useFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use the <code>DebugFilter</code> to log request debug information to the console</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">providerManager.eraseCredentialsAfterAuthentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to remove the password from the <code>Authentication</code> and its child objects after successful authentication</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="tutorials">22. Tutorials</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="usingControllerAnnotations">22.1. Using Controller Annotations to Secure URLs</h3>
<div class="sect3">
<h4 id="1-create-your-grails-application">22.1.1. 1. Create your Grails application.</h4>
<div class="literalblock">
<div class="content">
<pre>$ grails create-app bookstore
$ cd bookstore</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="2-install-the-plugin-by-adding-it-to-build-gradle">22.1.2. 2. &#8220;Install&#8221; the plugin by adding it to build.gradle</h4>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">dependencies {
   ...
   compile 'org.grails.plugins:spring-security-core:{project-version}'
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the compile command to resolve dependencies and ensure everything is correct:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails compile</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="3-create-the-user-and-role-domain-classes">22.1.3. 3. Create the User and Role domain classes.</h4>
<div class="literalblock">
<div class="content">
<pre>$ grails s2-quickstart com.mycompany.myapp User Role</pre>
</div>
</div>
<div class="paragraph">
<p>You can choose your names for your domain classes and package; these are just examples.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Depending on your database, some domain class names might not be valid, especially those relating to security. Before you create names like &#8220;User&#8221; or &#8220;Group&#8221;, make sure they are not reserved keywords in your database, or escape the name with backticks in the <code>mapping</code> block, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">static mapping = {
   table '`user`'
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using Spring Core version 3.1.2 or later and GORM 6.0.10 or later, the script creates this User class:</p>
</div>
<div class="listingblock">
<div class="title"><code>grails-app/domain/com/mycompany/myapp/User.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import groovy.transform.EqualsAndHashCode
import groovy.transform.ToString
import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
@EqualsAndHashCode(includes='username')
@ToString(includes='username', includeNames=true, includePackage=false)
class User implements Serializable {

	private static final long serialVersionUID = 1

	String username
	String password
	boolean enabled = true
	boolean accountExpired
	boolean accountLocked
	boolean passwordExpired

	Set&lt;Role&gt; getAuthorities() {
		(UserRole.findAllByUser(this) as List&lt;UserRole&gt;)*.role as Set&lt;Role&gt;
	}

	static constraints = {
		password blank: false, password: true
		username blank: false, unique: true
	}

	static mapping = {
		password column: '`password`'
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and a password encoder listener to manage password encoding:</p>
</div>
<div class="listingblock">
<div class="title"><code>grails-app/conf/spring/resources.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import com.mycompany.myapp.UserPasswordEncoderListener
// Place your Spring DSL code here
beans = {
    userPasswordEncoderListener(UserPasswordEncoderListener)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>src/main/groovy/com/mycompany/myapp/UserPasswordEncoderListener.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.plugin.springsecurity.SpringSecurityService
import org.grails.datastore.mapping.engine.event.AbstractPersistenceEvent
import org.grails.datastore.mapping.engine.event.PreInsertEvent
import org.grails.datastore.mapping.engine.event.PreUpdateEvent
import org.springframework.beans.factory.annotation.Autowired
import grails.events.annotation.gorm.Listener
import groovy.transform.CompileStatic

@CompileStatic
class UserPasswordEncoderListener {

    @Autowired
    SpringSecurityService springSecurityService

    @Listener(User)
    void onPreInsertEvent(PreInsertEvent event) {
        encodePasswordForEvent(event)
    }

    @Listener(User)
    void onPreUpdateEvent(PreUpdateEvent event) {
        encodePasswordForEvent(event)
    }

    private void encodePasswordForEvent(AbstractPersistenceEvent event) {
        if (event.entityObject instanceof User) {
            User u = event.entityObject as User
            if (u.password &amp;&amp; ((event instanceof  PreInsertEvent) || (event instanceof PreUpdateEvent &amp;&amp; u.isDirty('password')))) {
                event.getEntityAccess().setProperty('password', encodePassword(u.password))
            }
        }
    }

    private String encodePassword(String password) {
        springSecurityService?.passwordEncoder ? springSecurityService.encodePassword(password) : password
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Previous versions of the plugin&#8217;s script manage the password encoding directly in domain class:</p>
</div>
<div class="listingblock">
<div class="title"><code>grails-app/domain/com/mycompany/myapp/User.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.plugin.springsecurity.SpringSecurityService
import groovy.transform.EqualsAndHashCode
import groovy.transform.ToString
import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
@EqualsAndHashCode(includes='username')
@ToString(includes='username', includeNames=true, includePackage=false)
class User implements Serializable {

	private static final long serialVersionUID = 1

	SpringSecurityService springSecurityService

	String username
	String password
	boolean enabled = true
	boolean accountExpired
	boolean accountLocked
	boolean passwordExpired

	Set&lt;Role&gt; getAuthorities() {
		(UserRole.findAllByUser(this) as List&lt;UserRole&gt;)*.role as Set&lt;Role&gt;
	}

	def beforeInsert() {
		encodePassword()
	}

	def beforeUpdate() {
		if (isDirty('password')) {
			encodePassword()
		}
	}

	protected void encodePassword() {
		password = springSecurityService?.passwordEncoder ? springSecurityService.encodePassword(password) : password
	}

	static transients = ['springSecurityService']

	static constraints = {
		password blank: false, password: true
		username blank: false, unique: true
	}

	static mapping = {
		password column: '`password`'
	}
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Service injection in GORM entities is disabled by default since Grails 3.2.8. Read documentation about <a href="http://docs.grails.org/latest/ref/Domain%20Classes/Usage.html#_spring_autowiring_of_domain_instances">Spring Autowiring of Domain Instances</a> to learn how to turn autowire on.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>s2-quickstart</code> script generates this Role too:</p>
</div>
<div class="listingblock">
<div class="title"><code>Role.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import groovy.transform.EqualsAndHashCode
import groovy.transform.ToString
import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
@EqualsAndHashCode(includes='authority')
@ToString(includes='authority', includeNames=true, includePackage=false)
class Role implements Serializable {

	private static final long serialVersionUID = 1

	String authority

	static constraints = {
		authority blank: false, unique: true
	}

	static mapping = {
		cache true
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and a domain class that maps the many-to-many join class, <code>UserRole</code>:</p>
</div>
<div class="listingblock">
<div class="title"><code>UserRole.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.gorm.DetachedCriteria
import groovy.transform.ToString

import org.codehaus.groovy.util.HashCodeHelper
import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
@ToString(cache=true, includeNames=true, includePackage=false)
class UserRole implements Serializable {

	private static final long serialVersionUID = 1

	User user
	Role role

	@Override
	boolean equals(other) {
		if (other instanceof UserRole) {
			other.userId == user?.id &amp;&amp; other.roleId == role?.id
		}
	}

    @Override
	int hashCode() {
	    int hashCode = HashCodeHelper.initHash()
        if (user) {
            hashCode = HashCodeHelper.updateHash(hashCode, user.id)
		}
		if (role) {
		    hashCode = HashCodeHelper.updateHash(hashCode, role.id)
		}
		hashCode
	}

	static UserRole get(long userId, long roleId) {
		criteriaFor(userId, roleId).get()
	}

	static boolean exists(long userId, long roleId) {
		criteriaFor(userId, roleId).count()
	}

	private static DetachedCriteria criteriaFor(long userId, long roleId) {
		UserRole.where {
			user == User.load(userId) &amp;&amp;
			role == Role.load(roleId)
		}
	}

	static UserRole create(User user, Role role, boolean flush = false) {
		def instance = new UserRole(user: user, role: role)
		instance.save(flush: flush)
		instance
	}

	static boolean remove(User u, Role r) {
		if (u != null &amp;&amp; r != null) {
			UserRole.where { user == u &amp;&amp; role == r }.deleteAll()
		}
	}

	static int removeAll(User u) {
		u == null ? 0 : UserRole.where { user == u }.deleteAll() as int
	}

	static int removeAll(Role r) {
		r == null ? 0 : UserRole.where { role == r }.deleteAll() as int
	}

	static constraints = {
		role validator: { Role r, UserRole ur -&gt;
			if (ur.user?.id) {
				UserRole.withNewSession {
					if (UserRole.exists(ur.user.id, r.id)) {
						return ['userRole.exists']
					}
				}
			}
		}
	}

	static mapping = {
		id composite: ['user', 'role']
		version false
	}
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These generated files are not part of the plugin - these are your application files.
They are examples to get you started, so you can edit them as you please.
They contain the minimum needed for the plugin&#8217;s default implementation of the Spring Security <code>UserDetailsService</code>
(which like everything in the plugin is customizable - see <a href="#userDetailsService">Custom UserDetailsService</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The script has edited (or created) <code>grails-app/conf/application.groovy</code> and added the configuration for your domain classes. Make sure that the changes are correct.</p>
</div>
<div class="paragraph">
<p>While you&#8217;re looking at <code>application.groovy</code>, add this config override to make the sample app easier to work with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">grails.plugin.springsecurity.logout.postOnly = false</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default only POST requests can be used to logout; this is a very sensible default and shouldn&#8217;t be changed in most cases. However to keep things simple for this tutorial we&#8217;ll change it (using the <code>logout.postOnly</code> config override above) to avoid having to create a GSP form that POSTs to /logout.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The plugin has no support for CRUD actions or GSPs for your domain classes; the <code>spring-security-ui</code> plugin supplies a UI for those. So for now you will create roles and users in <code>grails-app/init/BootStrap.groovy</code>. (See step 7.)</p>
</div>
</div>
<div class="sect3">
<h4 id="4-create-a-controller-that-will-be-restricted-by-role">22.1.4. 4. Create a controller that will be restricted by role.</h4>
<div class="literalblock">
<div class="content">
<pre>$ grails create-controller com.mycompany.myapp.Secure</pre>
</div>
</div>
<div class="paragraph">
<p>This command creates <code>grails-app/controllers/com/mycompany/myapp/SecureController.groovy</code>. Add some output so you can verify that things are working:</p>
</div>
<div class="listingblock">
<div class="title"><code>SecureController.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

class SecureController {
   def index() {
      render 'Secure access only'
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="5-edit-grails-appinitbootstrap-groovy-to-add-a-test-user">22.1.5. 5. Edit grails-app/init/BootStrap.groovy to add a test user.</h4>
<div class="listingblock">
<div class="title"><code>BootStrap.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.gorm.transactions.Transactional

class BootStrap {
    def init = {
        addTestUser()
    }

    @Transactional
    void addTestUser() {
        def adminRole = new Role(authority: 'ROLE_ADMIN').save()

        def testUser = new User(username: 'me', password: 'password').save()

        UserRole.create testUser, adminRole

        UserRole.withSession {
            it.flush()
            it.clear()
        }

        assert User.count() == 1
        assert Role.count() == 1
        assert UserRole.count() == 1
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some things to note about the preceding <code>BootStrap.groovy</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The example does not use a traditional GORM many-to-many mapping for the User &lt;==&gt; Role relationship; instead you are mapping the join table with the <code>UserRole</code> class. This performance optimization helps significantly when many users have one or more common roles.</p>
</li>
<li>
<p>We explicitly flush (using <code>withSession</code>) because <code>BootStrap</code> does not run in a transaction or OpenSessionInView.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="6-start-the-server">22.1.6. 6. Start the server.</h4>
<div class="literalblock">
<div class="content">
<pre>$ grails run-app</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="7-verify-that-you-cannot-access-the-page-yet">22.1.7. 7. Verify that you cannot access the page yet.</h4>
<div class="paragraph">
<p>Before you secure the page, navigate to <a href="http://localhost:8080/secure" class="bare">http://localhost:8080/secure</a> to verify that you cannot access the page yet. You will be redirected to the login page, but after a successful authentication (log in with the username and password you used for the test user in BootStrap.groovy) you will see an error page:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Sorry, you're not authorized to view this page.</pre>
</div>
</div>
<div class="paragraph">
<p>This is because with the default configuration, all URLs are denied unless there is an access rule specified.</p>
</div>
</div>
<div class="sect3">
<h4 id="8-apply-the-annotation">22.1.8. 8. Apply the annotation.</h4>
<div class="paragraph">
<p>Edit <code>grails-app/controllers/com/mycompany/myapp/SecureController.groovy</code> to import the annotation class and apply the annotation to restrict (and grant) access.</p>
</div>
<div class="listingblock">
<div class="title"><code>SecureController.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.plugin.springsecurity.annotation.Secured

class SecureController {
   @Secured('ROLE_ADMIN')
   def index() {
      render 'Secure access only'
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="title"><code>SecureController.groovy</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package com.mycompany.myapp

import grails.plugin.springsecurity.annotation.Secured

@Secured('ROLE_ADMIN')
class SecureController {
   def index() {
      render 'Secure access only'
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can annotate the entire controller or individual actions. In this case you have only one action, so you can do either.</p>
</div>
</div>
<div class="sect3">
<h4 id="9-restart">22.1.9. 9. Restart.</h4>
<div class="paragraph">
<p>Shut down the app and run <code>grails run-app</code> again, and navigate again to <a href="http://localhost:8080/secure" class="bare">http://localhost:8080/secure</a>.</p>
</div>
<div class="paragraph">
<p>This time you should again be able to see the secure page after successfully authenticating.</p>
</div>
</div>
<div class="sect3">
<h4 id="10-test-the-remember-me-functionality">22.1.10. 10. Test the Remember Me functionality.</h4>
<div class="paragraph">
<p>Check the checkbox, and once you&#8217;ve tested the secure page, close your browser and reopen it. Navigate again the the secure page. Because a cookie is stored, you should not need to log in again. Logout at any time by navigating to <a href="http://localhost:8080/logout" class="bare">http://localhost:8080/logout</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="11-create-a-crud-ui">22.1.11. 11. Create a CRUD UI.</h4>
<div class="paragraph">
<p>Optionally, create a CRUD UI to work with users and roles.</p>
</div>
<div class="sect4">
<h5 id="run-grails-generate-all-for-the-domain-classes">Run grails generate-all for the domain classes:</h5>
<div class="literalblock">
<div class="content">
<pre>$ grails generate-all com.mycompany.myapp.User</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails generate-all com.mycompany.myapp.Role</pre>
</div>
</div>
<div class="paragraph">
<p>Since the User domain class handles password hashing, there are no changes required in the generated controllers.</p>
</div>
<div class="paragraph">
<p>Be sure to add an <code>@Secured</code> annotation to both of the generated controllers to make them accessible.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples">23. Example Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes the best way to learn is by example. We have an ever-expanding list of example apps created to do just that&#8230;&#8203; help you learn how to utilize the grails-spring-security-core plugin in your current application.</p>
</div>
<div class="sect2">
<h3 id="the-repos">23.1. The Repos</h3>
<div class="paragraph">
<p>A comprehensive list of example spring security apps may be found at:</p>
</div>
<div class="sect3">
<h4 id="httpsgithub-comgrails-spring-security-samples">23.1.1. <a href="https://github.com/grails-spring-security-samples" class="bare">https://github.com/grails-spring-security-samples</a></h4>

</div>
</div>
<div class="sect2">
<h3 id="the-example-apps">23.2. The Example Apps</h3>
<div class="sect3">
<h4 id="spring-security-ui">23.2.1. spring-security-ui</h4>
<div class="paragraph">
<p>A sample Grails App which uses the Grails Spring Security UI and Spring Security Core Plugins.</p>
</div>
<div class="paragraph">
<p>The Spring Security UI plugin provides CRUD screens and other user management workflows.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/grails-spring-security-samples/spring-security-ui" class="bare">https://github.com/grails-spring-security-samples/spring-security-ui</a></p>
</div>
</div>
<div class="sect3">
<h4 id="grails-spring-security-spring-boot-actuators">23.2.2. grails-spring-security-spring-boot-actuators</h4>
<div class="paragraph">
<p>A sample Grails App which secures a Spring Boot Actuator endpoint using the Spring Security Core Plugin.</p>
</div>
<div class="paragraph">
<p>Spring Boot Actuators provide ways to monitor the health and performance of your application along with other metadata information.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/grails-spring-security-samples/grails-spring-security-spring-boot-actuators" class="bare">https://github.com/grails-spring-security-samples/grails-spring-security-spring-boot-actuators</a></p>
</div>
</div>
<div class="sect3">
<h4 id="grails-ssc-mongodb">23.2.3. grails-ssc-mongodb</h4>
<div class="paragraph">
<p>A sample Grails App which uses the Spring Security Core Plugin and MongoDB.</p>
</div>
<div class="paragraph">
<p>MongoDB is an open source, document-oriented database.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/grails-spring-security-samples/grails-ssc-mongodb" class="bare">https://github.com/grails-spring-security-samples/grails-ssc-mongodb</a></p>
</div>
</div>
<div class="sect3">
<h4 id="grails-spring-security-params">23.2.4. grails-spring-security-params</h4>
<div class="paragraph">
<p>A sample Grails App which uses the Spring Security Core Plugin to demonstrate how to use a closure with the <code>@Secured</code> annotation.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/grails-spring-security-samples/grails-spring-security-params" class="bare">https://github.com/grails-spring-security-samples/grails-spring-security-params</a></p>
</div>
</div>
<div class="sect3">
<h4 id="grails-spring-security-group">23.2.5. grails-spring-security-group</h4>
<div class="paragraph">
<p>A sample Grails App which uses the Spring Security Core Plugin and Group Authentication as described in the documentation.</p>
</div>
<div class="paragraph">
<p>Rather than granting authorities directly to a “person”, you can create a “group”, map authorities to it, and then map a “person” to that “group”. For applications that have a one or more groups of users who need the same level of access, having one or more “group” instances makes managing changes to access levels easier.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/grails-spring-security-samples/grails-spring-security-group" class="bare">https://github.com/grails-spring-security-samples/grails-spring-security-group</a></p>
</div>
</div>
<div class="sect3">
<h4 id="grails-spring-security-hierarchical-roles">23.2.6. grails-spring-security-hierarchical-roles</h4>
<div class="paragraph">
<p>A sample Grails App which uses the Spring Security Core Plugin and Hierarchical Roles as described in the documentation.</p>
</div>
<div class="paragraph">
<p>Hierarchical roles are a convenient way to reduce clutter in your request mappings.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/grails-spring-security-samples/grails-spring-security-hierarchical-roles" class="bare">https://github.com/grails-spring-security-samples/grails-spring-security-hierarchical-roles</a></p>
</div>
</div>
<div class="sect3">
<h4 id="grails-spring-security-ajax">23.2.7. grails-spring-security-ajax</h4>
<div class="paragraph">
<p>A sample Grails App which uses the Spring Security Core Plugin and Ajax Authentication as described in the documentation.</p>
</div>
<div class="paragraph">
<p>The Spring Security Core Plugin supports Ajax logins, but you need to create your own client-side code.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/grails-spring-security-samples/grails-spring-security-ajax" class="bare">https://github.com/grails-spring-security-samples/grails-spring-security-ajax</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="controllerMethods">24. Controller Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The plugin registers some convenience methods into all controllers in your application. As of version 3.1.0 this is implemented by a trait that is applied to all controllers but was implemented in earlier versions by adding methods to each controller&#8217;s <code>MetaClass</code>. All are accessor methods, so they can be called as methods or properties. They include:</p>
</div>
<div class="sect2">
<h3 id="isloggedin-2">24.1. isLoggedIn</h3>
<div class="paragraph">
<p>Returns <code>true</code> if there is an authenticated user.</p>
</div>
<div class="listingblock">
<div class="title">Listing 83. Example use of <code>isLoggedIn()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyController {

   def someAction() {
      if (isLoggedIn()) {
         ...
      }

      ...

      if (!isLoggedIn()) {
         ...
      }

      // or

      if (loggedIn) {
         ...
      }

      if (!loggedIn) {
         ...
      }
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getprincipal-2">24.2. getPrincipal</h3>
<div class="paragraph">
<p>Retrieves the current authenticated user&#8217;s Principal (a <code>GrailsUser</code> instance unless you&#8217;ve customized this) or <code>null</code> if not authenticated.</p>
</div>
<div class="listingblock">
<div class="title">Listing 84. Example use of <code>getPrincipal()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyController {

   def someAction() {
      if (isLoggedIn()) {
         String username = getPrincipal().username
         ...
      }

      // or

      if (isLoggedIn()) {
         String username = principal.username
         ...
      }
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getauthenticateduser">24.3. getAuthenticatedUser</h3>
<div class="paragraph">
<p>Loads the user domain class instance from the database that corresponds to the currently authenticated user, or <code>null</code> if not authenticated. This is the equivalent of adding a dependency injection for <code>springSecurityService</code> and calling <code>PersonDomainClassName.get(springSecurityService.principal.id)</code> (the typical way that this is often done).</p>
</div>
<div class="listingblock">
<div class="title">Listing 85. Example use of <code>getAuthenticatedUser()</code></div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class MyController {

   def someAction() {
      if (isLoggedIn()) {
         String email = getAuthenticatedUser().email
         ...
      }

      // or

      if (isLoggedIn()) {
         String email = authenticatedUser.email
         ...
      }
   }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="i18n">25. Internationalization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The plugin includes i18n messages in several languages. To customize or translate these, add messages for the following keys to your i18n resource bundle(s) for each exception:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. i18n messages for exceptions</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Message</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Exception</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.errors.login.expired</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Sorry, your account has expired.&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccountExpiredException</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.errors.login.passwordExpired</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Sorry, your password has expired.&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CredentialsExpiredException</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.errors.login.disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Sorry, your account is disabled.&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DisabledException</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.errors.login.locked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Sorry, your account is locked.&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LockedException</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.errors.login.fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Sorry, we were not able to find a user with that username and password.&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other exceptions</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can customize all messages in auth.gsp and denied.gsp:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. i18n messages for GSPs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Message</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.login.title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Login&#8221;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.login.header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Please Login&#8221;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.login.button</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Login&#8221;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.login.username.label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Username&#8221;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.login.password.label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Password&#8221;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.login.remember.me.label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Remember me&#8221;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.denied.title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Denied&#8221;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">springSecurity.denied.message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8220;Sorry, you&#8217;re not authorized to view this page.&#8221;</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="scripts">26. Scripts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="s2-quickstart">26.1. s2-quickstart</h3>
<div class="paragraph">
<div class="title">Purpose</div>
<p>Creates a user and role class (and optionally a requestmap class) in the specified package.
If you specify a role-group name with the groupClassName argument, role/group classes will also be generated.
If you specify the uiOnly flag, no domain classes are created but the plugin settings are initialized (useful with LDAP, Mock, Shibboleth, etc.)</p>
</div>
<div class="paragraph">
<p>The general format is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>grails s2-quickstart DOMAIN_CLASS_PACKAGE USER_CLASS_NAME ROLE_CLASS_NAME [REQUESTMAP_CLASS_NAME] [--groupClassName=GROUP_CLASS_NAME]</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Examples</div>
<div class="content">
<pre>grails s2-quickstart com.yourapp User Role</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>grails s2-quickstart com.yourapp User Role --groupClassName=RoleGroup</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>grails s2-quickstart com.yourapp Person Authority Requestmap</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>grails s2-quickstart --uiOnly</pre>
</div>
</div>
<div class="ulist">
<div class="title">Description</div>
<ul>
<li>
<p>Updates <code>grails-app/conf/application.groovy</code> with security configuration settings and creates domain classes in <code>grails-app/domain</code> unless the uiOnly flag is specified</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="s2-create-persistent-token">26.2. s2-create-persistent-token</h3>
<div class="paragraph">
<div class="title">Purpose</div>
<p>Creates a persistent token domain class for storing remember-me cookie information in the database. The general format is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>grails s2-create-persistent-token &lt;classname&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>grails s2-create-persistent-token com.yourapp.PersistentLogin</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Description</div>
<p>This creates the domain class in the specified package, and also registers the name in <code>grails-app/conf/application.groovy</code>, along with enabling persistent remember-me.</p>
</div>
</div>
<div class="sect2">
<h3 id="s2-create-role-hierarchy-entry">26.3. s2-create-role-hierarchy-entry</h3>
<div class="paragraph">
<div class="title">Purpose</div>
<p>Creates a persistent role hierarchy entry domain class for storing role hierarchy information in the database. The general format is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>grails s2-create-role-hierarchy-entry &lt;classname&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>grails s2-create-role-hierarchy-entry com.yourapp.RoleHierarchyEntry</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Description</div>
<p>This creates the domain class in the specified package, and also registers the name in <code>grails-app/conf/application.groovy</code>, along with enabling persistent role hierarchy storage and lookup.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="debugging">27. Debugging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you need debug information, you can specify the following entries in logback.groovy:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/logback.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">logger 'org.springframework.security', DEBUG, ['STDOUT'], false
logger 'grails.plugin.springsecurity', DEBUG, ['STDOUT'], false</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 6.0.0-SNAPSHOT<br>
Last updated 2023-08-24 02:24:05 UTC
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
</body>
</html>